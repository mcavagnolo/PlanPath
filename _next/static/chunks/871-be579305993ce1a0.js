(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{1818:(e,t,r)=>{"use strict";function s(e,[t,r,n],[i,a],o="bilinear",l=!1){let h=a/n,c=i/r,u=new e.constructor(i*a*t),d=r*n,f=i*a;for(let s=0;s<i;++s)for(let i=0;i<a;++i){let o=s*a+i,l=(i+.5)/h-.5,p=(s+.5)/c-.5,m=Math.floor(l),g=Math.floor(p),_=Math.min(m+1,n-1),y=Math.min(g+1,r-1),w=l-(m=Math.max(m,0)),b=p-(g=Math.max(g,0)),v=(1-w)*(1-b),x=w*(1-b),k=(1-w)*b,A=w*b,E=g*n,S=y*n,$=E+m,I=E+_,O=S+m,C=S+_;for(let r=0;r<t;++r){let t=r*d;u[r*f+o]=v*e[t+$]+x*e[t+I]+k*e[t+O]+A*e[t+C]}}return u}function n(e,t,r){let s=Array(r.length),n=Array(r.length);for(let e=r.length-1,i=1;e>=0;--e)n[e]=i,s[e]=t[r[e]],i*=s[e];let i=r.map((e,t)=>n[r.indexOf(t)]),a=new e.constructor(e.length);for(let r=0;r<e.length;++r){let s=0;for(let e=t.length-1,n=r;e>=0;--e)s+=n%t[e]*i[e],n=Math.floor(n/t[e]);a[s]=e[r]}return[a,s]}function i(e){let t=h(e)[0],r=e.map(e=>Math.exp(e-t)),s=r.reduce((e,t)=>e+t,0);return r.map(e=>e/s)}function a(e){return i(e).map(e=>Math.log(e))}function o(e,t=0){return e=Array.from(e).map((e,t)=>[t,e]).sort((e,t)=>t[1]-e[1]),null!==t&&t>0&&(e=e.slice(0,t)),e}function l(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],r=0;for(let s=1;s<e.length;++s)e[s]<t&&(t=e[s],r=s);return[t,r]}function h(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],r=0;for(let s=1;s<e.length;++s)e[s]>t&&(t=e[s],r=s);return[Number(t),r]}function c(e){return e>0&&(e&e-1)==0}r.d(t,{CM:()=>a,Em:()=>o,LI:()=>m,SX:()=>n,T9:()=>h,Vs:()=>i,gE:()=>g,jV:()=>p,jk:()=>l,rG:()=>f,vd:()=>s});class u{constructor(e){if(this.size=0|e,this.size<=1||!c(this.size))throw Error("FFT size must be a power of two larger than 1");this._csize=e<<1,this.table=new Float64Array(2*this.size);for(let e=0;e<this.table.length;e+=2){const t=Math.PI*e/this.size;this.table[e]=Math.cos(t),this.table[e+1]=-Math.sin(t)}let t=0;for(let e=1;this.size>e;e<<=1)++t;this._width=t%2==0?t-1:t,this._bitrev=new Int32Array(1<<this._width);for(let e=0;e<this._bitrev.length;++e){this._bitrev[e]=0;for(let t=0;t<this._width;t+=2){const r=this._width-t-2;this._bitrev[e]|=(e>>>t&3)<<r}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(e,t){let r=t||Array(e.length>>>1);for(let t=0;t<e.length;t+=2)r[t>>>1]=e[t];return r}toComplexArray(e,t){let r=t||this.createComplexArray();for(let t=0;t<r.length;t+=2)r[t]=e[t>>>1],r[t+1]=0;return r}transform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._transform4(e,t,1)}realTransform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._realTransform4(e,t,1)}inverseTransform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._transform4(e,t,-1);for(let t=0;t<e.length;++t)e[t]/=this.size}_transform4(e,t,r){let s,n,i=this._csize,a=1<<this._width,o=i/a<<1,l=this._bitrev;if(4===o)for(s=0,n=0;s<i;s+=o,++n){let r=l[n];this._singleTransform2(t,e,s,r,a)}else for(s=0,n=0;s<i;s+=o,++n){let i=l[n];this._singleTransform4(t,e,s,i,a,r)}let h=this.table;for(a>>=2;a>=2;a>>=2){let t=(o=i/a<<1)>>>2;for(s=0;s<i;s+=o){let n=s+t-1;for(let i=s,o=0;i<n;i+=2,o+=a){let s=i,n=s+t,a=n+t,l=a+t,c=e[s],u=e[s+1],d=e[n],f=e[n+1],p=e[a],m=e[a+1],g=e[l],_=e[l+1],y=h[o],w=r*h[o+1],b=d*y-f*w,v=d*w+f*y,x=h[2*o],k=r*h[2*o+1],A=p*x-m*k,E=p*k+m*x,S=h[3*o],$=r*h[3*o+1],I=g*S-_*$,O=g*$+_*S,C=c+A,M=u+E,T=c-A,R=u-E,U=b+I,B=v+O,z=r*(b-I),P=r*(v-O);e[s]=C+U,e[s+1]=M+B,e[n]=T+P,e[n+1]=R-z,e[a]=C-U,e[a+1]=M-B,e[l]=T-P,e[l+1]=R+z}}}}_singleTransform2(e,t,r,s,n){let i=e[s],a=e[s+1],o=e[s+n],l=e[s+n+1];t[r]=i+o,t[r+1]=a+l,t[r+2]=i-o,t[r+3]=a-l}_singleTransform4(e,t,r,s,n,i){let a=2*n,o=3*n,l=e[s],h=e[s+1],c=e[s+n],u=e[s+n+1],d=e[s+a],f=e[s+a+1],p=e[s+o],m=e[s+o+1],g=l+d,_=h+f,y=l-d,w=h-f,b=c+p,v=u+m,x=i*(c-p),k=i*(u-m);t[r]=g+b,t[r+1]=_+v,t[r+2]=y+k,t[r+3]=w-x,t[r+4]=g-b,t[r+5]=_-v,t[r+6]=y-k,t[r+7]=w+x}_realTransform4(e,t,r){let s,n,i=this._csize,a=1<<this._width,o=i/a<<1,l=this._bitrev;if(4===o)for(s=0,n=0;s<i;s+=o,++n){let r=l[n];this._singleRealTransform2(t,e,s,r>>>1,a>>>1)}else for(s=0,n=0;s<i;s+=o,++n){let i=l[n];this._singleRealTransform4(t,e,s,i>>>1,a>>>1,r)}let h=this.table;for(a>>=2;a>=2;a>>=2){let t=(o=i/a<<1)>>>1,n=t>>>1,l=n>>>1;for(s=0;s<i;s+=o)for(let i=0,o=0;i<=l;i+=2,o+=a){let a=s+i,c=a+n,u=c+n,d=u+n,f=e[a],p=e[a+1],m=e[c],g=e[c+1],_=e[u],y=e[u+1],w=e[d],b=e[d+1],v=h[o],x=r*h[o+1],k=m*v-g*x,A=m*x+g*v,E=h[2*o],S=r*h[2*o+1],$=_*E-y*S,I=_*S+y*E,O=h[3*o],C=r*h[3*o+1],M=w*O-b*C,T=w*C+b*O,R=f+$,U=p+I,B=f-$,z=p-I,P=k+M,j=A+T,L=r*(k-M),N=r*(A-T);if(e[a]=R+P,e[a+1]=U+j,e[c]=B+N,e[c+1]=z-L,0===i){e[u]=R-P,e[u+1]=U-j;continue}if(i===l)continue;let F=s+n-i,D=s+t-i;e[F]=B-r*N,e[F+1]=-z-r*L,e[D]=R-r*P,e[D+1]=-U+r*j}}let c=i>>>1;for(let t=2;t<c;t+=2)e[i-t]=e[t],e[i-t+1]=-e[t+1]}_singleRealTransform2(e,t,r,s,n){let i=e[s],a=e[s+n];t[r]=i+a,t[r+1]=0,t[r+2]=i-a,t[r+3]=0}_singleRealTransform4(e,t,r,s,n,i){let a=e[s],o=e[s+n],l=e[s+2*n],h=e[s+3*n],c=a+l,u=a-l,d=o+h,f=i*(o-h);t[r]=c+d,t[r+1]=0,t[r+2]=u,t[r+3]=-f,t[r+4]=c-d,t[r+5]=0,t[r+6]=u,t[r+7]=f}}class d{constructor(e){const t=2*(e-1),r=2*(2*e-1),s=2**Math.ceil(Math.log2(r));this.bufferSize=s,this._a=t;const n=new Float64Array(r),i=new Float64Array(s);this._chirpBuffer=new Float64Array(s),this._buffer1=new Float64Array(s),this._buffer2=new Float64Array(s),this._outBuffer1=new Float64Array(s),this._outBuffer2=new Float64Array(s);const a=-2*Math.PI/e,o=Math.cos(a),l=Math.sin(a);for(let t=0;t<r>>1;++t){const r=(t+1-e)**2/2,s=Math.sqrt(o**2+l**2)**r,a=r*Math.atan2(l,o),h=2*t;n[h]=s*Math.cos(a),n[h+1]=s*Math.sin(a),i[h]=n[h],i[h+1]=-n[h+1]}this._slicedChirpBuffer=n.subarray(t,r),this._f=new u(s>>1),this._f.transform(this._chirpBuffer,i)}_transform(e,t,r){let s=this._buffer1,n=this._buffer2,i=this._outBuffer1,a=this._outBuffer2,o=this._chirpBuffer,l=this._slicedChirpBuffer,h=this._a;if(r)for(let e=0;e<l.length;e+=2){let r=e+1,n=t[e>>1];s[e]=n*l[e],s[r]=n*l[r]}else for(let e=0;e<l.length;e+=2){let r=e+1;s[e]=t[e]*l[e]-t[r]*l[r],s[r]=t[e]*l[r]+t[r]*l[e]}this._f.transform(i,s);for(let e=0;e<o.length;e+=2){let t=e+1;n[e]=i[e]*o[e]-i[t]*o[t],n[t]=i[e]*o[t]+i[t]*o[e]}this._f.inverseTransform(a,n);for(let t=0;t<a.length;t+=2){let r=a[t+h],s=a[t+h+1],n=l[t],i=l[t+1];e[t]=r*n-s*i,e[t+1]=r*i+s*n}}transform(e,t){this._transform(e,t,!1)}realTransform(e,t){this._transform(e,t,!0)}}class f{constructor(e){this.fft_length=e,this.isPowerOfTwo=c(e),this.isPowerOfTwo?(this.fft=new u(e),this.outputBufferSize=2*e):(this.fft=new d(e),this.outputBufferSize=this.fft.bufferSize)}realTransform(e,t){this.fft.realTransform(e,t)}transform(e,t){this.fft.transform(e,t)}}function p(e,t){if(t%2==0||t<=0)throw Error("Window size must be a positive odd number");let r=new e.constructor(e.length),s=new e.constructor(t),n=Math.floor(t/2);for(let t=0;t<e.length;++t){let i=0;for(let r=-n;r<=n;++r){let n=t+r;n<0?n=Math.abs(n):n>=e.length&&(n=2*(e.length-1)-n),s[i++]=e[n]}s.sort(),r[t]=s[n]}return r}function m(e,t){let r=Math.pow(10,t);return Math.round(e*r)/r}function g(e){let t=Math.round(e);return Math.abs(e)%1==.5?t%2==0?t:t-1:t}},9590:(e,t,r)=>{"use strict";r.r(t),r.d(t,{InferenceSession:()=>g,Tensor:()=>p,env:()=>l,registerBackend:()=>i});let s={},n=[],i=(e,t,r)=>{if(t&&"function"==typeof t.init&&"function"==typeof t.createSessionHandler){let i=s[e];if(void 0===i)s[e]={backend:t,priority:r};else if(i.priority>r)return;else if(i.priority===r&&i.backend!==t)throw Error(`cannot register backend "${e}" using priority ${r}`);if(r>=0){let t=n.indexOf(e);-1!==t&&n.splice(t,1);for(let t=0;t<n.length;t++)if(s[n[t]].priority<=r)return void n.splice(t,0,e);n.push(e)}return}throw TypeError("not a valid backend")},a=async e=>{let t=0===e.length?n:e,r=[];for(let e of t){let t=s[e];if(t){if(t.initialized)return t.backend;if(t.aborted)continue;let s=!!t.initPromise;try{return s||(t.initPromise=t.backend.init()),await t.initPromise,t.initialized=!0,t.backend}catch(n){s||r.push({name:e,err:n}),t.aborted=!0}finally{delete t.initPromise}}}throw Error(`no available backend found. ERR: ${r.map(e=>`[${e.name}] ${e.err}`).join(", ")}`)};class o{constructor(){this.wasm={},this.webgl={},this.logLevelInternal="warning"}set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw Error(`Unsupported logging level: ${e}`);this.logLevelInternal=e}}get logLevel(){return this.logLevelInternal}}let l=new o,h="undefined"!=typeof BigInt64Array&&"function"==typeof BigInt64Array.from,c="undefined"!=typeof BigUint64Array&&"function"==typeof BigUint64Array.from,u=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),d=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);h&&(u.set("int64",BigInt64Array),d.set(BigInt64Array,"int64")),c&&(u.set("uint64",BigUint64Array),d.set(BigUint64Array,"uint64"));class f{constructor(e,t,r){let s,n,i;if("string"==typeof e)if(s=e,i=r,"string"===e){if(!Array.isArray(t))throw TypeError("A string tensor's data must be a string array.");n=t}else{const r=u.get(e);if(void 0===r)throw TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t))n=r.from(t);else if(t instanceof r)n=t;else throw TypeError(`A ${s} tensor's data must be type of ${r}`)}else if(i=t,Array.isArray(e)){if(0===e.length)throw TypeError("Tensor type cannot be inferred from an empty array.");const t=typeof e[0];if("string"===t)s="string",n=e;else if("boolean"===t)s="bool",n=Uint8Array.from(e);else throw TypeError(`Invalid element type of data array: ${t}.`)}else{const t=d.get(e.constructor);if(void 0===t)throw TypeError(`Unsupported type for tensor data: ${e.constructor}.`);s=t,n=e}if(void 0===i)i=[n.length];else if(!Array.isArray(i))throw TypeError("A tensor's dims must be a number array");const a=(e=>{let t=1;for(let r=0;r<e.length;r++){let s=e[r];if("number"!=typeof s||!Number.isSafeInteger(s))throw TypeError(`dims[${r}] must be an integer, got: ${s}`);if(s<0)throw RangeError(`dims[${r}] must be a non-negative integer, got: ${s}`);t*=s}return t})(i);if(a!==n.length)throw Error(`Tensor's size(${a}) does not match data length(${n.length}).`);this.dims=i,this.type=s,this.data=n,this.size=a}static bufferToTensor(e,t){let r,s;if(void 0===e)throw Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw Error("Image height and width must be defined");let{height:n,width:i}=t,a=t.norm;r=void 0===a||void 0===a.mean?255:a.mean,s=void 0===a||void 0===a.bias?0:a.bias;let o=void 0!==t.bitmapFormat?t.bitmapFormat:"RGBA",l=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",h=n*i,c=new Float32Array("RGBA"===l?4*h:3*h),u=4,d=0,p=1,m=2,g=3,_=0,y=h,w=2*h,b=-1;"RGB"===o&&(u=3,d=0,p=1,m=2,g=-1),"RGBA"===l?b=3*h:"RBG"===l?(_=0,w=h,y=2*h):"BGR"===l&&(w=0,y=h,_=2*h);for(let t=0;t<h;t++,d+=u,m+=u,p+=u,g+=u)c[_++]=(e[d]+s)/r,c[y++]=(e[p]+s)/r,c[w++]=(e[m]+s)/r,-1!==b&&-1!==g&&(c[b++]=(e[g]+s)/r);return"RGBA"===l?new f("float32",c,[1,4,n,i]):new f("float32",c,[1,3,n,i])}static async fromImage(e,t){let r,s="undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement,n="undefined"!=typeof ImageData&&e instanceof ImageData,i="undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap,a="undefined"!=typeof String&&(e instanceof String||"string"==typeof e),o={};if(s){let s=document.createElement("canvas"),n=s.getContext("2d");if(null!=n){let i=e.naturalHeight,a=e.naturalWidth;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(i=t.resizedHeight,a=t.resizedWidth),void 0!==t){if(o=t,void 0!==t.tensorFormat)throw Error("Image input config format must be RGBA for HTMLImageElement");if(o.tensorFormat="RGBA",void 0!==t.height&&t.height!==i)throw Error("Image input config height doesn't match HTMLImageElement height");if(o.height=i,void 0!==t.width&&t.width!==a)throw Error("Image input config width doesn't match HTMLImageElement width");o.width=a}else o.tensorFormat="RGBA",o.height=i,o.width=a;s.width=a,s.height=i,n.drawImage(e,0,0,a,i),r=n.getImageData(0,0,a,i).data}else throw Error("Can not access image data")}else if(n){let s,n;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(s=t.resizedHeight,n=t.resizedWidth):(s=e.height,n=e.width),void 0!==t){if(o=t,void 0!==t.bitmapFormat&&"RGBA"!==t.bitmapFormat)throw Error("Image input config format must be RGBA for ImageData");o.bitmapFormat="RGBA"}else o.bitmapFormat="RGBA";if(o.height=s,o.width=n,void 0!==t){let t=document.createElement("canvas");t.width=n,t.height=s;let i=t.getContext("2d");if(null!=i)i.putImageData(e,0,0),r=i.getImageData(0,0,n,s).data;else throw Error("Can not access image data")}else r=e.data}else if(i){if(void 0===t)throw Error("Please provide image config with format for Imagebitmap");if(void 0!==t.bitmapFormat)throw Error("Image input config format must be defined for ImageBitmap");let s=document.createElement("canvas").getContext("2d");if(null!=s){let n=e.height,i=e.width;if(s.drawImage(e,0,0,i,n),r=s.getImageData(0,0,i,n).data,void 0!==t){if(void 0!==t.height&&t.height!==n)throw Error("Image input config height doesn't match ImageBitmap height");if(o.height=n,void 0!==t.width&&t.width!==i)throw Error("Image input config width doesn't match ImageBitmap width");o.width=i}else o.height=n,o.width=i;return f.bufferToTensor(r,o)}throw Error("Can not access image data")}else if(a)return new Promise((r,s)=>{let n=document.createElement("canvas"),i=n.getContext("2d");if(!e||!i)return s();let a=new Image;a.crossOrigin="Anonymous",a.src=e,a.onload=()=>{n.width=a.width,n.height=a.height,i.drawImage(a,0,0,n.width,n.height);let e=i.getImageData(0,0,n.width,n.height);if(void 0!==t){if(void 0!==t.height&&t.height!==n.height)throw Error("Image input config height doesn't match ImageBitmap height");if(o.height=n.height,void 0!==t.width&&t.width!==n.width)throw Error("Image input config width doesn't match ImageBitmap width");o.width=n.width}else o.height=n.height,o.width=n.width;r(f.bufferToTensor(e.data,o))}});else throw Error("Input data provided is not supported - aborted tensor creation");if(void 0!==r)return f.bufferToTensor(r,o);throw Error("Input data provided is not supported - aborted tensor creation")}toImageData(e){var t,r;let s,n=document.createElement("canvas").getContext("2d");if(null!=n){let i=this.dims[3],a=this.dims[2],o=this.dims[1],l=void 0!==e&&void 0!==e.format?e.format:"RGB",h=void 0!==e&&(null==(t=e.norm)?void 0:t.mean)!==void 0?e.norm.mean:255,c=void 0!==e&&(null==(r=e.norm)?void 0:r.bias)!==void 0?e.norm.bias:0,u=a*i;if(void 0!==e){if(void 0!==e.height&&e.height!==a)throw Error("Image output config height doesn't match tensor height");if(void 0!==e.width&&e.width!==i)throw Error("Image output config width doesn't match tensor width");if(void 0!==e.format&&4===o&&"RGBA"!==e.format||3===o&&"RGB"!==e.format&&"BGR"!==e.format)throw Error("Tensor format doesn't match input tensor dims")}let d=0,f=1,p=2,m=3,g=0,_=u,y=2*u,w=-1;"RGBA"===l?(g=0,_=u,y=2*u,w=3*u):"RGB"===l?(g=0,_=u,y=2*u):"RBG"===l&&(g=0,y=u,_=2*u),s=n.createImageData(i,a);for(let e=0;e<a*i;d+=4,f+=4,p+=4,m+=4,e++)s.data[d]=(this.data[g++]-c)*h,s.data[f]=(this.data[_++]-c)*h,s.data[p]=(this.data[y++]-c)*h,s.data[m]=-1===w?255:(this.data[w++]-c)*h}else throw Error("Can not access image data");return s}reshape(e){return new f(this.type,this.data,e)}}let p=f;class m{constructor(e){this.handler=e}async run(e,t,r){let s={},n={};if("object"!=typeof e||null===e||e instanceof p||Array.isArray(e))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let i=!0;if("object"==typeof t){if(null===t)throw TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof p)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw TypeError("'fetches' cannot be an empty array.");for(let e of(i=!1,t)){if("string"!=typeof e)throw TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw RangeError(`'fetches' contains invalid output name: ${e}.`);s[e]=null}if("object"==typeof r&&null!==r)n=r;else if(void 0!==r)throw TypeError("'options' must be an object.")}else{let e=!1,a=Object.getOwnPropertyNames(t);for(let r of this.outputNames)if(-1!==a.indexOf(r)){let n=t[r];(null===n||n instanceof p)&&(e=!0,i=!1,s[r]=n)}if(e){if("object"==typeof r&&null!==r)n=r;else if(void 0!==r)throw TypeError("'options' must be an object.")}else n=t}}else if(void 0!==t)throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let t of this.inputNames)if(void 0===e[t])throw Error(`input '${t}' is missing in 'feeds'.`);if(i)for(let e of this.outputNames)s[e]=null;let a=await this.handler.run(e,s,n),o={};for(let e in a)Object.hasOwnProperty.call(a,e)&&(o[e]=new p(a[e].type,a[e].data,a[e].dims));return o}static async create(e,t,r,s){let n,i={};if("string"==typeof e){if(n=e,"object"==typeof t&&null!==t)i=t;else if(void 0!==t)throw TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(n=e,"object"==typeof t&&null!==t)i=t;else if(void 0!==t)throw TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer){let a=0,o=e.byteLength;if("object"==typeof t&&null!==t)i=t;else if("number"==typeof t){if(!Number.isSafeInteger(a=t))throw RangeError("'byteOffset' must be an integer.");if(a<0||a>=e.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${e.byteLength}).`);if(o=e.byteLength-a,"number"==typeof r){if(!Number.isSafeInteger(o=r))throw RangeError("'byteLength' must be an integer.");if(o<=0||a+o>e.byteLength)throw RangeError(`'byteLength' is out of range (0, ${e.byteLength-a}].`);if("object"==typeof s&&null!==s)i=s;else if(void 0!==s)throw TypeError("'options' must be an object.")}else if(void 0!==r)throw TypeError("'byteLength' must be a number.")}else if(void 0!==t)throw TypeError("'options' must be an object.");n=new Uint8Array(e,a,o)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let o=(i.executionProviders||[]).map(e=>"string"==typeof e?e:e.name),l=await a(o);return new m(await l.createSessionHandler(n,i))}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}let g=m},25861:(e,t,r)=>{"use strict";r.d(t,{Fg:()=>u,Fq:()=>_,LC:()=>y,S3:()=>c,SP:()=>g,VT:()=>i,Y8:()=>d,hK:()=>f,kU:()=>o,pe:()=>p,uB:()=>h,zM:()=>l,z_:()=>m}),r(76874);var s=r(33560),n=r(1818);class i extends s.bV{constructor(){super(),this.processors=[]}push(e){this.processors.push(e)}extend(e){this.processors.push(...e)}_call(e,t){for(let r of t)this.processors.forEach(t=>t(e,r))}[Symbol.iterator](){return this.processors.values()}}class a extends s.bV{_call(e,t){throw Error("`_call` should be implemented in a subclass")}}class o extends a{constructor(e){super(),this.force_token_map=Object.fromEntries(e??[])}_call(e,t){let r=this.force_token_map[e.length];return(0,s.t2)(r)&&(t.data.fill(-1/0),t.data[r]=0),t}}class l extends a{constructor(e){super(),this.bos_token_id=e}_call(e,t){return 1===e.length&&(t.data.fill(-1/0),t.data[this.bos_token_id]=0),t}}class h extends a{constructor(e,t){super(),this.max_length=e,this.forced_eos_token_id=t}_call(e,t){}}class c extends a{constructor(e,t){super(),this.begin_suppress_tokens=e,this.begin_index=t}_call(e,t){if(e.length===this.begin_index)for(let e of this.begin_suppress_tokens)t.data[e]=-1/0;return t}}class u extends a{constructor(e){super(),this.eos_token_id=e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(e.forced_decoder_ids||[]).length+2,e.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index}_call(e,t){let r=t.data;if(r[this.no_timestamps_token_id]=-1/0,e.length===this.begin_index-1)return r.fill(-1/0),r[this.timestamp_begin]=0,t;let s=e.slice(this.begin_index),i=s.length>=1&&s[s.length-1]>=this.timestamp_begin,a=s.length<2||s[s.length-2]>=this.timestamp_begin;if(i&&(a?r.subarray(this.timestamp_begin).fill(-1/0):r.subarray(0,this.eos_token_id).fill(-1/0)),e.length===this.begin_index&&null!==this.max_initial_timestamp_index){let e=this.timestamp_begin+this.max_initial_timestamp_index;r.subarray(e+1).fill(-1/0)}let o=(0,n.CM)(r);return Math.log(o.subarray(this.timestamp_begin).map(Math.exp).reduce((e,t)=>e+t))>(0,n.T9)(o.subarray(0,this.timestamp_begin))[0]&&r.subarray(0,this.timestamp_begin).fill(-1/0),t}}class d extends a{constructor(e){super(),this.no_repeat_ngram_size=e}getNgrams(e){let t=e.length,r=[];for(let s=0;s<t+1-this.no_repeat_ngram_size;++s){let t=[];for(let r=0;r<this.no_repeat_ngram_size;++r)t.push(e[s+r]);r.push(t)}let s=new Map;for(let e of r){let t=JSON.stringify(e.slice(0,e.length-1)),r=s.get(t)??[];r.push(e[e.length-1]),s.set(t,r)}return s}getGeneratedNgrams(e,t){let r=t.slice(t.length+1-this.no_repeat_ngram_size,t.length);return e.get(JSON.stringify(r))??[]}calcBannedNgramTokens(e){if(e.length+1<this.no_repeat_ngram_size)return[];{let t=this.getNgrams(e);return this.getGeneratedNgrams(t,e)}}_call(e,t){for(let r of this.calcBannedNgramTokens(e))t.data[r]=-1/0;return t}}class f extends a{constructor(e){super(),this.penalty=e}_call(e,t){for(let r of e)t.data[r]<0?t.data[r]*=this.penalty:t.data[r]/=this.penalty;return t}}class p extends a{constructor(e,t){super(),this.min_length=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){if(e.length<this.min_length)for(let e of this.eos_token_id)t.data[e]=-1/0;return t}}class m extends a{constructor(e,t,r){super(),this.prompt_length_to_skip=e,this.min_new_tokens=t,this.eos_token_id=Array.isArray(r)?r:[r]}_call(e,t){if(e.length-this.prompt_length_to_skip<this.min_new_tokens)for(let e of this.eos_token_id)t.data[e]=-1/0;return t}}class g extends a{constructor(e,t){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){for(let r of this.bad_words_ids){let s=!0;for(let t=1;t<=r.length-1&&r.length<e.length;++t)if(r.at(-t-1)!==e.at(-t)){s=!1;break}s&&(t.data[r.at(-1)]=-1/0)}return t}}let _=class{constructor(e={}){this.max_length=e.max_length??20,this.max_new_tokens=e.max_new_tokens??null,this.min_length=e.min_length??0,this.min_new_tokens=e.min_new_tokens??null,this.early_stopping=e.early_stopping??!1,this.max_time=e.max_time??null,this.do_sample=e.do_sample??!1,this.num_beams=e.num_beams??1,this.num_beam_groups=e.num_beam_groups??1,this.penalty_alpha=e.penalty_alpha??null,this.use_cache=e.use_cache??!0,this.temperature=e.temperature??1,this.top_k=e.top_k??50,this.top_p=e.top_p??1,this.typical_p=e.typical_p??1,this.epsilon_cutoff=e.epsilon_cutoff??0,this.eta_cutoff=e.eta_cutoff??0,this.diversity_penalty=e.diversity_penalty??0,this.repetition_penalty=e.repetition_penalty??1,this.encoder_repetition_penalty=e.encoder_repetition_penalty??1,this.length_penalty=e.length_penalty??1,this.no_repeat_ngram_size=e.no_repeat_ngram_size??0,this.bad_words_ids=e.bad_words_ids??null,this.force_words_ids=e.force_words_ids??null,this.renormalize_logits=e.renormalize_logits??!1,this.constraints=e.constraints??null,this.forced_bos_token_id=e.forced_bos_token_id??null,this.forced_eos_token_id=e.forced_eos_token_id??null,this.remove_invalid_values=e.remove_invalid_values??!1,this.exponential_decay_length_penalty=e.exponential_decay_length_penalty??null,this.suppress_tokens=e.suppress_tokens??null,this.begin_suppress_tokens=e.begin_suppress_tokens??null,this.forced_decoder_ids=e.forced_decoder_ids??null,this.num_return_sequences=e.num_return_sequences??1,this.output_attentions=e.output_attentions??!1,this.output_hidden_states=e.output_hidden_states??!1,this.output_scores=e.output_scores??!1,this.return_dict_in_generate=e.return_dict_in_generate??!1,this.pad_token_id=e.pad_token_id??null,this.bos_token_id=e.bos_token_id??null,this.eos_token_id=e.eos_token_id??null,this.encoder_no_repeat_ngram_size=e.encoder_no_repeat_ngram_size??0,this.decoder_start_token_id=e.decoder_start_token_id??null,this.generation_kwargs=e.generation_kwargs??{}}};class y extends s.bV{constructor(e){super(),this.generation_config=e}_call(e,t=-1){return this.sample(e,t)}sample(e,t){throw Error("sample should be implemented in subclasses.")}getLogits(e,t){let r=e.dims.at(-1),s=e.data;if(-1===t)s=s.slice(-r);else{let e=t*r;s=s.slice(e,e+r)}return this.generation_config.temperature>0&&(s=s.map(e=>e/this.generation_config.temperature)),s}randomSelect(e){let t=Math.random()*e.reduce((e,t)=>e+t,0);for(let r=0;r<e.length;++r)if((t-=e[r])<=0)return r;return 0}static getSampler(e){if(e.do_sample)return new b(e);if(e.num_beams>1)return new v(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new w(e)}}class w extends y{sample(e,t=-1){let r=this.getLogits(e,t);return[[(0,n.T9)(r)[1],0]]}}class b extends y{sample(e,t=-1){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));let s=this.getLogits(e,t),i=(0,n.Em)(s,r),a=(0,n.Vs)(i.map(e=>e[1]));return Array.from({length:this.generation_config.num_beams},()=>{let e=this.randomSelect(a);return[i[e][0],Math.log(a[e])]})}}class v extends y{sample(e,t=-1){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));let s=this.getLogits(e,t),i=(0,n.Em)(s,r),a=(0,n.Vs)(i.map(e=>e[1]));return Array.from({length:this.generation_config.num_beams},(e,t)=>[i[t][0],Math.log(a[t])])}}},29010:(e,t,r)=>{"use strict";r.d(t,{Yw:()=>m,ly:()=>u,wc:()=>g});var s=r(60143),n=r(72603),i=r(54180),a=r(33560),o=r(41463),l=r(49304).hp;class h{_CONTENT_TYPE_MAP={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};constructor(e){if(this.filePath=e,this.headers=new Headers,this.exists=s.existsSync(e),this.exists){this.status=200,this.statusText="OK";let t=s.statSync(e);this.headers.set("content-length",t.size.toString()),this.updateContentType();let r=this;this.body=new ReadableStream({start(e){r.arrayBuffer().then(t=>{e.enqueue(new Uint8Array(t)),e.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){let e=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",this._CONTENT_TYPE_MAP[e]??"application/octet-stream")}clone(){let e=new h(this.filePath);return e.exists=this.exists,e.status=this.status,e.statusText=this.statusText,e.headers=new Headers(this.headers),e}async arrayBuffer(){return(await s.promises.readFile(this.filePath)).buffer}async blob(){return new Blob([await s.promises.readFile(this.filePath)],{type:this.headers.get("content-type")})}async text(){return await s.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function c(e,t=null,r=null){let s;try{s=new URL(e)}catch(e){return!1}return(!t||!!t.includes(s.protocol))&&(!r||!!r.includes(s.hostname))}async function u(e){if(i._.useFS&&!c(e,["http:","https:","blob:"]))return new h(e);if(void 0===o||o?.release?.name!=="node")return fetch(e);{let t=!!o.env?.TESTING_REMOTELY,r=i._.version,s=new Headers;if(s.set("User-Agent",`transformers.js/${r}; is_ci/${t};`),c(e,["http:","https:"],["huggingface.co","hf.co"])){let e=o.env?.HF_TOKEN??o.env?.HF_ACCESS_TOKEN;e&&s.set("Authorization",`Bearer ${e}`)}return fetch(e,{headers:s})}}let d={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};class f{constructor(e){this.path=e}async match(e){let t=new h(n.join(this.path,e));return t.exists?t:void 0}async put(e,t){let r=l.from(await t.arrayBuffer()),i=n.join(this.path,e);try{await s.promises.mkdir(n.dirname(i),{recursive:!0}),await s.promises.writeFile(i,r)}catch(e){console.warn("An error occurred while writing the file to cache:",e)}}}async function p(e,...t){for(let r of t)try{let t=await e.match(r);if(t)return t}catch(e){continue}}async function m(e,t,r=!0,s={}){let n,o,l,h;if(!i._.allowLocalModels){if(s.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");else if(!i._.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}if((0,a._e)(s.progress_callback,{status:"initiate",name:e,file:t}),!n&&i._.useBrowserCache){if("undefined"==typeof caches)throw Error("Browser cache is not available in this environment.");try{n=await caches.open("transformers-cache")}catch(e){console.warn("An error occurred while opening the browser cache:",e)}}if(!n&&i._.useFSCache&&(n=new f(s.cache_dir??i._.cacheDir)),!n&&i._.useCustomCache){if(!i._.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!i._.customCache.match||!i._.customCache.put)throw Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");n=i._.customCache}let g=s.revision??"main",w=y(e,t),b=y(i._.localModelPath,w),v=y(i._.remoteHost,i._.remotePathTemplate.replaceAll("{model}",e).replaceAll("{revision}",encodeURIComponent(g)),t),x="main"===g?w:y(e,g,t),k=n instanceof f?x:v,A=!1;n&&(l=await p(n,b,k));let E=void 0!==l;if(void 0===l){if(i._.allowLocalModels)if(c(w,["http:","https:"])){if(s.local_files_only)throw Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${w}.`);else if(!i._.allowRemoteModels)throw Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${w}.`)}else try{l=await u(b),o=b}catch(e){console.warn(`Unable to load from local path "${b}": "${e}"`)}if(void 0===l||404===l.status){if(s.local_files_only||!i._.allowRemoteModels)if(!r)return null;else throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${b}".`);if(200!==(l=await u(v)).status){var S=l.status;if(!r)return null;let e=d[S]??`Error (${S}) occurred while trying to load file`;throw Error(`${e}: "${v}".`)}o=k}A=n&&"undefined"!=typeof Response&&l instanceof Response&&200===l.status}(0,a._e)(s.progress_callback,{status:"download",name:e,file:t});let $={status:"progress",name:e,file:t};return s.progress_callback?E&&"undefined"!=typeof navigator&&/firefox/i.test(navigator.userAgent)?(h=new Uint8Array(await l.arrayBuffer()),(0,a._e)(s.progress_callback,{...$,progress:100,loaded:h.length,total:h.length})):h=await _(l,e=>{(0,a._e)(s.progress_callback,{...$,...e})}):h=new Uint8Array(await l.arrayBuffer()),A&&o&&await n.match(o)===void 0&&await n.put(o,new Response(h,{headers:l.headers})).catch(e=>{console.warn(`Unable to add response to browser cache: ${e}.`)}),(0,a._e)(s.progress_callback,{status:"done",name:e,file:t}),h}async function g(e,t,r=!0,s={}){let n=await m(e,t,r,s);return null===n?{}:JSON.parse(new TextDecoder("utf-8").decode(n))}async function _(e,t){let r=e.headers.get("Content-Length");null===r&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let s=parseInt(r??"0"),n=new Uint8Array(s),i=0,a=e.body.getReader();async function o(){let{done:e,value:r}=await a.read();if(e)return;let l=i+r.length;if(l>s){let e=new Uint8Array(s=l);e.set(n),n=e}return n.set(r,i),t({progress:(i=l)/s*100,loaded:i,total:s}),o()}return await o(),n}function y(...e){return(e=e.map((t,r)=>(r&&(t=t.replace(RegExp("^/"),"")),r!==e.length-1&&(t=t.replace(RegExp("/$"),"")),t))).join("/")}},33560:(e,t,r)=>{"use strict";function s(e,t){e&&e(t)}function n(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[t,e]))}function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}r.d(t,{Nt:()=>i,TR:()=>d,_e:()=>s,bV:()=>a,iu:()=>o,k1:()=>l,ky:()=>c,nK:()=>p,qM:()=>f,t2:()=>h,uY:()=>u,vp:()=>n});let a=class{constructor(){let e=function(...t){return e._call(...t)};return Object.setPrototypeOf(e,new.target.prototype)}_call(){throw Error("Must implement _call method in subclass")}};function o(e){return e?.prototype?.__proto__?.constructor?.name==="TypedArray"}function l(e){return Number.isInteger(e)||"bigint"==typeof e}function h(e){return null!=e}function c(e){let t=[],r=e;for(;Array.isArray(r);)t.push(r.length),r=r[0];return t}function u(e,t,r){let s=e[t];if(void 0!==s)return delete e[t],s;if(void 0===r)throw Error(`Key ${t} does not exist in object.`);return r}function d(...e){return Array.prototype.concat.apply([],e)}function f(...e){return e.reduce((e,t)=>e.flatMap(e=>t.map(t=>[e,t])))}function p(e,t){return Math.abs((e+t)%(2*t)-t)}},36747:(e,t,r)=>{"use strict";let s,n,i;r.d(t,{_K2:()=>d._,jV8:()=>c.jV,TkF:()=>eY});var a=r(5631),o=r(7359),l=r(33560),h=r(29010),c=r(1818),u=r(76874),d=r(54180),f=r(27806);let p="undefined"!=typeof self,m=p&&"DedicatedWorkerGlobalScope"===self.constructor.name;if(p)s=(e,t)=>{if(!self.OffscreenCanvas)throw Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(e,t)},i=self.createImageBitmap,n=self.ImageData;else if(f)i=async e=>{let t=(await e.metadata()).channels,{data:r,info:s}=await e.rotate().raw().toBuffer({resolveWithObject:!0}),n=new y(new Uint8ClampedArray(r),s.width,s.height,s.channels);return void 0!==t&&t!==s.channels&&n.convert(t),n};else throw Error("Unable to load image processing library.");let g={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},_=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class y{constructor(e,t,r,s){this.data=e,this.width=t,this.height=r,this.channels=s}get size(){return[this.width,this.height]}static async read(e){if(e instanceof y)return e;if("string"==typeof e||e instanceof URL)return await this.fromURL(e);throw Error(`Unsupported input type: ${typeof e}`)}static async fromURL(e){let t=await (0,h.ly)(e);if(200!==t.status)throw Error(`Unable to read image from "${e}" (${t.status} ${t.statusText})`);let r=await t.blob();return this.fromBlob(r)}static async fromBlob(e){if(p){let t=await i(e),r=s(t.width,t.height).getContext("2d");return r.drawImage(t,0,0),new this(r.getImageData(0,0,t.width,t.height).data,t.width,t.height,4)}{let t=f(await e.arrayBuffer());return await i(t)}}static fromTensor(e,t="CHW"){if(3!==e.dims.length)throw Error(`Tensor should have 3 dimensions, but has ${e.dims.length} dimensions.`);if("CHW"===t)e=e.transpose(1,2,0);else if("HWC"===t);else throw Error(`Unsupported channel format: ${t}`);if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw Error(`Unsupported tensor type: ${e.type}`);switch(e.dims[2]){case 1:case 2:case 3:case 4:return new y(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw Error(`Unsupported number of channels: ${e.dims[2]}`)}}grayscale(){if(1===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let t=0,r=0;t<this.data.length;t+=this.channels){let s=this.data[t],n=this.data[t+1],i=this.data[t+2];e[r++]=Math.round(.2989*s+.587*n+.114*i)}break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(3===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let t=0,r=0;t<this.data.length;++t)e[r++]=this.data[t],e[r++]=this.data[t],e[r++]=this.data[t];break;case 4:for(let t=0,r=0;t<this.data.length;t+=4)e[r++]=this.data[t],e[r++]=this.data[t+1],e[r++]=this.data[t+2];break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(4===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let t=0,r=0;t<this.data.length;++t)e[r++]=this.data[t],e[r++]=this.data[t],e[r++]=this.data[t],e[r++]=255;break;case 3:for(let t=0,r=0;t<this.data.length;t+=3)e[r++]=this.data[t],e[r++]=this.data[t+1],e[r++]=this.data[t+2],e[r++]=255;break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,t,{resample:r=2}={}){let n=g[r]??r;if(p){let r=this.channels,n=this.toCanvas(),i=s(e,t).getContext("2d");return i.drawImage(n,0,0,e,t),new y(i.getImageData(0,0,e,t).data,e,t,4).convert(r)}{let r=this.toSharp();switch(n){case"box":case"hamming":("box"===n||"hamming"===n)&&(console.warn(`Resampling method ${n} is not yet supported. Using bilinear instead.`),n="bilinear");case"nearest":case"bilinear":case"bicubic":r=r.affine([e/this.width,0,0,t/this.height],{interpolator:n});break;case"lanczos":r=r.resize({width:e,height:t,fit:"fill",kernel:"lanczos3"});break;default:throw Error(`Resampling method ${n} is not supported.`)}return await i(r)}}async pad([e,t,r,n]){if(e=Math.max(e,0),t=Math.max(t,0),r=Math.max(r,0),n=Math.max(n,0),0===e&&0===t&&0===r&&0===n)return this;if(p){let i=this.channels,a=this.toCanvas(),o=this.width+e+t,l=this.height+r+n,h=s(o,l).getContext("2d");return h.drawImage(a,0,0,this.width,this.height,e,r,o,l),new y(h.getImageData(0,0,o,l).data,o,l,4).convert(i)}{let s=this.toSharp().extend({left:e,right:t,top:r,bottom:n});return await i(s)}}async crop([e,t,r,n]){if(e=Math.max(e,0),t=Math.max(t,0),r=Math.min(r,this.width-1),n=Math.min(n,this.height-1),0===e&&0===t&&r===this.width-1&&n===this.height-1)return this;let a=r-e+1,o=n-t+1;if(p){let r=this.channels,n=this.toCanvas(),i=s(a,o).getContext("2d");return i.drawImage(n,e,t,a,o,0,0,a,o),new y(i.getImageData(0,0,a,o).data,a,o,4).convert(r)}{let r=this.toSharp().extract({left:e,top:t,width:a,height:o});return await i(r)}}async center_crop(e,t){if(this.width===e&&this.height===t)return this;let r=(this.width-e)/2,n=(this.height-t)/2;if(p){let i=this.channels,a=this.toCanvas(),o=s(e,t).getContext("2d"),l=0,h=0,c=0,u=0;return r>=0?l=r:c=-r,n>=0?h=n:u=-n,o.drawImage(a,l,h,e,t,c,u,e,t),new y(o.getImageData(0,0,e,t).data,e,t,4).convert(i)}{let s=this.toSharp();if(r>=0&&n>=0)s=s.extract({left:Math.floor(r),top:Math.floor(n),width:e,height:t});else if(r<=0&&n<=0){let i=Math.floor(-n),a=Math.floor(-r);s=s.extend({top:i,left:a,right:e-this.width-a,bottom:t-this.height-i})}else{let i=[0,0],a=0;n<0?(i[0]=Math.floor(-n),i[1]=t-this.height-i[0]):a=Math.floor(n);let o=[0,0],l=0;r<0?(o[0]=Math.floor(-r),o[1]=e-this.width-o[0]):l=Math.floor(r),s=s.extend({top:i[0],bottom:i[1],left:o[0],right:o[1]}).extract({left:l,top:a,width:e,height:t})}return await i(s)}}async toBlob(e="image/png",t=1){if(!p)throw Error("toBlob() is only supported in browser environments.");let r=this.toCanvas();return await r.convertToBlob({type:e,quality:t})}toTensor(e="CHW"){let t=new u.qY("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if("HWC"===e);else if("CHW"===e)t=t.permute(2,0,1);else throw Error(`Unsupported channel format: ${e}`);return t}toCanvas(){if(!p)throw Error("toCanvas() is only supported in browser environments.");let e=this.clone().rgba(),t=s(e.width,e.height),r=new n(e.data,e.width,e.height);return t.getContext("2d").putImageData(r,0,0),t}_update(e,t,r,s=null){return this.data=e,this.width=t,this.height=r,null!==s&&(this.channels=s),this}clone(){return new y(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(e){if(p){if(m)throw Error("Unable to save an image from a Web Worker.");let t=e.split(".").pop().toLowerCase(),r=_.get(t)??"image/png",s=await this.toBlob(r),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=e,i.click(),i.remove()}else if(d._.useFS){let t=this.toSharp();return await t.toFile(e)}else throw Error("Unable to save the image because filesystem is disabled in this environment.")}toSharp(){if(p)throw Error("toSharp() is only supported in server-side environments.");return f(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}async function w(e,t){let r;if("undefined"==typeof AudioContext)throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let s=await (await (0,h.ly)(e)).arrayBuffer(),n=new AudioContext({sampleRate:t});void 0===t&&console.warn(`No sampling rate provided, using default of ${n.sampleRate}Hz.`);let i=await n.decodeAudioData(s);if(2===i.numberOfChannels){let e=Math.sqrt(2),t=i.getChannelData(0),s=i.getChannelData(1);r=new Float32Array(t.length);for(let n=0;n<i.length;++n)r[n]=e*(t[n]+s[n])/2}else r=i.getChannelData(0);return r}function b(e){if(e<1)return new Float64Array;if(1===e)return new Float64Array([1]);let t=e-1,r=Math.PI/t,s=new Float64Array(e);for(let n=0;n<e;++n){let e=2*n-t;s[n]=.5+.5*Math.cos(r*e)}return s}let v={htk:e=>2595*Math.log10(1+e/700),kaldi:e=>1127*Math.log(1+e/700),slaney:(e,t=1e3,r=15,s=27/Math.log(6.4))=>e>=t?r+Math.log(e/t)*s:3*e/200};function x(e,t="htk"){let r=v[t];if(!r)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return"number"==typeof e?r(e):e.map(e=>r(e))}let k={htk:e=>700*(10**(e/2595)-1),kaldi:e=>700*(Math.exp(e/1127)-1),slaney:(e,t=1e3,r=15,s=Math.log(6.4)/27)=>e>=r?t*Math.exp(s*(e-r)):200*e/3};function A(e,t,r){let s=(t-e)/(r-1);return Float64Array.from({length:r},(t,r)=>e+s*r)}function E(e,t,r,s,n,i=null,a="htk",o=!1){let l;if(null!==i&&"slaney"!==i)throw Error('norm must be one of null or "slaney"');let h=A(x(r,a),x(s,a),t+2),c=function(e,t="htk"){let r=k[t];if(!r)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return"number"==typeof e?r(e):e.map(e=>r(e))}(h,a);if(o){let t=n/(2*e);l=x(Float64Array.from({length:e},(e,r)=>r*t),a),c=h}else l=A(0,Math.floor(n/2),e);let u=function(e,t){let r=Float64Array.from({length:t.length-1},(e,r)=>t[r+1]-t[r]),s=Array.from({length:e.length},()=>Array(t.length));for(let r=0;r<e.length;++r){let n=s[r];for(let s=0;s<t.length;++s)n[s]=t[s]-e[r]}let n=t.length-2,i=Array.from({length:n},()=>Array(e.length));for(let t=0;t<e.length;++t){let e=s[t];for(let s=0;s<n;++s){let n=-e[s]/r[s],a=e[s+2]/r[s+1];i[s][t]=Math.max(0,Math.min(n,a))}}return i}(l,c);if(null!==i&&"slaney"===i)for(let r=0;r<t;++r){let t=u[r],s=2/(c[r+2]-c[r]);for(let r=0;r<e;++r)t[r]*=s}return u}function S(e,t,r,s,n){if(r<=0)throw Error("reference must be greater than zero");if(s<=0)throw Error("min_value must be greater than zero");let i=Math.log10(r=Math.max(s,r));for(let r=0;r<e.length;++r)e[r]=t*Math.log10(Math.max(s,e[r])-i);if(null!==n){if(n<=0)throw Error("db_range must be greater than zero");let t=(0,c.T9)(e)[0]-n;for(let r=0;r<e.length;++r)e[r]=Math.max(e[r],t)}return e}function $(e,t,r,s,{fft_length:n=null,power:i=1,center:a=!0,pad_mode:o="reflect",onesided:h=!0,preemphasis:u=null,mel_filters:d=null,mel_floor:f=1e-10,log_mel:p=null,reference:m=1,min_value:g=1e-10,db_range:_=null,remove_dc_offset:y=null,max_num_frames:w=null,do_pad:b=!0,transpose:v=!1}={}){let x=t.length;if(null===n&&(n=r),r>n)throw Error(`frame_length (${r}) may not be larger than fft_length (${n})`);if(x!==r)throw Error(`Length of the window (${x}) must equal frame_length (${r})`);if(s<=0)throw Error("hop_length must be greater than zero");if(null===i&&null!==d)throw Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(a){if("reflect"!==o)throw Error(`pad_mode="${o}" not implemented yet.`);let t=Math.floor((n-1)/2)+1;e=function(e,t,r){let s=new e.constructor(e.length+t+r),n=e.length-1;for(let r=0;r<e.length;++r)s[t+r]=e[r];for(let r=1;r<=t;++r)s[t-r]=e[(0,l.nK)(r,n)];for(let i=1;i<=r;++i)s[n+t+i]=e[(0,l.nK)(n-i,n)];return s}(e,t,t)}let k=Math.floor(1+Math.floor((e.length-r)/s)),A=h?Math.floor(n/2)+1:n,E=k,I=k;null!==w&&(w>k?b&&(I=w):I=E=w);let O=new c.rG(n),C=new Float64Array(n),M=new Float64Array(O.outputBufferSize),T=Array(E);for(let n=0;n<E;++n){let i=n*s;for(let t=0;t<r;++t)C[t]=e[i+t];if(y){let e=0;for(let t=0;t<r;++t)e+=C[t];let t=e/r;for(let e=0;e<r;++e)C[e]-=t}if(null!==u){for(let e=r-1;e>=1;--e)C[e]-=u*C[e-1];C[0]*=1-u}for(let e=0;e<t.length;++e)C[e]*=t[e];O.realTransform(M,C);let a=Array(A);for(let e=0;e<a.length;++e){let t=e<<1;a[e]=M[t]**2+M[t+1]**2}T[n]=a}if(null!==i&&2!==i){let e=2/i;for(let t=0;t<T.length;++t){let r=T[t];for(let t=0;t<r.length;++t)r[t]**=e}}let R=d.length,U=new Float32Array(R*I),B=v?[I,R]:[R,I];for(let e=0;e<R;++e){let t=d[e];for(let r=0;r<E;++r){let s=T[r],n=0;for(let e=0;e<A;++e)n+=t[e]*s[e];U[v?r*R+e:e*E+r]=Math.max(f,n)}}if(null!==i&&null!==p){let e=Math.min(U.length,E*R);switch(p){case"log":for(let t=0;t<e;++t)U[t]=Math.log(U[t]);break;case"log10":for(let t=0;t<e;++t)U[t]=Math.log10(U[t]);break;case"dB":if(1===i)!function(e,t=1,r=1e-5,s=null){S(e,20,t,r,s)}(U,m,g,_);else if(2===i)!function(e,t=1,r=1e-10,s=null){S(e,10,t,r,s)}(U,m,g,_);else throw Error(`Cannot use log_mel option '${p}' with power ${i}`);break;default:throw Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${p}'`)}}return{data:U,dims:B}}function I(e,t,{periodic:r=!0,frame_length:s=null,center:n=!0}={}){let i,a=r?e+1:e;switch(t){case"boxcar":i=new Float64Array(a).fill(1);break;case"hann":case"hann_window":i=b(a);break;case"povey":i=b(a).map(e=>Math.pow(e,.85));break;default:throw Error(`Unknown window type ${t}.`)}if(r&&(i=i.subarray(0,e)),null===s)return i;if(e>s)throw Error(`Length of the window (${e}) may not be larger than frame_length (${s})`);return i}function O(e,t=.5,r=null,s=!1){let n=e.logits,i=e.pred_boxes,[a,o,l]=n.dims;if(null!==r&&r.length!==a)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let e=0;e<a;++e){let a=null!==r?r[e]:null,u={boxes:[],classes:[],scores:[]},d=n[e],f=i[e];for(let e=0;e<o;++e){let r,n=d[e],i=[];if(s){r=n.sigmoid().data;for(let e=0;e<r.length;++e)r[e]>t&&i.push(e)}else{let e=(0,c.T9)(n.data)[1];if(e===l-1)continue;i.push(e),r=(0,c.Vs)(n.data)}for(let t of i){let s=f[e].data;s=function([e,t,r,s]){return[e-r/2,t-s/2,e+r/2,t+s/2]}(s),null!==a&&(s=s.map((e,t)=>e*a[(t+1)%2])),u.boxes.push(s),u.classes.push(t),u.scores.push(r[t])}}h.push(u)}return h}function C(e,t){if(!(e instanceof Float32Array||e instanceof Float64Array))throw Error(`${t} expects input to be a Float32Array or a Float64Array, but got ${e?.constructor?.name??typeof e} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function M(e,t,r=0,s=null){let n=e/t,i=(0,c.gE)(n)*t;return null!==s&&i>s&&(i=Math.floor(n)*t),i<r&&(i=Math.ceil(n)*t),i}function T([e,t],r){return[Math.max(Math.floor(e/r),1)*r,Math.max(Math.floor(t/r),1)*r]}class R extends l.bV{constructor(e){super(),this.config=e}}class U extends R{constructor(e){super(e),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??!0,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??!0,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&void 0!==this.size.width&&void 0!==this.size.height&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??!1}async thumbnail(e,t,r=2){let s=e.height,n=e.width,i=t.height,a=t.width,o=Math.min(s,i),l=Math.min(n,a);return o===s&&l===n?e:(s>n?l=Math.floor(n*o/s):n>s&&(o=Math.floor(s*l/n)),await e.resize(l,o,{resample:r}))}async crop_margin(e,t=200){let r=e.clone().grayscale(),s=(0,c.jk)(r.data)[0],n=(0,c.T9)(r.data)[0]-s;if(0===n)return e;let i=t/255,a=r.width,o=r.height,l=0,h=0;for(let e=0;e<r.height;++e){let t=e*r.width;for(let c=0;c<r.width;++c)(r.data[t+c]-s)/n<i&&(a=Math.min(a,c),o=Math.min(o,e),l=Math.max(l,c),h=Math.max(h,e))}return e=await e.crop([a,o,l,h])}pad_image(e,t,r,{mode:s="constant",center:n=!1,constant_values:i=0}={}){let a,o,[h,c,u]=t;if("number"==typeof r?(a=r,o=r):(a=r.width,o=r.height),a!==c||o!==h){let r=new Float32Array(a*o*u);if(Array.isArray(i))for(let e=0;e<r.length;++e)r[e]=i[e%u];else 0!==i&&r.fill(i);let[d,f]=n?[Math.floor((a-c)/2),Math.floor((o-h)/2)]:[0,0];for(let t=0;t<h;++t){let s=(t+f)*a,n=t*c;for(let t=0;t<c;++t){let i=(s+t+d)*u,a=(n+t)*u;for(let t=0;t<u;++t)r[i+t]=e[a+t]}}if("symmetric"===s){if(n)throw Error("`center` padding is not supported when `mode` is set to `symmetric`.");let t=h-1,s=c-1;for(let n=0;n<o;++n){let i=n*a,o=(0,l.nK)(n,t)*c;for(let t=0;t<a;++t){if(n<h&&t<c)continue;let a=(i+t)*u,d=(o+(0,l.nK)(t,s))*u;for(let t=0;t<u;++t)r[a+t]=e[d+t]}}}e=r,t=[o,a,u]}return[e,t]}rescale(e){for(let t=0;t<e.length;++t)e[t]=this.rescale_factor*e[t]}get_resize_output_image_size(e,t){let r,s,[n,i]=e.size;if(this.do_thumbnail){let{height:e,width:s}=t;r=Math.min(e,s)}else Number.isInteger(t)?(r=t,s=this.config.max_size??r):void 0!==t&&(r=t.shortest_edge,s=t.longest_edge);if(void 0!==r||void 0!==s){let e=void 0===r?1:Math.max(r/n,r/i),t=n*e,a=i*e,o=void 0===s?1:Math.min(s/t,s/a),l=Math.floor(Number((t*o).toFixed(2))),h=Math.floor(Number((a*o).toFixed(2)));return void 0!==this.size_divisibility&&([l,h]=T([l,h],this.size_divisibility)),[l,h]}if(void 0!==t&&void 0!==t.width&&void 0!==t.height){let e=t.width,r=t.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let t=r/i,s=e/n;Math.abs(1-s)<Math.abs(1-t)?t=s:s=t,r=M(t*i,this.config.ensure_multiple_of),e=M(s*n,this.config.ensure_multiple_of)}return[e,r]}if(void 0!==this.size_divisibility)return T([n,i],this.size_divisibility);throw Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(t)}`)}async resize(e){let[t,r]=this.get_resize_output_image_size(e,this.size);return await e.resize(t,r,{resample:this.resample})}async preprocess(e,{do_normalize:t=null,do_pad:r=null,do_convert_rgb:s=null,do_convert_grayscale:n=null,do_flip_channel_order:i=null}={}){this.do_crop_margin&&(e=await this.crop_margin(e));let[a,o]=e.size;if(s??this.do_convert_rgb?e=e.rgb():n&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let t,r;Number.isInteger(this.crop_size)?(t=this.crop_size,r=this.crop_size):(t=this.crop_size.width,r=this.crop_size.height),e=await e.center_crop(t,r)}let l=[e.height,e.width],h=Float32Array.from(e.data),c=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(h),t??this.do_normalize){let t=this.image_mean;Array.isArray(this.image_mean)||(t=Array(e.channels).fill(t));let r=this.image_std;if(Array.isArray(this.image_std)||(r=Array(e.channels).fill(t)),t.length!==e.channels||r.length!==e.channels)throw Error(`When set to arrays, the length of \`image_mean\` (${t.length}) and \`image_std\` (${r.length}) must match the number of channels in the image (${e.channels}).`);for(let s=0;s<h.length;s+=e.channels)for(let n=0;n<e.channels;++n)h[s+n]=(h[s+n]-t[n])/r[n]}if(r??this.do_pad){if(this.pad_size){let t=this.pad_image(h,[e.height,e.width,e.channels],this.pad_size);[h,c]=t}else if(this.size_divisibility){let[e,t]=T([c[1],c[0]],this.size_divisibility);[h,c]=this.pad_image(h,c,{width:e,height:t})}}if(i??this.do_flip_channel_order){if(3!==c[2])throw Error("Flipping channel order is only supported for RGB images.");for(let e=0;e<h.length;e+=3){let t=h[e];h[e]=h[e+2],h[e+2]=t}}return{original_size:[o,a],reshaped_input_size:l,pixel_values:new u.qY("float32",h,c).permute(2,0,1)}}async _call(e){Array.isArray(e)||(e=[e]);let t=await Promise.all(e.map(e=>this.preprocess(e)));return{pixel_values:(0,u.t$)(t.map(e=>e.pixel_values),0),original_sizes:t.map(e=>e.original_size),reshaped_input_sizes:t.map(e=>e.reshaped_input_size)}}}class B extends U{post_process_semantic_segmentation(e,t=null){let r=e.logits,s=r.dims[0];if(null!==t&&t.length!==s)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let n=[];for(let e=0;e<s;++e){let s=null!==t?t[e]:null,i=r[e];null!==s&&(i=(0,u.GW)(i,s,"bilinear",!1));let[a,o]=s??i.dims.slice(-2),l=new u.qY("int32",new Int32Array(a*o),[a,o]),h=i[0].data;for(let e=1;e<i.dims[0];++e){let t=i[e].data;for(let r=0;r<t.length;++r)t[r]>h[r]&&(h[r]=t[r],l.data[r]=e)}let c=Array(i.dims[0]),d=l.data;for(let e=0;e<d.length;++e){let t=d[e];c[t]=t}let f=c.filter(e=>void 0!==e);n.push({segmentation:l,labels:f})}return n}}class z extends U{}class P extends z{}class j extends U{}class L extends U{}class N extends U{}class F extends U{}class D extends U{}class q extends U{constructor(e){super(e),this.crop_pct=this.config.crop_pct??.875}async resize(e){let t=this.size?.shortest_edge;if(void 0===t)throw Error("Size dictionary must contain 'shortest_edge' key.");if(t<384){let r=Math.floor(t/this.crop_pct),[s,n]=this.get_resize_output_image_size(e,{shortest_edge:r});e=await e.resize(s,n,{resample:this.resample}),e=await e.center_crop(t,t)}else e=await e.resize(t,t,{resample:this.resample});return e}}class W extends q{}class V extends U{}class H extends U{}class X extends U{constructor(e){super(e),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(e=>e*e))}}class K extends U{}class G extends K{}class J extends U{post_process_object_detection(...e){return O(...e)}}class Y extends J{}class Q extends U{}class Z extends U{}class ee extends U{pad_image(e,t,r,s={}){let[n,i,a]=t,o=this.image_mean;Array.isArray(this.image_mean)||(o=Array(a).fill(o));let l=this.image_std;Array.isArray(l)||(l=Array(a).fill(o));let h=o.map((e,t)=>-e/l[t]);return super.pad_image(e,t,r,{center:!0,constant_values:h,...s})}}class et extends ee{}class er extends U{async _call(e){let t=await super._call(e),r=[t.pixel_values.dims[0],64,64],s=new u.qY("int64",new BigInt64Array(r.reduce((e,t)=>e*t)).fill(1n),r);return{...t,pixel_mask:s}}post_process_object_detection(...e){return O(...e)}remove_low_and_no_objects(e,t,r,s){let n=[],i=[],a=[];for(let o=0;o<e.dims[0];++o){let l=e[o],h=t[o],u=(0,c.T9)(l.data)[1];if(u===s)continue;let d=(0,c.Vs)(l.data)[u];d>r&&(n.push(h),i.push(d),a.push(u))}return[n,i,a]}check_segment_validity(e,t,r,s=.5,n=.8){let i=[],a=0,o=0;for(let n=0;n<e.length;++n)e[n]===r&&(i.push(n),++a),t[r].data[n]>=s&&++o;let l=a>0&&o>0;return l&&(l=a/o>n),[l,i]}compute_segments(e,t,r,s,n,i=null,a=null){let[o,l]=a??e[0].dims,h=new u.qY("int32",new Int32Array(o*l),[o,l]),c=[];if(null!==a)for(let t=0;t<e.length;++t)e[t]=(0,u.GW)(e[t],a,"bilinear",!1);let d=new Int32Array(e[0].data.length),f=new Float32Array(e[0].data.length);for(let r=0;r<e.length;++r){let s=t[r];for(let t=0;t<e[r].data.length;++t)e[r].data[t]*=s,e[r].data[t]>f[t]&&(d[t]=r,f[t]=e[r].data[t])}let p=0;for(let i=0;i<r.length;++i){let a=r[i],[o,l]=this.check_segment_validity(d,e,i,s,n);if(o){for(let e of(++p,l))h.data[e]=p;c.push({id:p,label_id:a,score:t[i]})}}return[h,c]}post_process_panoptic_segmentation(e,t=.5,r=.5,s=.8,n=null,i=null){null===n&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),n=new Set);let a=e.logits,o=e.pred_masks.sigmoid(),[l,h,c]=a.dims;if(c-=1,null!==i&&i.length!==l)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let d=[];for(let e=0;e<l;++e){let l=null!==i?i[e]:null,h=a[e],f=o[e],[p,m,g]=this.remove_low_and_no_objects(h,f,t,c);if(0===g.length){let[e,t]=l??f.dims.slice(-2),r=new u.qY("int32",new Int32Array(e*t).fill(-1),[e,t]);d.push({segmentation:r,segments_info:[]});continue}let[_,y]=this.compute_segments(p,m,g,r,s,n,l);d.push({segmentation:_,segments_info:y})}return d}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class es extends U{post_process_object_detection(...e){return O(...e)}}class en extends U{reshape_input_points(e,t,r){e=structuredClone(e);let s=(0,l.ky)(e);if(3===s.length)s=[1,...s],e=[e];else if(4!==s.length)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let s=0;s<e.length;++s){let n=t[s],i=r[s],a=[i[0]/n[0],i[1]/n[1]];for(let t=0;t<e[s].length;++t)for(let r=0;r<e[s][t].length;++r)for(let n=0;n<e[s][t][r].length;++n)e[s][t][r][n]*=a[n]}return new u.qY("float32",Float32Array.from(e.flat(1/0)),s)}add_input_labels(e,t){let r=(0,l.ky)(e);if(2===r.length)r=[1,...r],e=[e];else if(3!==r.length)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(r.some((e,r)=>e!==t.dims[r]))throw Error(`The first ${r.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new u.qY("int64",e.flat(1/0).map(BigInt),r)}async _call(e,t=null,r=null){let s=await super._call(e);if(t&&(s.input_points=this.reshape_input_points(t,s.original_sizes,s.reshaped_input_sizes)),r){if(!s.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");s.input_labels=this.add_input_labels(r,s.input_points)}return s}post_process_masks(e,t,r,{mask_threshold:s=0,binarize:n=!0,pad_size:i=null}={}){let a=[],o=[(i=i??this.pad_size).height,i.width];for(let i=0;i<t.length;++i){let l=t[i],h=r[i],c=e[i],d=[];for(let e=0;e<c.dims[0];++e){let t=c[e],r=(0,u.GW)(t,o,"bilinear",!1);if(r=r.slice(null,[0,h[0]],[0,h[1]]),r=(0,u.GW)(r,l,"bilinear",!1),n){let e=new Uint8Array(r.data.length);for(let t=0;t<r.data.length;++t)r.data[t]>s&&(e[t]=1);r=new u.qY("bool",e,r.dims)}d.push(r)}a.push((0,u.t$)(d))}return a}}class ei extends U{pad_image(e,t,r,s={}){let[n,i,a]=t;return super.pad_image(e,t,{width:i+(r-i%r)%r,height:n+(r-n%r)%r},{mode:"symmetric",center:!1,constant_values:-1,...s})}}class ea extends U{async _call(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);let r=await Promise.all(e.map(e=>this.preprocess(e))),s=await Promise.all(t.map(e=>this.preprocess(e,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,u.t$)(r.map((e,t)=>(0,u.$q)([e.pixel_values,s[t].pixel_values],0)),0),original_sizes:r.map(e=>e.original_size),reshaped_input_sizes:r.map(e=>e.reshaped_input_size)}}}class eo extends R{constructor(e){super(e),this.config.mel_filters??=E(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=I(this.config.n_fft,"hann")}_extract_fbank_features(e){let{data:t,dims:r}=$(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),s=(0,c.T9)(t)[0];for(let e=0;e<t.length;++e)t[e]=(Math.max(t[e],s-8)+4)/4;return{data:t,dims:r}}async _call(e){let t;C(e,"WhisperFeatureExtractor"),e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),t=e.slice(0,this.config.n_samples)):(t=new Float32Array(this.config.n_samples)).set(e);let{data:r,dims:s}=this._extract_fbank_features(t);return{input_features:new u.qY("float32",r,[1,...s])}}}class el extends R{_zero_mean_unit_var_norm(e){let t=e.reduce((e,t)=>e+t,0)/e.length,r=e.reduce((e,r)=>e+(r-t)**2,0)/e.length;return e.map(e=>(e-t)/Math.sqrt(r+1e-7))}async _call(e){C(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let t=e;this.config.do_normalize&&(t=this._zero_mean_unit_var_norm(t));let r=[1,t.length];return{input_values:new u.qY("float32",t,r),attention_mask:new u.qY("int64",new BigInt64Array(t.length).fill(1n),r)}}}class eh extends R{constructor(e){super(e);const t=this.config.sampling_rate,r=E(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let e=0;e<r.length;++e)r[e].push(0);this.mel_filters=r,this.window=I(400,"povey",{periodic:!1})}_extract_fbank_features(e,t){return $(e=e.map(e=>32768*e),this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e,{padding:t=!0,pad_to_multiple_of:r=2,do_normalize_per_mel_bins:s=!0,return_attention_mask:n=!0}={}){let i;C(e,"SeamlessM4TFeatureExtractor");let a=this._extract_fbank_features(e,this.config.max_length);if(s){let[e,t]=a.dims;for(let r=0;r<t;++r){let s=0;for(let n=0;n<e;++n)s+=a.data[n*t+r];let n=s/e,i=0;for(let s=0;s<e;++s)i+=(a.data[s*t+r]-n)**2;let o=Math.sqrt((i/=e-1)+1e-7);for(let s=0;s<e;++s){let e=s*t+r;a.data[e]=(a.data[e]-n)/o}}}if(t){let[e,t]=a.dims,s=e%r;if(s>0){let r=new Float32Array(t*(e+s));r.set(a.data),r.fill(this.config.padding_value,a.data.length);let o=e+s;a={data:r,dims:[o,t]},n&&(i=new u.qY("int64",new BigInt64Array(o),[1,o])).data.fill(1n,0,e)}}let[o,l]=a.dims,h=this.config.stride;if(0!=o%h)throw Error(`The number of frames (${o}) must be a multiple of the stride (${h}).`);let c=new u.qY("float32",a.data,a.dims).view(1,Math.floor(o/h),l*h),d={input_features:c};if(n){let e=c.dims[1],t=new u.qY("int64",new BigInt64Array(e),[1,e]);if(i)for(let e=1,r=0;e<o;e+=h,++r)t.data[r]=i.data[e];else t.data.fill(1n);d.attention_mask=t}return d}}class ec extends R{constructor(e){super(e);const t=this.config.sampling_rate,r=E(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let e=0;e<r.length;++e)r[e].push(0);this.mel_filters=r,this.window=I(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}_extract_fbank_features(e,t){return $(e,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e){C(e,"ASTFeatureExtractor");let t=this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){let e=2*this.std;for(let r=0;r<t.data.length;++r)t.data[r]=(t.data[r]-this.mean)/e}return{input_values:new u.qY("float32",t.data,[1,...t.dims])}}}class eu extends R{constructor(e){super(e),this.mel_filters=E(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=E(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=I(this.config.fft_window_size,"hann")}_get_input_mel(e,t,r,s){let n,i=!1,a=e.length-t;if(a>0)if("rand_trunc"===r){i=!0;let r=Math.floor(Math.random()*(a+1));e=e.subarray(r,r+t),(n=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples)).dims=[1,...n.dims]}else throw Error(`Truncation strategy "${r}" not implemented`);else{if(a<0){let r=new Float64Array(t);if(r.set(e),"repeat"===s)for(let s=e.length;s<t;s+=e.length)r.set(e.subarray(0,Math.min(e.length,t-s)),s);else if("repeatpad"===s)for(let t=e.length;t<-a;t+=e.length)r.set(e,t);e=r}if("fusion"===r)throw Error(`Truncation strategy "${r}" not implemented`);(n=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples)).dims=[1,...n.dims]}return{...n,longer:i}}_extract_fbank_features(e,t,r=null){return $(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:t,log_mel:"dB",max_num_frames:r,do_pad:!1,transpose:!0})}async _call(e,{max_length:t=null}={}){C(e,"ClapFeatureExtractor");let r=this._get_input_mel(e,t??this.config.nb_max_samples,this.config.truncation,this.config.padding);return{input_features:new u.qY("float32",r.data,[1,...r.dims])}}}class ed extends R{}class ef extends l.bV{constructor(e){super(),this.feature_extractor=e}async _call(e,...t){return await this.feature_extractor(e,...t)}}class ep extends ef{async _call(...e){return await this.feature_extractor(...e)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}reshape_input_points(...e){return this.feature_extractor.reshape_input_points(...e)}}class em extends ef{async _call(e){return await this.feature_extractor(e)}}class eg extends ef{async _call(e){return await this.feature_extractor(e)}}class e_ extends ef{async _call(e){return await this.feature_extractor(e)}}class ey extends ef{}class ew{static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor:U,WhisperFeatureExtractor:eo,ViTFeatureExtractor:V,MobileViTFeatureExtractor:K,MobileViTImageProcessor:G,OwlViTFeatureExtractor:J,Owlv2ImageProcessor:Y,CLIPFeatureExtractor:N,ChineseCLIPFeatureExtractor:F,SiglipImageProcessor:D,ConvNextFeatureExtractor:q,ConvNextImageProcessor:W,SegformerFeatureExtractor:B,BitImageProcessor:j,DPTImageProcessor:P,DPTFeatureExtractor:z,GLPNFeatureExtractor:L,BeitFeatureExtractor:Z,DeiTFeatureExtractor:Q,DetrFeatureExtractor:er,YolosFeatureExtractor:es,DonutFeatureExtractor:ee,NougatImageProcessor:et,EfficientNetImageProcessor:X,ViTImageProcessor:H,VitMatteImageProcessor:ea,SamImageProcessor:en,Swin2SRImageProcessor:ei,Wav2Vec2FeatureExtractor:el,SeamlessM4TFeatureExtractor:eh,SpeechT5FeatureExtractor:ed,ASTFeatureExtractor:ec,ClapFeatureExtractor:eu};static PROCESSOR_CLASS_MAPPING={WhisperProcessor:em,Wav2Vec2ProcessorWithLM:eg,SamProcessor:ep,SpeechT5Processor:e_,OwlViTProcessor:ey};static async from_pretrained(e,{progress_callback:t=null,config:r=null,cache_dir:s=null,local_files_only:n=!1,revision:i="main"}={}){let a=r??await (0,h.wc)(e,"preprocessor_config.json",!0,{progress_callback:t,config:r,cache_dir:s,local_files_only:n,revision:i}),o=a.feature_extractor_type??a.image_processor_type,l=this.FEATURE_EXTRACTOR_CLASS_MAPPING[o];if(!l)if(void 0!==a.size)console.warn(`Feature extractor type "${o}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),l=U;else throw Error(`Unknown Feature Extractor type: ${o}`);return new(this.PROCESSOR_CLASS_MAPPING[a.processor_class]??ef)(new l(a))}}async function eb(e){return Array.isArray(e)||(e=[e]),await Promise.all(e.map(e=>y.read(e)))}async function ev(e,t){return Array.isArray(e)||(e=[e]),await Promise.all(e.map(e=>"string"==typeof e||e instanceof URL?w(e,t):e instanceof Float64Array?new Float32Array(e):e))}function ex(e,t){t&&(e=e.map(e=>0|e));let[r,s,n,i]=e;return{xmin:r,ymin:s,xmax:n,ymax:i}}class ek extends l.bV{constructor({task:e,model:t,tokenizer:r=null,processor:s=null}){super(),this.task=e,this.model=t,this.tokenizer=r,this.processor=s}async dispose(){await this.model.dispose()}}class eA extends ek{constructor(e){super(e)}async _call(e,{topk:t=1}={}){let r=this.tokenizer(e,{padding:!0,truncation:!0}),s=await this.model(r),n="multi_label_classification"===this.model.config.problem_type?e=>e.sigmoid().data:e=>(0,c.Vs)(e.data),i=this.model.config.id2label,a=[];for(let e of s.logits){let r=n(e),s=(0,c.Em)(r,t).map(e=>({label:i[e[0]],score:e[1]}));1===t?a.push(...s):a.push(s)}return Array.isArray(e)||1===t?a:a[0]}}class eE extends ek{constructor(e){super(e)}async _call(e,{ignore_labels:t=["O"]}={}){let r=Array.isArray(e),s=this.tokenizer(r?e:[e],{padding:!0,truncation:!0}),n=(await this.model(s)).logits,i=this.model.config.id2label,a=[];for(let e=0;e<n.dims[0];++e){let r=s.input_ids[e],o=n[e],l=[];for(let e=0;e<o.dims[0];++e){let s=o[e],n=(0,c.T9)(s.data)[1],a=i?i[n]:`LABEL_${n}`;if(t.includes(a))continue;let h=this.tokenizer.decode([r[e].item()],{skip_special_tokens:!0});if(""===h)continue;let u=(0,c.Vs)(s.data);l.push({entity:a,score:u[n],index:e,word:h,start:null,end:null})}a.push(l)}return r?a:a[0]}}class eS extends ek{constructor(e){super(e)}async _call(e,t,{topk:r=1}={}){let s=this.tokenizer(e,{text_pair:t,padding:!0,truncation:!0}),n=await this.model(s),i=[];for(let e=0;e<n.start_logits.dims[0];++e){let t=s.input_ids[e],a=t.indexOf(this.tokenizer.sep_token_id),o=Array.from((0,c.Vs)(n.start_logits[e].data)).map((e,t)=>[e,t]).filter(e=>e[1]>a),h=Array.from((0,c.Vs)(n.end_logits[e].data)).map((e,t)=>[e,t]).filter(e=>e[1]>a),u=(0,l.qM)(o,h).filter(e=>e[0][1]<=e[1][1]).map(e=>[e[0][1],e[1][1],e[0][0]*e[1][0]]).sort((e,t)=>t[2]-e[2]);for(let e=0;e<Math.min(u.length,r);++e){let[r,s,n]=u[e],a=[...t].slice(r,s+1),o=this.tokenizer.decode(a,{skip_special_tokens:!0});i.push({answer:o,score:n})}}return 1===r?i[0]:i}}class e$ extends ek{constructor(e){super(e)}async _call(e,{topk:t=5}={}){let r=this.tokenizer(e,{padding:!0,truncation:!0}),s=await this.model(r),n=[];for(let e=0;e<r.input_ids.dims[0];++e){let i=r.input_ids[e],a=i.indexOf(this.tokenizer.mask_token_id);if(-1===a)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);let o=s.logits[e][a],l=(0,c.Em)((0,c.Vs)(o.data),t);n.push(l.map(e=>{let t=[...i];return t[a]=e[0],{score:e[1],token:e[0],token_str:this.tokenizer.model.vocab[e[0]],sequence:this.tokenizer.decode(t,{skip_special_tokens:!0})}}))}return Array.isArray(e)?n:n[0]}}class eI extends ek{_key="generated_text";constructor(e){super(e)}async _call(e,t={}){let r;Array.isArray(e)||(e=[e]),this.model.config.prefix&&(e=e.map(e=>this.model.config.prefix+e));let s=this.model.config.task_specific_params;s&&s[this.task]&&s[this.task].prefix&&(e=e.map(e=>s[this.task].prefix+e));let n=this.tokenizer,i={padding:!0,truncation:!0};r=this instanceof eC&&"_build_translation_inputs"in n?n._build_translation_inputs(e,i,t).input_ids:n(e,i).input_ids;let a=await this.model.generate(r,t);return n.batch_decode(a,{skip_special_tokens:!0}).map(e=>({[this._key]:e}))}}class eO extends eI{_key="summary_text";constructor(e){super(e)}}class eC extends eI{_key="translation_text";constructor(e){super(e)}}function eM(e){return Array.isArray(e)&&e.every(e=>"role"in e&&"content"in e)}class eT extends ek{constructor(e){super(e)}async _call(e,t={}){let r,s,n=!1,i=!1;if("string"==typeof e)r=e=[e];else if(Array.isArray(e)&&e.every(e=>"string"==typeof e))n=!0,r=e;else{if(eM(e))e=[e];else if(Array.isArray(e)&&e.every(eM))n=!0;else throw Error("Input must be a string, an array of strings, a Chat, or an array of Chats");i=!0,r=e.map(e=>this.tokenizer.apply_chat_template(e,{tokenize:!1,add_generation_prompt:!0}))}let a=t.add_special_tokens??!1,o=!i&&(t.return_full_text??!0);this.tokenizer.padding_side="left";let{input_ids:l,attention_mask:h}=this.tokenizer(r,{add_special_tokens:a,padding:!0,truncation:!0}),c=await this.model.generate(l,t,null,{inputs_attention_mask:h}),u=this.tokenizer.batch_decode(c,{skip_special_tokens:!0});!o&&l.dims.at(-1)>0&&(s=this.tokenizer.batch_decode(l,{skip_special_tokens:!0}).map(e=>e.length));let d=Array.from({length:e.length},e=>[]);for(let t=0;t<u.length;++t){let r=Math.floor(t/c.length*e.length);s&&(u[t]=u[t].slice(s[r])),d[r].push({generated_text:i?[...e[r],{role:"assistant",content:u[t]}]:u[t]})}return n||1!==d.length?d:d[0]}}class eR extends ek{constructor(e){super(e),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([e,t])=>[e.toLowerCase(),t])),this.entailment_id=this.label2id.entailment,void 0===this.entailment_id&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,void 0===this.contradiction_id&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(e,t,{hypothesis_template:r="This example is {}.",multi_label:s=!1}={}){let n=Array.isArray(e);n||(e=[e]),Array.isArray(t)||(t=[t]);let i=t.map(e=>r.replace("{}",e)),a=s||1===t.length,o=[];for(let r of e){let e=[];for(let t of i){let s=this.tokenizer(r,{text_pair:t,padding:!0,truncation:!0}),n=await this.model(s);a?e.push([n.logits.data[this.contradiction_id],n.logits.data[this.entailment_id]]):e.push(n.logits.data[this.entailment_id])}let s=(a?e.map(e=>(0,c.Vs)(e)[1]):(0,c.Vs)(e)).map((e,t)=>[e,t]).sort((e,t)=>t[0]-e[0]);o.push({sequence:r,labels:s.map(e=>t[e[1]]),scores:s.map(e=>e[0])})}return n?o:o[0]}}class eU extends ek{constructor(e){super(e)}async _call(e,{pooling:t="none",normalize:r=!1,quantize:s=!1,precision:n="binary"}={}){let i=this.tokenizer(e,{padding:!0,truncation:!0}),a=await this.model(i),o=a.last_hidden_state??a.logits??a.token_embeddings;if("none"===t);else if("mean"===t)o=(0,u.X7)(o,i.attention_mask);else if("cls"===t)o=o.slice(null,0);else throw Error(`Pooling method '${t}' not supported.`);return r&&(o=o.normalize(2,-1)),s&&(o=(0,u.J)(o,n)),o}}class eB extends ek{constructor(e){super(e)}async _call(e,{pool:t=null}={}){let r,s=await eb(e),{pixel_values:n}=await this.processor(s),i=await this.model({pixel_values:n});if(t){if(!("pooler_output"in i))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");r=i.pooler_output}else r=i.last_hidden_state??i.logits??i.image_embeds;return r}}class ez extends ek{constructor(e){super(e)}async _call(e,{topk:t=null}={}){let r=!Array.isArray(e),s=this.processor.feature_extractor.config.sampling_rate,n=await ev(e,s),i=this.model.config.id2label,a=[];for(let e of n){let r=await this.processor(e),s=(await this.model(r)).logits[0],n=(0,c.Em)((0,c.Vs)(s.data),t).map(e=>({label:i[e[0]],score:e[1]}));1===t?a.push(...n):a.push(n)}return r&&1!==t?a[0]:a}}class eP extends ek{constructor(e){super(e)}async _call(e,t,{hypothesis_template:r="This is a sound of {}."}={}){let s=!Array.isArray(e);s&&(e=[e]);let n=t.map(e=>r.replace("{}",e)),i=this.tokenizer(n,{padding:!0,truncation:!0}),a=this.processor.feature_extractor.config.sampling_rate,o=await ev(e,a),l=[];for(let e of o){let r=await this.processor(e),s=await this.model({...i,...r}),n=(0,c.Vs)(s.logits_per_audio.data);l.push([...n].map((e,r)=>({score:e,label:t[r]})))}return s?l[0]:l}}class ej extends ek{constructor(e){super(e)}async _call(e,t={}){switch(this.model.config.model_type){case"whisper":return this._call_whisper(e,t);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(e,t);default:throw Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(e,t={}){t.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),t.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');let r=!Array.isArray(e);r&&(e=[e]);let s=this.processor.feature_extractor.config.sampling_rate,n=await ev(e,s),i=[];for(let e of n){let t=await this.processor(e),r=(await this.model(t)).logits[0],s=[];for(let e of r)s.push((0,c.T9)(e.data)[1]);let n=this.tokenizer.decode(s);i.push({text:n})}return r?i[0]:i}async _call_whisper(e,t={}){let r=t.return_timestamps??!1,s=t.chunk_length_s??0,n=t.chunk_callback??null,i=t.force_full_sequences??!1,a=t.stride_length_s??null;"word"===r&&(t.return_token_timestamps=!0);let o=(0,l.uY)(t,"language",null),h=(0,l.uY)(t,"task",null);if(o||h||r){if(t.forced_decoder_ids)throw Error("Cannot specify `language`/`task`/`return_timestamps` and `forced_decoder_ids` at the same time.");let e=this.tokenizer.get_decoder_prompt_ids({language:o,task:h,no_timestamps:!r});e.length>0&&(t.forced_decoder_ids=e)}let u=!Array.isArray(e);u&&(e=[e]);let d=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,f=this.processor.feature_extractor.config.hop_length,p=this.processor.feature_extractor.config.sampling_rate,m=await ev(e,p),g=[];for(let e of m){let o=[];if(s>0){if(null===a)a=s/6;else if(s<=a)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let t=p*s,r=p*a,n=t-2*r,i=0;for(;i<e.length;){let s=e.subarray(i,i+t),a=await this.processor(s),l=0===i,h=i+n>=e.length;o.push({stride:[s.length,l?0:r,h?0:r],input_features:a.input_features,is_last:h}),i+=n}}else o=[{stride:[e.length,0,0],input_features:(await this.processor(e)).input_features,is_last:!0}];for(let e of o){t.num_frames=Math.floor(e.stride[0]/f);let s=await this.model.generate(e.input_features,t);"word"===r?(e.tokens=s.sequences[0],e.token_timestamps=s.token_timestamps.tolist()[0].map(e=>(0,c.LI)(e,2))):e.tokens=s[0],e.stride=e.stride.map(e=>e/p),null!==n&&n(e)}let[l,h]=this.tokenizer._decode_asr(o,{time_precision:d,return_timestamps:r,force_full_sequences:i});g.push({text:l,...h})}return u?g[0]:g}}class eL extends ek{constructor(e){super(e)}async _call(e,t={}){let r=Array.isArray(e),s=await eb(e),{pixel_values:n}=await this.processor(s),i=[];for(let e of n){e.dims=[1,...e.dims];let r=await this.model.generate(e,t),s=this.tokenizer.batch_decode(r,{skip_special_tokens:!0}).map(e=>({generated_text:e.trim()}));i.push(s)}return r?i:i[0]}}class eN extends ek{constructor(e){super(e)}async _call(e,{topk:t=1}={}){let r=Array.isArray(e),s=await eb(e),{pixel_values:n}=await this.processor(s),i=await this.model({pixel_values:n}),a=this.model.config.id2label,o=[];for(let e of i.logits){let r=(0,c.Em)((0,c.Vs)(e.data),t).map(e=>({label:a[e[0]],score:e[1]}));1===t?o.push(...r):o.push(r)}return r||1===t?o:o[0]}}class eF extends ek{constructor(e){super(e),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(e,{threshold:t=.5,mask_threshold:r=.5,overlap_mask_area_threshold:s=.8,label_ids_to_fuse:n=null,target_sizes:i=null,subtask:a=null}={}){if(Array.isArray(e)&&1!==e.length)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let o=await eb(e),l=o.map(e=>[e.height,e.width]),{pixel_values:h,pixel_mask:c}=await this.processor(o),u=await this.model({pixel_values:h,pixel_mask:c}),d=null;if(null!==a)d=this.subtasks_mapping[a];else for(let[e,t]of Object.entries(this.subtasks_mapping))if(t in this.processor.feature_extractor){d=this.processor.feature_extractor[t].bind(this.processor.feature_extractor),a=e;break}let f=this.model.config.id2label,p=[];if("panoptic"===a||"instance"===a){let e=d(u,t,r,s,n,i??l)[0],a=e.segmentation;for(let t of e.segments_info){let e=new Uint8ClampedArray(a.data.length);for(let r=0;r<a.data.length;++r)a.data[r]===t.id&&(e[r]=255);let r=new y(e,a.dims[1],a.dims[0],1);p.push({score:t.score,label:f[t.label_id],mask:r})}}else if("semantic"===a){let{segmentation:e,labels:t}=d(u,i??l)[0];for(let r of t){let t=new Uint8ClampedArray(e.data.length);for(let s=0;s<e.data.length;++s)e.data[s]===r&&(t[s]=255);let s=new y(t,e.dims[1],e.dims[0],1);p.push({score:null,label:f[r],mask:s})}}else throw Error(`Subtask ${a} not supported.`);return p}}class eD extends ek{constructor(e){super(e)}async _call(e,t,{hypothesis_template:r="This is a photo of {}"}={}){let s=Array.isArray(e),n=await eb(e),i=t.map(e=>r.replace("{}",e)),a=this.tokenizer(i,{padding:"siglip"!==this.model.config.model_type||"max_length",truncation:!0}),{pixel_values:o}=await this.processor(n),l=await this.model({...a,pixel_values:o}),h="siglip"===this.model.config.model_type?e=>e.sigmoid().data:e=>(0,c.Vs)(e.data),u=[];for(let e of l.logits_per_image){let r=[...h(e)].map((e,r)=>({score:e,label:t[r]}));r.sort((e,t)=>t.score-e.score),u.push(r)}return s?u:u[0]}}class eq extends ek{constructor(e){super(e)}async _call(e,{threshold:t=.9,percentage:r=!1}={}){let s=Array.isArray(e);if(s&&1!==e.length)throw Error("Object detection pipeline currently only supports a batch size of 1.");let n=await eb(e),i=r?null:n.map(e=>[e.height,e.width]),{pixel_values:a,pixel_mask:o}=await this.processor(n),l=await this.model({pixel_values:a,pixel_mask:o}),h=this.processor.feature_extractor.post_process_object_detection(l,t,i),c=this.model.config.id2label,u=h.map(e=>e.boxes.map((t,s)=>({score:e.scores[s],label:c[e.classes[s]],box:ex(t,!r)})));return s?u:u[0]}}class eW extends ek{constructor(e){super(e)}async _call(e,t,{threshold:r=.1,topk:s=null,percentage:n=!1}={}){let i=Array.isArray(e),a=await eb(e),o=this.tokenizer(t,{padding:!0,truncation:!0}),l=await this.processor(a),h=[];for(let e=0;e<a.length;++e){let i=a[e],c=n?null:[[i.height,i.width]],u=l.pixel_values[e].unsqueeze_(0),d=await this.model({...o,pixel_values:u}),f=this.processor.feature_extractor.post_process_object_detection(d,r,c,!0)[0],p=f.boxes.map((e,r)=>({score:f.scores[r],label:t[f.classes[r]],box:ex(e,!n)})).sort((e,t)=>t.score-e.score);null!==s&&(p=p.slice(0,s)),h.push(p)}return i?h:h[0]}}class eV extends ek{constructor(e){super(e)}async _call(e,t,r={}){let s=(await eb(e))[0],{pixel_values:n}=await this.processor(s),i=`<s_docvqa><s_question>${t}</s_question><s_answer>`,a=this.tokenizer(i,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,o=await this.model.generate(n,{...r,decoder_input_ids:a,max_length:this.model.config.decoder.max_position_embeddings}),l=this.tokenizer.batch_decode(o)[0].match(/<s_answer>(.*?)<\/s_answer>/),h=null;return l&&l.length>=2&&(h=l[1].trim()),[{answer:h}]}}class eH extends ek{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(e){super(e),this.vocoder=e.vocoder??null}async _call(e,{speaker_embeddings:t=null}={}){return this.processor?this._call_text_to_spectrogram(e,{speaker_embeddings:t}):this._call_text_to_waveform(e)}async _call_text_to_waveform(e){let t=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:r}=await this.model(t),s=this.model.config.sampling_rate;return{audio:r.data,sampling_rate:s}}async _call_text_to_spectrogram(e,{speaker_embeddings:t}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await o.rKH.from_pretrained(this.DEFAULT_VOCODER_ID,{quantized:!1})),("string"==typeof t||t instanceof URL)&&(t=new Float32Array(await (await fetch(t)).arrayBuffer())),t instanceof Float32Array)t=new u.qY("float32",t,[1,t.length]);else if(!(t instanceof u.qY))throw Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:r}=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:s}=await this.model.generate_speech(r,t,{vocoder:this.vocoder}),n=this.processor.feature_extractor.config.sampling_rate;return{audio:s.data,sampling_rate:n}}}class eX extends ek{constructor(e){super(e)}async _call(e){let t=await eb(e),r=await this.processor(t),s=await this.model(r),n=[];for(let e of s.reconstruction){let t=e.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");n.push(y.fromTensor(t))}return n.length>1?n:n[0]}}class eK extends ek{constructor(e){super(e)}async _call(e){let t=await eb(e),r=await this.processor(t),{predicted_depth:s}=await this.model(r),n=[];for(let e=0;e<t.length;++e){let r=(0,u.GW)(s[e],t[e].size.reverse(),"bilinear",!1),i=r.mul_(255/(0,c.T9)(r.data)[0]).to("uint8");n.push({predicted_depth:s[e],depth:y.fromTensor(i)})}return n.length>1?n:n[0]}}let eG=Object.freeze({"text-classification":{tokenizer:a.v6,pipeline:eA,model:o.jQR,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:a.v6,pipeline:eE,model:o.TUv,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:a.v6,pipeline:eS,model:o.yGT,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:a.v6,pipeline:e$,model:o.wju,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:a.v6,pipeline:eO,model:o.BRf,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:a.v6,pipeline:eC,model:o.BRf,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:a.v6,pipeline:eI,model:o.BRf,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:a.v6,pipeline:eT,model:o.W6E,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:a.v6,pipeline:eR,model:o.jQR,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:ez,model:o.m68,processor:ew,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:a.v6,pipeline:eP,model:o.rKH,processor:ew,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:a.v6,pipeline:ej,model:[o.MOY,o._TZ],processor:ew,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:a.v6,pipeline:eH,model:[o.V9g,o.ZIt],processor:[ew,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:a.v6,pipeline:eL,model:o.db0,processor:ew,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:eN,model:o.JP3,processor:ew,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:eF,model:[o.vTA,o.wrZ],processor:ew,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:a.v6,pipeline:eD,model:o.rKH,processor:ew,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:eq,model:o.Yd3,processor:ew,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:a.v6,pipeline:eW,model:o.gqD,processor:ew,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:a.v6,pipeline:eV,model:o.nuw,processor:ew,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:eX,model:o.FJW,processor:ew,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:eK,model:o.QNG,processor:ew,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:a.v6,pipeline:eU,model:o.rKH,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:ew,pipeline:eB,model:[o.w0O,o.rKH],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),eJ=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function eY(e,t=null,{quantized:r=!0,progress_callback:s=null,config:n=null,cache_dir:i=null,local_files_only:a=!1,revision:o="main",model_file_name:h=null}={}){let c=eG[(e=eJ[e]??e).split("_",1)[0]];if(!c)throw Error(`Unsupported pipeline: ${e}. Must be one of [${Object.keys(eG)}]`);t||(t=c.default.model,console.log(`No model specified. Using default model: "${t}".`));let u=new Map([["tokenizer",c.tokenizer],["model",c.model],["processor",c.processor]]),d=await eQ(u,t,{quantized:r,progress_callback:s,config:n,cache_dir:i,local_files_only:a,revision:o,model_file_name:h});return d.task=e,(0,l._e)(s,{status:"ready",task:e,model:t}),new c.pipeline(d)}async function eQ(e,t,r){let s=Object.create(null),n=[];for(let[i,a]of e.entries()){let e;a&&(e=Array.isArray(a)?new Promise(async(e,s)=>{let n;for(let s of a){if(null===s)return void e(null);try{e(await s.from_pretrained(t,r));return}catch(e){n=e}}s(n)}):a.from_pretrained(t,r),s[i]=e,n.push(e))}for(let[e,t]of(await Promise.all(n),Object.entries(s)))s[e]=await t;return s}r(89148)},48901:(e,t,r)=>{"use strict";function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,n,i,a,o=[],l=!0,h=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(s=i.call(r)).done)&&(o.push(s.value),o.length!==t);l=!0);}catch(e){h=!0,n=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw n}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(t,{A:()=>n})},48904:(e,t,r)=>{"use strict";r.d(t,{Bj:()=>X});var s=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"}),n=Object.freeze({set:s.Set,for:s.For,in:s.In,is:s.Is,if:s.If,else:s.Else,endif:s.EndIf,elif:s.ElseIf,endfor:s.EndFor,and:s.And,or:s.Or,not:s.Not,"not in":s.NotIn,true:s.BooleanLiteral,false:s.BooleanLiteral}),i=class{constructor(e,t){this.value=e,this.type=t}};function a(e){return/\w/.test(e)}function o(e){return/[0-9]/.test(e)}var l=[["{%",s.OpenStatement],["%}",s.CloseStatement],["{{",s.OpenExpression],["}}",s.CloseExpression],["(",s.OpenParen],[")",s.CloseParen],["{",s.OpenCurlyBracket],["}",s.CloseCurlyBracket],["[",s.OpenSquareBracket],["]",s.CloseSquareBracket],[",",s.Comma],[".",s.Dot],[":",s.Colon],["|",s.Pipe],["<=",s.ComparisonBinaryOperator],[">=",s.ComparisonBinaryOperator],["==",s.ComparisonBinaryOperator],["!=",s.ComparisonBinaryOperator],["<",s.ComparisonBinaryOperator],[">",s.ComparisonBinaryOperator],["+",s.AdditiveBinaryOperator],["-",s.AdditiveBinaryOperator],["*",s.MultiplicativeBinaryOperator],["/",s.MultiplicativeBinaryOperator],["%",s.MultiplicativeBinaryOperator],["=",s.Equals]],h=new Map([["n","\n"],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]),c=class{type="Statement"},u=class extends c{constructor(e){super(),this.body=e}type="Program"},d=class extends c{constructor(e,t,r){super(),this.test=e,this.body=t,this.alternate=r}type="If"},f=class extends c{constructor(e,t,r){super(),this.loopvar=e,this.iterable=t,this.body=r}type="For"},p=class extends c{constructor(e,t){super(),this.assignee=e,this.value=t}type="Set"},m=class extends c{type="Expression"},g=class extends m{constructor(e,t,r){super(),this.object=e,this.property=t,this.computed=r}type="MemberExpression"},_=class extends m{constructor(e,t){super(),this.callee=e,this.args=t}type="CallExpression"},y=class extends m{constructor(e){super(),this.value=e}type="Identifier"},w=class extends m{constructor(e){super(),this.value=e}type="Literal"},b=class extends w{type="NumericLiteral"},v=class extends w{type="StringLiteral"},x=class extends w{type="BooleanLiteral"},k=class extends w{type="ArrayLiteral"},A=class extends w{type="TupleLiteral"},E=class extends w{type="ObjectLiteral"},S=class extends m{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}type="BinaryExpression"},$=class extends m{constructor(e,t){super(),this.operand=e,this.filter=t}type="FilterExpression"},I=class extends m{constructor(e,t,r){super(),this.operand=e,this.negate=t,this.test=r}type="TestExpression"},O=class extends m{constructor(e,t){super(),this.operator=e,this.argument=t}type="UnaryExpression"},C=class extends m{constructor(e,t,r){super(),this.start=e,this.stop=t,this.step=r}type="SliceExpression"},M=class extends m{constructor(e,t){super(),this.key=e,this.value=t}type="KeywordArgumentExpression"};function T(e,t,r=1){void 0===t&&(t=e,e=0);let s=[];for(let n=e;n<t;n+=r)s.push(n);return s}function R(e,t,r,s=1){let n=Math.sign(s);n>=0?(t=(t??=0)<0?Math.max(e.length+t,0):Math.min(t,e.length),r=(r??=e.length)<0?Math.max(e.length+r,0):Math.min(r,e.length)):(t=(t??=e.length-1)<0?Math.max(e.length+t,-1):Math.min(t,e.length-1),r=(r??=-1)<-1?Math.max(e.length+r,-1):Math.min(r,e.length-1));let i=[];for(let a=t;n*a<n*r;a+=s)i.push(e[a]);return i}function U(e){return e.replace(/\b\w/g,e=>e.toUpperCase())}var B=class{type="RuntimeValue";value;builtins=new Map;constructor(e){this.value=e}__bool__(){return new j(!!this.value)}},z=class extends B{type="NumericValue"},P=class extends B{type="StringValue";builtins=new Map([["upper",new D(()=>new P(this.value.toUpperCase()))],["lower",new D(()=>new P(this.value.toLowerCase()))],["strip",new D(()=>new P(this.value.trim()))],["title",new D(()=>new P(U(this.value)))],["length",new z(this.value.length)]])},j=class extends B{type="BooleanValue"},L=class extends B{type="ObjectValue";__bool__(){return new j(this.value.size>0)}builtins=new Map([["get",new D(([e,t])=>{if(!(e instanceof P))throw Error(`Object key must be a string: got ${e.type}`);return this.value.get(e.value)??t??new q})],["items",new D(()=>new N(Array.from(this.value.entries()).map(([e,t])=>new N([new P(e),t]))))]])},N=class extends B{type="ArrayValue";builtins=new Map([["length",new z(this.value.length)]]);__bool__(){return new j(this.value.length>0)}},F=class extends N{type="TupleValue"},D=class extends B{type="FunctionValue"},q=class extends B{type="NullValue"},W=class extends B{type="UndefinedValue"},V=class{constructor(e){this.parent=e}variables=new Map([["namespace",new D(e=>{if(0===e.length)return new L(new Map);if(1!==e.length||!(e[0]instanceof L))throw Error("`namespace` expects either zero arguments or a single object argument");return e[0]})]]);tests=new Map([["boolean",e=>"BooleanValue"===e.type],["callable",e=>e instanceof D],["odd",e=>{if("NumericValue"!==e.type)throw Error(`Cannot apply test "odd" to type: ${e.type}`);return e.value%2!=0}],["even",e=>{if("NumericValue"!==e.type)throw Error(`Cannot apply test "even" to type: ${e.type}`);return e.value%2==0}],["false",e=>"BooleanValue"===e.type&&!e.value],["true",e=>"BooleanValue"===e.type&&e.value],["number",e=>"NumericValue"===e.type],["integer",e=>"NumericValue"===e.type&&Number.isInteger(e.value)],["iterable",e=>e instanceof N||e instanceof P],["lower",e=>{let t=e.value;return"StringValue"===e.type&&t===t.toLowerCase()}],["upper",e=>{let t=e.value;return"StringValue"===e.type&&t===t.toUpperCase()}],["none",e=>"NullValue"===e.type],["defined",e=>"UndefinedValue"!==e.type],["undefined",e=>"UndefinedValue"===e.type],["equalto",(e,t)=>e.value===t.value]]);set(e,t){return this.declareVariable(e,function e(t){switch(typeof t){case"number":return new z(t);case"string":return new P(t);case"boolean":return new j(t);case"object":if(null===t)return new q;if(Array.isArray(t))return new N(t.map(e));return new L(new Map(Object.entries(t).map(([t,r])=>[t,e(r)])));case"function":return new D((r,s)=>e(t(...r.map(e=>e.value))??null));default:throw Error(`Cannot convert to runtime value: ${t}`)}}(t))}declareVariable(e,t){if(this.variables.has(e))throw SyntaxError(`Variable already declared: ${e}`);return this.variables.set(e,t),t}setVariable(e,t){return this.variables.set(e,t),t}resolve(e){if(this.variables.has(e))return this;if(this.parent)return this.parent.resolve(e);throw Error(`Unknown variable: ${e}`)}lookupVariable(e){try{return this.resolve(e).variables.get(e)??new W}catch{return new W}}},H=class{global;constructor(e){this.global=e??new V}run(e){return this.evaluate(e,this.global)}evaluateBinaryExpression(e,t){let r=this.evaluate(e.left,t);switch(e.operator.value){case"and":return r.__bool__().value?this.evaluate(e.right,t):r;case"or":return r.__bool__().value?r:this.evaluate(e.right,t)}let s=this.evaluate(e.right,t);switch(e.operator.value){case"==":return new j(r.value==s.value);case"!=":return new j(r.value!=s.value)}if(r instanceof W||s instanceof W)throw Error("Cannot perform operation on undefined values");if(r instanceof q||s instanceof q)throw Error("Cannot perform operation on null values");if(r instanceof z&&s instanceof z)switch(e.operator.value){case"+":return new z(r.value+s.value);case"-":return new z(r.value-s.value);case"*":return new z(r.value*s.value);case"/":return new z(r.value/s.value);case"%":return new z(r.value%s.value);case"<":return new j(r.value<s.value);case">":return new j(r.value>s.value);case">=":return new j(r.value>=s.value);case"<=":return new j(r.value<=s.value)}else if(r instanceof N&&s instanceof N){if("+"===e.operator.value)return new N(r.value.concat(s.value))}else if(s instanceof N){let t=void 0!==s.value.find(e=>e.value===r.value);switch(e.operator.value){case"in":return new j(t);case"not in":return new j(!t)}}if((r instanceof P||s instanceof P)&&"+"===e.operator.value)return new P(r.value.toString()+s.value.toString());if(r instanceof P&&s instanceof P)switch(e.operator.value){case"in":return new j(s.value.includes(r.value));case"not in":return new j(!s.value.includes(r.value))}if(r instanceof P&&s instanceof L)switch(e.operator.value){case"in":return new j(s.value.has(r.value));case"not in":return new j(!s.value.has(r.value))}throw SyntaxError(`Unknown operator "${e.operator.value}" between ${r.type} and ${s.type}`)}evaluateFilterExpression(e,t){let r=this.evaluate(e.operand,t);if("Identifier"===e.filter.type){let t=e.filter;if(r instanceof N)switch(t.value){case"list":return r;case"first":return r.value[0];case"last":return r.value[r.value.length-1];case"length":return new z(r.value.length);case"reverse":return new N(r.value.reverse());case"sort":return new N(r.value.sort((e,t)=>{if(e.type!==t.type)throw Error(`Cannot compare different types: ${e.type} and ${t.type}`);switch(e.type){case"NumericValue":return e.value-t.value;case"StringValue":return e.value.localeCompare(t.value);default:throw Error(`Cannot compare type: ${e.type}`)}}));default:throw Error(`Unknown ArrayValue filter: ${t.value}`)}if(r instanceof P)switch(t.value){case"length":return new z(r.value.length);case"upper":return new P(r.value.toUpperCase());case"lower":return new P(r.value.toLowerCase());case"title":return new P(U(r.value));case"capitalize":return new P(r.value.charAt(0).toUpperCase()+r.value.slice(1));case"trim":return new P(r.value.trim());default:throw Error(`Unknown StringValue filter: ${t.value}`)}if(r instanceof z)if("abs"===t.value)return new z(Math.abs(r.value));else throw Error(`Unknown NumericValue filter: ${t.value}`);else if(r instanceof L)switch(t.value){case"items":return new N(Array.from(r.value.entries()).map(([e,t])=>new N([new P(e),t])));case"length":return new z(r.value.size);default:throw Error(`Unknown ObjectValue filter: ${t.value}`)}throw Error(`Cannot apply filter "${t.value}" to type: ${r.type}`)}if("CallExpression"===e.filter.type){let s=e.filter;if("Identifier"!==s.callee.type)throw Error(`Unknown filter: ${s.callee.type}`);let n=s.callee.value;if(r instanceof N){if("selectattr"===n){let e;if(r.value.some(e=>!(e instanceof L)))throw Error("`selectattr` can only be applied to array of objects");if(s.args.some(e=>"StringLiteral"!==e.type))throw Error("arguments of `selectattr` must be strings");let[n,i,a]=s.args.map(e=>this.evaluate(e,t));if(i){let r=t.tests.get(i.value);if(!r)throw Error(`Unknown test: ${i.value}`);e=r}else e=(...e)=>e[0].__bool__().value;return new N(r.value.filter(t=>{let r=t.value.get(n.value);return!!r&&e(r,a)}))}throw Error(`Unknown ArrayValue filter: ${n}`)}throw Error(`Cannot apply filter "${n}" to type: ${r.type}`)}throw Error(`Unknown filter: ${e.filter.type}`)}evaluateTestExpression(e,t){let r=this.evaluate(e.operand,t),s=t.tests.get(e.test.value);if(!s)throw Error(`Unknown test: ${e.test.value}`);let n=s(r);return new j(e.negate?!n:n)}evaluateUnaryExpression(e,t){let r=this.evaluate(e.argument,t);if("not"===e.operator.value)return new j(!r.value);throw SyntaxError(`Unknown operator: ${e.operator.value}`)}evalProgram(e,t){return this.evaluateBlock(e.body,t)}evaluateBlock(e,t){let r="";for(let s of e){let e=this.evaluate(s,t);"NullValue"!==e.type&&"UndefinedValue"!==e.type&&(r+=e.value)}return new P(r)}evaluateIdentifier(e,t){return t.lookupVariable(e.value)}evaluateCallExpression(e,t){let r=[],s=new Map;for(let n of e.args)"KeywordArgumentExpression"===n.type?s.set(n.key.value,this.evaluate(n.value,t)):r.push(this.evaluate(n,t));s.size>0&&r.push(new L(s));let n=this.evaluate(e.callee,t);if("FunctionValue"!==n.type)throw Error(`Cannot call something that is not a function: got ${n.type}`);return n.value(r,t)}evaluateSliceExpression(e,t,r){if(!(e instanceof N||e instanceof P))throw Error("Slice object must be an array or string");let s=this.evaluate(t.start,r),n=this.evaluate(t.stop,r),i=this.evaluate(t.step,r);if(!(s instanceof z||s instanceof W))throw Error("Slice start must be numeric or undefined");if(!(n instanceof z||n instanceof W))throw Error("Slice stop must be numeric or undefined");if(!(i instanceof z||i instanceof W))throw Error("Slice step must be numeric or undefined");return e instanceof N?new N(R(e.value,s.value,n.value,i.value)):new P(R(Array.from(e.value),s.value,n.value,i.value).join(""))}evaluateMemberExpression(e,t){let r,s,n=this.evaluate(e.object,t);if(e.computed)if("SliceExpression"===e.property.type)return this.evaluateSliceExpression(n,e.property,t);else r=this.evaluate(e.property,t);else r=new P(e.property.value);if(n instanceof L){if(!(r instanceof P))throw Error(`Cannot access property with non-string: got ${r.type}`);s=n.value.get(r.value)??n.builtins.get(r.value)}else if(n instanceof N||n instanceof P)if(r instanceof z)s=n.value.at(r.value),n instanceof P&&(s=new P(n.value.at(r.value)));else if(r instanceof P)s=n.builtins.get(r.value);else throw Error(`Cannot access property with non-string/non-number: got ${r.type}`);else{if(!(r instanceof P))throw Error(`Cannot access property with non-string: got ${r.type}`);s=n.builtins.get(r.value)}return s instanceof B?s:new W}evaluateSet(e,t){let r=this.evaluate(e.value,t);if("Identifier"===e.assignee.type){let s=e.assignee.value;t.setVariable(s,r)}else if("MemberExpression"===e.assignee.type){let s=e.assignee,n=this.evaluate(s.object,t);if(!(n instanceof L))throw Error("Cannot assign to member of non-object");if("Identifier"!==s.property.type)throw Error("Cannot assign to member with non-identifier property");n.value.set(s.property.value,r)}else throw Error(`Invalid LHS inside assignment expression: ${JSON.stringify(e.assignee)}`);return new q}evaluateIf(e,t){let r=this.evaluate(e.test,t);return this.evaluateBlock(r.__bool__().value?e.body:e.alternate,t)}evaluateFor(e,t){let r=new V(t),s=this.evaluate(e.iterable,r);if(!(s instanceof N))throw Error(`Expected iterable type in for loop: got ${s.type}`);let n="";for(let t=0;t<s.value.length;++t){let i=new Map([["index",new z(t+1)],["index0",new z(t)],["revindex",new z(s.value.length-t)],["revindex0",new z(s.value.length-t-1)],["first",new j(0===t)],["last",new j(t===s.value.length-1)],["length",new z(s.value.length)],["previtem",t>0?s.value[t-1]:new W],["nextitem",t<s.value.length-1?s.value[t+1]:new W]]);r.setVariable("loop",new L(i));let a=s.value[t];if("Identifier"===e.loopvar.type)r.setVariable(e.loopvar.value,a);else if("TupleLiteral"===e.loopvar.type){let t=e.loopvar;if("ArrayValue"!==a.type)throw Error(`Cannot unpack non-iterable type: ${a.type}`);if(t.value.length!==a.value.length)throw Error(`Too ${t.value.length>a.value.length?"few":"many"} items to unpack`);for(let e=0;e<t.value.length;++e){if("Identifier"!==t.value[e].type)throw Error(`Cannot unpack non-identifier type: ${t.value[e].type}`);r.setVariable(t.value[e].value,a.value[e])}}n+=this.evaluateBlock(e.body,r).value}return new P(n)}evaluate(e,t){if(void 0===e)return new W;switch(e.type){case"Program":return this.evalProgram(e,t);case"Set":return this.evaluateSet(e,t);case"If":return this.evaluateIf(e,t);case"For":return this.evaluateFor(e,t);case"NumericLiteral":return new z(Number(e.value));case"StringLiteral":return new P(e.value);case"BooleanLiteral":return new j(e.value);case"ArrayLiteral":return new N(e.value.map(e=>this.evaluate(e,t)));case"TupleLiteral":return new F(e.value.map(e=>this.evaluate(e,t)));case"ObjectLiteral":{let r=new Map;for(let[s,n]of e.value){let e=this.evaluate(s,t);if(!(e instanceof P))throw Error(`Object keys must be strings: got ${e.type}`);r.set(e.value,this.evaluate(n,t))}return new L(r)}case"Identifier":return this.evaluateIdentifier(e,t);case"CallExpression":return this.evaluateCallExpression(e,t);case"MemberExpression":return this.evaluateMemberExpression(e,t);case"UnaryExpression":return this.evaluateUnaryExpression(e,t);case"BinaryExpression":return this.evaluateBinaryExpression(e,t);case"FilterExpression":return this.evaluateFilterExpression(e,t);case"TestExpression":return this.evaluateTestExpression(e,t);default:throw SyntaxError(`Unknown node type: ${e.type}`)}}},X=class{parsed;constructor(e){const t=function(e,t={}){let r=[],c=function(e,t={}){return e.endsWith("\n")&&(e=e.slice(0,-1)),e=e.replace(/{#.*?#}/gs,"{##}"),t.lstrip_blocks&&(e=e.replace(/^[ \t]*({[#%])/gm,"$1")),t.trim_blocks&&(e=e.replace(/([#%]})\n/g,"$1")),e.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}(e,t),u=0,d=e=>{let t="";for(;e(c[u]);){if("\\"===c[u]){if(++u>=c.length)throw SyntaxError("Unexpected end of input");let e=c[u++],r=h.get(e);if(void 0===r)throw SyntaxError(`Unexpected escaped character: ${e}`);t+=r;continue}if(t+=c[u++],u>=c.length)throw SyntaxError("Unexpected end of input")}return t};e:for(;u<c.length;){let e=r.at(-1)?.type;if(void 0===e||e===s.CloseStatement||e===s.CloseExpression){let e="";for(;u<c.length&&("{"!==c[u]||"%"!==c[u+1]&&"{"!==c[u+1]);)e+=c[u++];if(e.length>0){r.push(new i(e,s.Text));continue}}d(e=>/\s/.test(e));let t=c[u];if("-"===t||"+"===t){let e=r.at(-1)?.type;if(e===s.Text||void 0===e)throw SyntaxError(`Unexpected character: ${t}`);switch(e){case s.Identifier:case s.NumericLiteral:case s.BooleanLiteral:case s.StringLiteral:case s.CloseParen:case s.CloseSquareBracket:break;default:{++u;let e=d(o);r.push(new i(`${t}${e}`,e.length>0?s.NumericLiteral:s.UnaryOperator));continue}}}for(let[e,t]of l)if(c.slice(u,u+e.length)===e){r.push(new i(e,t)),u+=e.length;continue e}if("'"===t||'"'===t){++u;let e=d(e=>e!==t);r.push(new i(e,s.StringLiteral)),++u;continue}if(o(t)){let e=d(o);r.push(new i(e,s.NumericLiteral));continue}if(a(t)){let e=d(a),t=Object.hasOwn(n,e)?n[e]:s.Identifier;t===s.In&&r.at(-1)?.type===s.Not?(r.pop(),r.push(new i("not in",s.NotIn))):r.push(new i(e,t));continue}throw SyntaxError(`Unexpected character: ${t}`)}return r}(e,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=function(e){let t=new u([]),r=0;function n(t,s){let n=e[r++];if(!n||n.type!==t)throw Error(`Parser Error: ${s}. ${n.type} !== ${t}.`);return n}function i(...t){return r+t.length<=e.length&&t.every((t,s)=>t===e[r+s].type)}function a(e=!1){let t=e?U:o,n=[t()],l=i(s.Comma);for(;l&&(++r,n.push(t()),i(s.Comma)););return l?new A(n):n[0]}function o(){let e=l();if(i(s.If)){++r;let t=l();return n(s.Else,"Expected else token"),new d(t,[e],[l()])}return e}function l(){let t=h();for(;i(s.Or);){let s=e[r];++r,t=new S(s,t,h())}return t}function h(){let t=c();for(;i(s.And);){let s=e[r];++r,t=new S(s,t,c())}return t}function c(){let t;for(;i(s.Not);){let s=e[r];++r,t=new O(s,c())}return t??function(){let t=m();for(;i(s.ComparisonBinaryOperator)||i(s.In)||i(s.NotIn);){let s=e[r];++r,t=new S(s,t,m())}return t}()}function m(){let t=T();for(;i(s.AdditiveBinaryOperator);){let s=e[r];++r,t=new S(s,t,T())}return t}function w(e){let t,a=new _(e,(n(s.OpenParen,"Expected opening parenthesis for arguments list"),t=function(){let e=[];for(;!i(s.CloseParen);){let t=o();if(i(s.Equals)){if(++r,!(t instanceof y))throw SyntaxError("Expected identifier for keyword argument");t=new M(t,o())}e.push(t),i(s.Comma)&&++r}return e}(),n(s.CloseParen,"Expected closing parenthesis for arguments list"),t));return i(s.OpenParen)&&(a=w(a)),a}function T(){let t=R();for(;i(s.MultiplicativeBinaryOperator);){let s=e[r];++r,t=new S(s,t,R())}return t}function R(){let t=function(){let t,a=(t=function(){let t=U();for(;i(s.Dot)||i(s.OpenSquareBracket);){let a,l=e[r];++r;let h=l.type!==s.Dot;if(h)a=function(){let e=[],t=!1;for(;!i(s.CloseSquareBracket);)i(s.Colon)?(e.push(void 0),++r,t=!0):(e.push(o()),i(s.Colon)&&(++r,t=!0));if(0===e.length)throw SyntaxError("Expected at least one argument for member/slice expression");if(t){if(e.length>3)throw SyntaxError("Expected 0-3 arguments for slice expression");return new C(...e)}return e[0]}(),n(s.CloseSquareBracket,"Expected closing square bracket");else if("Identifier"!==(a=U()).type)throw SyntaxError("Expected identifier following dot operator");t=new g(t,a,h)}return t}(),i(s.OpenParen)?w(t):t);for(;i(s.Pipe);){++r;let e=U();if(!(e instanceof y))throw SyntaxError("Expected identifier for the filter");i(s.OpenParen)&&(e=w(e)),a=new $(a,e)}return a}();for(;i(s.Is);){++r;let e=i(s.Not);e&&++r;let n=U();if(n instanceof x&&(n=new y(n.value.toString())),!(n instanceof y))throw SyntaxError("Expected identifier for the test");t=new I(t,e,n)}return t}function U(){let t=e[r];switch(t.type){case s.NumericLiteral:return++r,new b(Number(t.value));case s.StringLiteral:return++r,new v(t.value);case s.BooleanLiteral:return++r,new x("true"===t.value);case s.Identifier:return++r,new y(t.value);case s.OpenParen:{++r;let t=a();if(e[r].type!==s.CloseParen)throw SyntaxError(`Expected closing parenthesis, got ${e[r].type} instead`);return++r,t}case s.OpenSquareBracket:{++r;let e=[];for(;!i(s.CloseSquareBracket);)e.push(o()),i(s.Comma)&&++r;return++r,new k(e)}case s.OpenCurlyBracket:{++r;let e=new Map;for(;!i(s.CloseCurlyBracket);){let t=o();n(s.Colon,"Expected colon between key and value in object literal");let a=o();e.set(t,a),i(s.Comma)&&++r}return++r,new E(e)}default:throw SyntaxError(`Unexpected token: ${t.type}`)}}for(;r<e.length;)t.body.push(function t(){switch(e[r].type){case s.Text:return new v(n(s.Text,"Expected text token").value);case s.OpenStatement:let l;switch(n(s.OpenStatement,"Expected opening statement token"),e[r].type){case s.Set:++r,l=function e(){let t=o();return i(s.Equals)?(++r,new p(t,e())):t}(),n(s.CloseStatement,"Expected closing statement token");break;case s.If:++r,l=function a(){let l=o();n(s.CloseStatement,"Expected closing statement token");let h=[],c=[];for(;e[r]?.type!==s.OpenStatement||e[r+1]?.type!==s.ElseIf&&e[r+1]?.type!==s.Else&&e[r+1]?.type!==s.EndIf;)h.push(t());if(e[r]?.type===s.OpenStatement&&e[r+1]?.type!==s.EndIf)if(++r,i(s.ElseIf))n(s.ElseIf,"Expected elseif token"),c.push(a());else for(n(s.Else,"Expected else token"),n(s.CloseStatement,"Expected closing statement token");e[r]?.type!==s.OpenStatement||e[r+1]?.type!==s.EndIf;)c.push(t());return new d(l,h,c)}(),n(s.OpenStatement,"Expected {% token"),n(s.EndIf,"Expected endif token"),n(s.CloseStatement,"Expected %} token");break;case s.For:++r,l=function(){let i=a(!0);if(!(i instanceof y||i instanceof A))throw SyntaxError(`Expected identifier/tuple for the loop variable, got ${i.type} instead`);n(s.In,"Expected `in` keyword following loop variable");let l=o();n(s.CloseStatement,"Expected closing statement token");let h=[];for(;function(...t){return r+t.length<=e.length&&t.some((t,s)=>t!==e[r+s].type)}(s.OpenStatement,s.EndFor);)h.push(t());return new f(i,l,h)}(),n(s.OpenStatement,"Expected {% token"),n(s.EndFor,"Expected endfor token"),n(s.CloseStatement,"Expected %} token");break;default:throw SyntaxError(`Unknown statement type: ${e[r].type}`)}return l;case s.OpenExpression:let h;return n(s.OpenExpression,"Expected opening expression token"),h=o(),n(s.CloseExpression,"Expected closing expression token"),h;default:throw SyntaxError(`Unexpected token type: ${e[r].type}`)}}());return t}(t)}render(e){let t=new V;for(let[r,s]of(t.set("false",!1),t.set("true",!0),t.set("raise_exception",e=>{throw Error(e)}),t.set("range",T),Object.entries(e)))t.set(r,s);return new H(t).run(this.parsed).value}}},50602:(e,t,r)=>{"use strict";r.d(t,{$:()=>L});var s=Uint8Array,n=Uint16Array,i=Int32Array,a=new s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(e,t){for(var r=new n(31),s=0;s<31;++s)r[s]=t+=1<<e[s-1];for(var a=new i(r[30]),s=1;s<30;++s)for(var o=r[s];o<r[s+1];++o)a[o]=o-r[s]<<5|s;return{b:r,r:a}},c=h(a,2),u=c.b,d=c.r;u[28]=258,d[258]=28;for(var f=h(o,0),p=(f.b,f.r),m=new n(32768),g=0;g<32768;++g){var _=(43690&g)>>1|(21845&g)<<1;_=(61680&(_=(52428&_)>>2|(13107&_)<<2))>>4|(3855&_)<<4,m[g]=((65280&_)>>8|(255&_)<<8)>>1}for(var y=function(e,t,r){for(var s,i=e.length,a=0,o=new n(t);a<i;++a)e[a]&&++o[e[a]-1];var l=new n(t);for(a=1;a<t;++a)l[a]=l[a-1]+o[a-1]<<1;if(r){s=new n(1<<t);var h=15-t;for(a=0;a<i;++a)if(e[a])for(var c=a<<4|e[a],u=t-e[a],d=l[e[a]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)s[m[d]>>h]=c}else for(a=0,s=new n(i);a<i;++a)e[a]&&(s[a]=m[l[e[a]-1]++]>>15-e[a]);return s},w=new s(288),g=0;g<144;++g)w[g]=8;for(var g=144;g<256;++g)w[g]=9;for(var g=256;g<280;++g)w[g]=7;for(var g=280;g<288;++g)w[g]=8;for(var b=new s(32),g=0;g<32;++g)b[g]=5;var v=y(w,9,0),x=y(b,5,0),k=function(e){return(e+7)/8|0},A=function(e,t,r){r<<=7&t;var s=t/8|0;e[s]|=r,e[s+1]|=r>>8},E=function(e,t,r){r<<=7&t;var s=t/8|0;e[s]|=r,e[s+1]|=r>>8,e[s+2]|=r>>16},S=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var a=r.length,o=r.slice();if(!a)return{t:R,l:0};if(1==a){var l=new s(r[0].s+1);return l[r[0].s]=1,{t:l,l:1}}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var h=r[0],c=r[1],u=0,d=1,f=2;for(r[0]={s:-1,f:h.f+c.f,l:h,r:c};d!=a-1;)h=r[r[u].f<r[f].f?u++:f++],c=r[u!=d&&r[u].f<r[f].f?u++:f++],r[d++]={s:-1,f:h.f+c.f,l:h,r:c};for(var p=o[0].s,i=1;i<a;++i)o[i].s>p&&(p=o[i].s);var m=new n(p+1),g=$(r[d-1],m,0);if(g>t){var i=0,_=0,y=g-t,w=1<<y;for(o.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});i<a;++i){var b=o[i].s;if(m[b]>t)_+=w-(1<<g-m[b]),m[b]=t;else break}for(_>>=y;_>0;){var v=o[i].s;m[v]<t?_-=1<<t-m[v]++-1:++i}for(;i>=0&&_;--i){var x=o[i].s;m[x]==t&&(--m[x],++_)}g=t}return{t:new s(m),l:g}},$=function(e,t,r){return -1==e.s?Math.max($(e.l,t,r+1),$(e.r,t,r+1)):t[e.s]=r},I=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new n(++t),s=0,i=e[0],a=1,o=function(e){r[s++]=e},l=1;l<=t;++l)if(e[l]==i&&l!=t)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=e[l]}return{c:r.subarray(0,s),n:t}},O=function(e,t){for(var r=0,s=0;s<t.length;++s)r+=e[s]*t[s];return r},C=function(e,t,r){var s=r.length,n=k(t+2);e[n]=255&s,e[n+1]=s>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var i=0;i<s;++i)e[n+i+4]=r[i];return(n+4+s)*8},M=function(e,t,r,s,i,h,c,u,d,f,p){A(t,p++,r),++i[256];for(var m,g,_,k,$=S(i,15),M=$.t,T=$.l,R=S(h,15),U=R.t,B=R.l,z=I(M),P=z.c,j=z.n,L=I(U),N=L.c,F=L.n,D=new n(19),q=0;q<P.length;++q)++D[31&P[q]];for(var q=0;q<N.length;++q)++D[31&N[q]];for(var W=S(D,7),V=W.t,H=W.l,X=19;X>4&&!V[l[X-1]];--X);var K=f+5<<3,G=O(i,w)+O(h,b)+c,J=O(i,M)+O(h,U)+c+14+3*X+O(D,V)+2*D[16]+3*D[17]+7*D[18];if(d>=0&&K<=G&&K<=J)return C(t,p,e.subarray(d,d+f));if(A(t,p,1+(J<G)),p+=2,J<G){m=y(M,T,0),g=M,_=y(U,B,0),k=U;var Y=y(V,H,0);A(t,p,j-257),A(t,p+5,F-1),A(t,p+10,X-4),p+=14;for(var q=0;q<X;++q)A(t,p+3*q,V[l[q]]);p+=3*X;for(var Q=[P,N],Z=0;Z<2;++Z)for(var ee=Q[Z],q=0;q<ee.length;++q){var et=31&ee[q];A(t,p,Y[et]),p+=V[et],et>15&&(A(t,p,ee[q]>>5&127),p+=ee[q]>>12)}}else m=v,g=w,_=x,k=b;for(var q=0;q<u;++q){var er=s[q];if(er>255){var et=er>>18&31;E(t,p,m[et+257]),p+=g[et+257],et>7&&(A(t,p,er>>23&31),p+=a[et]);var es=31&er;E(t,p,_[es]),p+=k[es],es>3&&(E(t,p,er>>5&8191),p+=o[es])}else E(t,p,m[er]),p+=g[er]}return E(t,p,m[256]),p+g[256]},T=new i([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),R=new s(0),U=function(e,t,r,l,h,c){var u,f,m=c.z||e.length,g=new s(l+m+5*(1+Math.ceil(m/7e3))+h),_=g.subarray(l,g.length-h),y=c.l,w=7&(c.r||0);if(t){w&&(_[0]=c.r>>3);for(var b=T[t-1],v=b>>13,x=8191&b,A=(1<<r)-1,E=c.p||new n(32768),S=c.h||new n(A+1),$=Math.ceil(r/3),I=2*$,O=function(t){return(e[t]^e[t+1]<<$^e[t+2]<<I)&A},R=new i(25e3),U=new n(288),B=new n(32),z=0,P=0,j=c.i||0,L=0,N=c.w||0,F=0;j+2<m;++j){var D=O(j),q=32767&j,W=S[D];if(E[q]=W,S[D]=q,N<=j){var V=m-j;if((z>7e3||L>24576)&&(V>423||!y)){w=M(e,_,0,R,U,B,P,L,F,j-F,w),L=z=P=0,F=j;for(var H=0;H<286;++H)U[H]=0;for(var H=0;H<30;++H)B[H]=0}var X=2,K=0,G=x,J=q-W&32767;if(V>2&&D==O(j-J))for(var Y=Math.min(v,V)-1,Q=Math.min(32767,j),Z=Math.min(258,V);J<=Q&&--G&&q!=W;){if(e[j+X]==e[j+X-J]){for(var ee=0;ee<Z&&e[j+ee]==e[j+ee-J];++ee);if(ee>X){if(X=ee,K=J,ee>Y)break;for(var et=Math.min(J,ee-2),er=0,H=0;H<et;++H){var es=j-J+H&32767,en=E[es],ei=es-en&32767;ei>er&&(er=ei,W=es)}}}W=E[q=W],J+=q-W&32767}if(K){R[L++]=0x10000000|d[X]<<18|p[K];var ea=31&d[X],eo=31&p[K];P+=a[ea]+o[eo],++U[257+ea],++B[eo],N=j+X,++z}else R[L++]=e[j],++U[e[j]]}}for(j=Math.max(j,N);j<m;++j)R[L++]=e[j],++U[e[j]];w=M(e,_,y,R,U,B,P,L,F,j-F,w),y||(c.r=7&w|_[w/8|0]<<3,w-=7,c.h=S,c.p=E,c.i=j,c.w=N)}else{for(var j=c.w||0;j<m+y;j+=65535){var el=j+65535;el>=m&&(_[w/8|0]=y,el=m),w=C(_,w+1,e.subarray(j,el))}c.i=m}return u=0,f=l+k(w)+h,(null==u||u<0)&&(u=0),(null==f||f>g.length)&&(f=g.length),new s(g.subarray(u,f))},B=function(){var e=1,t=0;return{p:function(r){for(var s=e,n=t,i=0|r.length,a=0;a!=i;){for(var o=Math.min(a+2655,i);a<o;++a)n+=s+=r[a];s=(65535&s)+15*(s>>16),n=(65535&n)+15*(n>>16)}e=s,t=n},d:function(){return e%=65521,t%=65521,(255&e)<<24|(65280&e)<<8|(255&t)<<8|t>>8}}},z=function(e,t,r,n,i){if(!i&&(i={l:1},t.dictionary)){var a=t.dictionary.subarray(-32768),o=new s(a.length+e.length);o.set(a),o.set(e,a.length),e=o,i.w=a.length}return U(e,null==t.level?6:t.level,null==t.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,r,n,i)},P=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},j=function(e,t){var r=t.level;if(e[0]=120,e[1]=(0==r?0:r<6?1:9==r?3:2)<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var s=B();s.p(t.dictionary),P(e,2,s.d())}};function L(e,t){t||(t={});var r=B();r.p(e);var s=z(e,t,t.dictionary?6:2,4);return j(s,t),P(s,s.length-4,r.d()),s}var N="undefined"!=typeof TextDecoder&&new TextDecoder;try{N.decode(R,{stream:!0})}catch(e){}"function"==typeof queueMicrotask&&queueMicrotask},54180:(e,t,r)=>{"use strict";r.d(t,{_:()=>g});var s=r(22009),n=r(6837),i=r(94658);let{env:a}=r(95714).M,o="2.17.2",l="undefined"!=typeof self&&"caches"in self,h=!_(s),c=!_(n),u=h&&c,d=u?n.dirname(n.dirname(i.fileURLToPath("file:///C:/Users/mcava/OneDrive/Apps/PlanPath/node_modules/@xenova/transformers/src/env.js"))):"./",f=u?n.join(d,"/.cache/"):null,p="/models/",m=u?n.join(d,p):p;a?.wasm&&(a.wasm.wasmPaths=u?n.join(d,"/dist/"):`https://cdn.jsdelivr.net/npm/@xenova/transformers@${o}/dist/`);let g={backends:{onnx:a,tfjs:{}},__dirname:d,version:o,allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath:m,useFS:h,useBrowserCache:l,useFSCache:h,cacheDir:f,useCustomCache:!1,customCache:null};function _(e){return 0===Object.keys(e).length}},60157:(e,t,r)=>{"use strict";let s;function n(e,t="utf8"){return new TextDecoder(t).decode(e)}r.d(t,{D4:()=>O});let i=new TextEncoder,a=!((new Uint32Array((s=new Uint8Array(4)).buffer)[0]=1)&s[0]),o={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class l{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=8192,t={}){let r=!1;"number"==typeof e?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);const s=t.offset?t.offset>>>0:0,n=e.byteLength-s;let i=s;(ArrayBuffer.isView(e)||e instanceof l)&&(e.byteLength!==e.buffer.byteLength&&(i=e.byteOffset+s),e=e.buffer),r?this.lastWrittenByte=n:this.lastWrittenByte=0,this.buffer=e,this.length=n,this.byteLength=n,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,n),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let e=this._marks.pop();if(void 0===e)throw Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){let t=2*(this.offset+e),r=new Uint8Array(t);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){let r=o[t].BYTES_PER_ELEMENT*e,s=this.byteOffset+this.offset,n=this.buffer.slice(s,s+r);if(this.littleEndian===a&&"uint8"!==t&&"int8"!==t){let e=new Uint8Array(this.buffer.slice(s,s+r));e.reverse();let n=new o[t](e.buffer);return this.offset+=r,n.reverse(),n}let i=new o[t](n);return this.offset+=r,i}readInt16(){let e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){let e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){let e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){let e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){let e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){let e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){let e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){let e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let r=0;r<e;r++)t+=this.readChar();return t}readUtf8(e=1){return n(this.readBytes(e))}decodeText(e=1,t="utf8"){return n(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(255*!!e),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(i.encode(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}var h,c,u=r(30165);let d=[];for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)1&t?t=0xedb88320^t>>>1:t>>>=1;d[e]=t}function f(e,t,r){let s=e.readUint32(),n=(0xffffffff^function(e,t,r){let s=0xffffffff;for(let e=0;e<r;e++)s=d[(s^t[e])&255]^s>>>8;return s}(0,new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t))>>>0;if(n!==s)throw Error(`CRC mismatch for chunk ${r}. Expected ${s}, found ${n}`)}function p(e,t,r){for(let s=0;s<r;s++)t[s]=e[s]}function m(e,t,r,s){let n=0;for(;n<s;n++)t[n]=e[n];for(;n<r;n++)t[n]=e[n]+t[n-s]&255}function g(e,t,r,s){let n=0;if(0===r.length)for(;n<s;n++)t[n]=e[n];else for(;n<s;n++)t[n]=e[n]+r[n]&255}function _(e,t,r,s,n){let i=0;if(0===r.length){for(;i<n;i++)t[i]=e[i];for(;i<s;i++)t[i]=e[i]+(t[i-n]>>1)&255}else{for(;i<n;i++)t[i]=e[i]+(r[i]>>1)&255;for(;i<s;i++)t[i]=e[i]+(t[i-n]+r[i]>>1)&255}}function y(e,t,r,s,n){let i=0;if(0===r.length){for(;i<n;i++)t[i]=e[i];for(;i<s;i++)t[i]=e[i]+t[i-n]&255}else{for(;i<n;i++)t[i]=e[i]+r[i]&255;for(;i<s;i++)t[i]=e[i]+function(e,t,r){let s=e+t-r,n=Math.abs(s-e),i=Math.abs(s-t),a=Math.abs(s-r);return n<=i&&n<=a?e:i<=a?t:r}(t[i-n],r[i],r[i-n])&255}}let w=255===new Uint8Array(new Uint16Array([255]).buffer)[0],b=255===new Uint8Array(new Uint16Array([255]).buffer)[0],v=new Uint8Array(0);function x(e){let t,r,{data:s,width:n,height:i,channels:a,depth:o}=e,l=Math.ceil(o/8)*a,h=Math.ceil(o/8*a*n),c=new Uint8Array(i*h),u=v,d=0;for(let e=0;e<i;e++){switch(t=s.subarray(d+1,d+1+h),r=c.subarray(e*h,(e+1)*h),s[d]){case 0:p(t,r,h);break;case 1:m(t,r,h,l);break;case 2:g(t,r,u,h);break;case 3:_(t,r,u,h,l);break;case 4:y(t,r,u,h,l);break;default:throw Error(`Unsupported filter: ${s[d]}`)}u=r,d+=h+1}if(16!==o)return c;{let e=new Uint16Array(c.buffer);if(b)for(let t=0;t<e.length;t++){var f;e[t]=(255&(f=e[t]))<<8|f>>8&255}return e}}let k=Uint8Array.of(137,80,78,71,13,10,26,10);function A(e){if(!function(e){if(e.length<k.length)return!1;for(let t=0;t<k.length;t++)if(e[t]!==k[t])return!1;return!0}(e.readBytes(k.length)))throw Error("wrong PNG signature")}let E=new TextDecoder("latin1"),S=/^[\u0000-\u00FF]*$/;function $(e){for(e.mark();0!==e.readByte(););let t=e.offset;e.reset();let r=E.decode(e.readBytes(t-e.offset-1));e.skip(1);if(function(e){if(!S.test(e))throw Error("invalid latin1 text")}(r),0===r.length||r.length>79)throw Error("keyword length must be between 1 and 79");return r}class I extends l{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:r=!1}=t;this._checkCrc=r,this._inflator=new u.EL,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=-1,this._filterMethod=-1,this._interlaceMethod=-1,this._colorType=-1,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(A(this);!this._end;){let e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(A(this);!this._end;){let e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){let r=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":var s,n,i;let a;s=this._png.text,s[a=$(this)]=(n=this,i=e-a.length-1,E.decode(n.readBytes(i)));break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-r!==e)throw Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?f(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){let r=this.offset;switch("fdAT"!==t&&"IDAT"!==t&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=r+e}if(this.offset-r!==e)throw Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?f(this,e+4,t):this.skip(4)}decodeIHDR(){let e,t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw Error(`invalid bit depth: ${e}`);return e}(this.readUint8());let r=this.readUint8();switch(this._colorType=r,r){case 0:case 3:e=1;break;case 2:e=3;break;case 4:e=2;break;case 6:e=4;break;default:throw Error(`Unknown color type: ${r}`)}if(this._png.channels=e,this._compressionMethod=this.readUint8(),0!==this._compressionMethod)throw Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){let e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!=0)throw RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);let t=e/3;this._hasPalette=!0;let r=[];this._palette=r;for(let e=0;e<t;e++)r.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;let t=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,t,e)),this._inflator.err)throw Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,r=this.offset+this.byteOffset;if(r+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,r,t)),this._inflator.err)throw Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case 0:case 2:if(e%2!=0)throw RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break;case 3:{if(e>this._palette.length)throw Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){let e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){let t=$(this),r=this.readUint8();if(0!==r)throw Error(`Unsupported iCCP compression method: ${r}`);let s=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:(0,u.UD)(s)}}decodepHYs(){let e=this.readUint32(),t=this.readUint32(),r=this.readByte();this._png.resolution={x:e,y:t,unit:r}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){let t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},r=this._frames.at(e);if(r){if(r.data=x({data:r.data,width:r.width,height:r.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===e||0===r.xOffset&&0===r.yOffset&&r.width===this._png.width&&r.height===this._png.height)t.data=r.data;else{let s=this._apng.frames.at(e-1);this.disposeFrame(r,s,t),this.addFrameDataToCanvas(t,r)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,r){switch(e.disposeOp){case 0:break;case 1:for(let t=0;t<this._png.height;t++)for(let s=0;s<this._png.width;s++){let n=(t*e.width+s)*this._png.channels;for(let e=0;e<this._png.channels;e++)r.data[n+e]=0}break;case 2:r.data.set(t.data);break;default:throw Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){let r=1<<this._png.depth,s=(e,r)=>({index:((e+t.yOffset)*this._png.width+t.xOffset+r)*this._png.channels,frameIndex:(e*t.width+r)*this._png.channels});switch(t.blendOp){case 0:for(let r=0;r<t.height;r++)for(let n=0;n<t.width;n++){let{index:i,frameIndex:a}=s(r,n);for(let r=0;r<this._png.channels;r++)e.data[i+r]=t.data[a+r]}break;case 1:for(let n=0;n<t.height;n++)for(let i=0;i<t.width;i++){let{index:a,frameIndex:o}=s(n,i);for(let s=0;s<this._png.channels;s++){let n=t.data[o+this._png.channels-1]/r,i=Math.floor(n*(s%(this._png.channels-1)==0?1:t.data[o+s])+(1-n)*e.data[a+s]);e.data[a+s]+=i}}break;default:throw Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw Error(`Error while decompressing the data: ${this._inflator.err}`);let e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(0!==this._filterMethod)throw Error(`Filter method ${this._filterMethod} not supported`);if(0===this._interlaceMethod)this._png.data=x({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(1===this._interlaceMethod)this._png.data=function(e){let{data:t,width:r,height:s,channels:n,depth:i}=e,a=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(i/8)*n,l=new Uint8Array(s*r*o),h=0;for(let e=0;e<7;e++){let n=a[e],i=Math.ceil((r-n.x)/n.xStep),c=Math.ceil((s-n.y)/n.yStep);if(i<=0||c<=0)continue;let u=i*o,d=new Uint8Array(u);for(let e=0;e<c;e++){let a=t[h++],c=t.subarray(h,h+u);h+=u;let f=new Uint8Array(u);switch(a){case 0:p(c,f,u);break;case 1:m(c,f,u,o);break;case 2:g(c,f,d,u);break;case 3:_(c,f,d,u,o);break;case 4:y(c,f,d,u,o);break;default:throw Error(`Unsupported filter: ${a}`)}d.set(f);for(let t=0;t<i;t++){let i=n.x+t*n.xStep,a=n.y+e*n.yStep;if(!(i>=r)&&!(a>=s))for(let e=0;e<o;e++)l[(a*r+i)*o+e]=f[t*o+e]}}}if(16!==i)return l;{let e=new Uint16Array(l.buffer);if(w)for(let t=0;t<e.length;t++){var c;e[t]=(255&(c=e[t]))<<8|c>>8&255}return e}}({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){let e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:0,blendOp:0,data:e}),this._inflator=new u.EL,this._writingDataChunks=!1}}function O(e,t){return new I(e,t).decode()}(h=c||(c={}))[h.UNKNOWN=0]="UNKNOWN",h[h.METRE=1]="METRE"},63806:(e,t,r)=>{"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.d(t,{A:()=>s})},76874:(e,t,r)=>{"use strict";r.d(t,{$q:()=>f,$y:()=>_,GW:()=>l,J:()=>w,X7:()=>h,cQ:()=>m,i2:()=>g,oC:()=>y,qY:()=>o,t$:()=>p});var s=r(95714),n=r(1818);let i=Object.freeze({float32:Float32Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array}),a=s.M.Tensor;class o{dims;type;data;size;constructor(...e){return e[0]instanceof a?Object.assign(this,e[0]):Object.assign(this,new a(e[0],e[1],e[2])),new Proxy(this,{get:(e,t)=>{if("string"==typeof t){let r=Number(t);if(Number.isInteger(r))return e._getitem(r)}return e[t]},set:(e,t,r)=>e[t]=r})}*[Symbol.iterator](){let[e,...t]=this.dims;if(t.length>0){let r=t.reduce((e,t)=>e*t);for(let s=0;s<e;++s)yield this._subarray(s,r,t)}else yield*this.data}_getitem(e){let[t,...r]=this.dims;if(e=d(e,t),!(r.length>0))return new o(this.type,[this.data[e]],r);{let t=r.reduce((e,t)=>e*t);return this._subarray(e,t,r)}}indexOf(e){for(let t=0;t<this.data.length;++t)if(this.data[t]==e)return t;return -1}_subarray(e,t,r){let s=e*t,n=(e+1)*t,i="subarray"in this.data?this.data.subarray(s,n):this.data.slice(s,n);return new o(this.type,i,r)}item(){if(1!==this.data.length)throw Error(`a Tensor with ${this.data.length} elements cannot be converted to Scalar`);return this.data[0]}tolist(){return function(e,t){let r=e.length;if(r!==t.reduce((e,t)=>e*t))throw Error(`cannot reshape array of size ${r} into shape (${t})`);let s=e;for(let e=t.length-1;e>=0;e--)s=s.reduce((r,s)=>{let n=r[r.length-1];return n.length<t[e]?n.push(s):r.push([s]),r},[[]]);return s[0]}(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let e=0;e<this.data.length;++e)this.data[e]=1/(1+Math.exp(-this.data[e]));return this}mul(e){return this.clone().mul_(e)}mul_(e){for(let t=0;t<this.data.length;++t)this.data[t]*=e;return this}add(e){return this.clone().add_(e)}add_(e){for(let t=0;t<this.data.length;++t)this.data[t]+=e;return this}clone(){return new o(this.type,this.data.slice(),this.dims.slice())}slice(...e){let t=[],r=[];for(let s=0;s<this.dims.length;++s){let n=e[s];if(null==n)r.push([0,this.dims[s]]),t.push(this.dims[s]);else if("number"==typeof n)n=d(n,this.dims[s],s),r.push([n,n+1]);else if(Array.isArray(n)&&2===n.length){if(n[0]>n[1])throw Error(`Invalid slice: ${n}`);let e=[Math.max(n[0],0),Math.min(n[1],this.dims[s])];r.push(e),t.push(e[1]-e[0])}else throw Error(`Invalid slice: ${n}`)}let s=r.map(([e,t])=>t-e),n=s.reduce((e,t)=>e*t),i=new this.data.constructor(n),a=this.stride();for(let e=0;e<n;++e){let t=0;for(let n=s.length-1,i=e;n>=0;--n){let e=s[n];t+=(i%e+r[n][0])*a[n],i=Math.floor(i/e)}i[e]=this.data[t]}return new o(this.type,i,t)}permute(...e){return function(e,t){let[r,s]=(0,n.SX)(e.data,e.dims,t);return new o(e.type,r,s)}(this,e)}transpose(...e){return this.permute(...e)}sum(e=null,t=!1){return this.norm(1,e,t)}norm(e="fro",t=null,r=!1){if("fro"===e)e=2;else if("string"==typeof e)throw Error(`Unsupported norm: ${e}`);if(null===t){let t=this.data.reduce((t,r)=>t+r**e,0)**(1/e);return new o(this.type,[t],[])}t=d(t,this.dims.length);let s=this.dims.slice();s[t]=1;let n=new this.data.constructor(this.data.length/this.dims[t]);for(let r=0;r<this.data.length;++r){let i=0;for(let e=this.dims.length-1,n=r,a=1;e>=0;--e){let r=this.dims[e];e!==t&&(i+=n%r*a,a*=s[e]),n=Math.floor(n/r)}n[i]+=this.data[r]**e}if(1!==e)for(let t=0;t<n.length;++t)n[t]=n[t]**(1/e);return r||s.splice(t,1),new o(this.type,n,s)}normalize_(e=2,t=1){t=d(t,this.dims.length);let r=this.norm(e,t,!0);for(let e=0;e<this.data.length;++e){let s=0;for(let r=this.dims.length-1,n=e,i=1;r>=0;--r){let e=this.dims[r];r!==t&&(s+=n%e*i,i*=this.dims[r]),n=Math.floor(n/e)}this.data[e]/=r.data[s]}return this}normalize(e=2,t=1){return this.clone().normalize_(e,t)}stride(){return function(e){let t=Array(e.length);for(let r=e.length-1,s=1;r>=0;--r)t[r]=s,s*=e[r];return t}(this.dims)}squeeze(e=null){return new o(this.type,this.data,c(this.dims,e))}squeeze_(e=null){return this.dims=c(this.dims,e),this}unsqueeze(e=null){return new o(this.type,this.data,u(this.dims,e))}unsqueeze_(e=null){return this.dims=u(this.dims,e),this}flatten_(e=0,t=-1){t=(t+this.dims.length)%this.dims.length;let r=this.dims.slice(0,e),s=this.dims.slice(e,t+1),n=this.dims.slice(t+1);return this.dims=[...r,s.reduce((e,t)=>e*t,1),...n],this}flatten(e=0,t=-1){return this.clone().flatten_(e,t)}view(...e){let t=-1;for(let r=0;r<e.length;++r)if(-1===e[r]){if(-1!==t)throw Error("Only one dimension can be inferred");t=r}if(-1!==t){let r=e.reduce((e,r,s)=>s!==t?e*r:e,1);e[t]=this.data.length/r}return new o(this.type,this.data,e)}neg_(){for(let e=0;e<this.data.length;++e)this.data[e]=-this.data[e];return this}neg(){return this.clone().neg_()}clamp_(e,t){for(let r=0;r<this.data.length;++r)this.data[r]=Math.min(Math.max(this.data[r],e),t);return this}clamp(e,t){return this.clone().clamp_(e,t)}round_(){for(let e=0;e<this.data.length;++e)this.data[e]=Math.round(this.data[e]);return this}round(){return this.clone().round_()}to(e){if(this.type===e)return this;if(!i.hasOwnProperty(e))throw Error(`Unsupported type: ${e}`);return new o(e,i[e].from(this.data),this.dims)}}function l(e,[t,r],s="bilinear",i=!1){let a=e.dims.at(-3)??1,h=e.dims.at(-2),c=e.dims.at(-1),u=(0,n.vd)(e.data,[a,h,c],[t,r],s,i);return new o(e.type,u,[a,t,r])}function h(e,t){let r=[e.dims[0],e.dims[2]],s=new e.data.constructor(r[0]*r[1]),[n,i,a]=e.dims,l=0;for(let r=0;r<n;++r){let n=r*a*i;for(let o=0;o<a;++o){let h=0,c=0,u=r*i,d=n+o;for(let r=0;r<i;++r){let s=Number(t.data[u+r]);c+=s,h+=e.data[d+r*a]*s}let f=h/c;s[l++]=f}}return new o(e.type,s,r)}function c(e,t){return e=e.slice(),null===t?e=e.filter(e=>1!==e):"number"==typeof t?1===e[t]&&e.splice(t,1):Array.isArray(t)&&(e=e.filter((e,r)=>1!==e||!t.includes(r))),e}function u(e,t){return t=d(t,e.length+1),(e=e.slice()).splice(t,0,1),e}function d(e,t,r=null){if(e<-t||e>=t)throw Error(`IndexError: index ${e} is out of bounds for dimension${null===r?"":" "+r} with size ${t}`);return e<0&&(e=(e%t+t)%t),e}function f(e,t=0){t=d(t,e[0].dims.length);let r=e[0].dims.slice();r[t]=e.reduce((e,r)=>e+r.dims[t],0);let s=r.reduce((e,t)=>e*t,1),n=new e[0].data.constructor(s),i=e[0].type;if(0===t){let t=0;for(let r of e)n.set(r.data,t),t+=r.data.length}else{let s=0;for(let i=0;i<e.length;++i){let a=e[i];for(let e=0;e<a.data.length;++e){let i=0;for(let n=a.dims.length-1,o=e,l=1;n>=0;--n){let e=a.dims[n],h=o%e;n===t&&(h+=s),i+=h*l,l*=r[n],o=Math.floor(o/e)}n[i]=a.data[e]}s+=a.dims[t]}}return new o(i,n,r)}function p(e,t=0){return f(e.map(e=>e.unsqueeze(t)),t)}function m(e,t=null,r=1,s=!1){if(null===t){let t=e.data.reduce((e,t)=>e+t,0)/e.data.length,s=Math.sqrt(e.data.reduce((e,r)=>e+(r-t)**2,0)/(e.data.length-r)),n=new o(e.type,[t],[]);return[new o(e.type,[s],[]),n]}t=d(t,e.dims.length);let n=g(e,t,s),i=e.dims.slice();i[t]=1;let a=new e.data.constructor(e.data.length/e.dims[t]);for(let r=0;r<e.data.length;++r){let s=0;for(let n=e.dims.length-1,a=r,o=1;n>=0;--n){let r=e.dims[n];n!==t&&(s+=a%r*o,o*=i[n]),a=Math.floor(a/r)}a[s]+=(e.data[r]-n.data[s])**2}for(let s=0;s<a.length;++s)a[s]=Math.sqrt(a[s]/(e.dims[t]-r));return s||i.splice(t,1),[new o(e.type,a,i),n]}function g(e,t=null,r=!1){if(null===t){let t=e.data.reduce((e,t)=>e+t,0);return new o(e.type,[t/e.data.length],[])}t=d(t,e.dims.length);let s=e.dims.slice();s[t]=1;let n=new e.data.constructor(e.data.length/e.dims[t]);for(let r=0;r<e.data.length;++r){let i=0;for(let n=e.dims.length-1,a=r,o=1;n>=0;--n){let r=e.dims[n];n!==t&&(i+=a%r*o,o*=s[n]),a=Math.floor(a/r)}n[i]+=e.data[r]}if(1!==e.dims[t])for(let r=0;r<n.length;++r)n[r]=n[r]/e.dims[t];return r||s.splice(t,1),new o(e.type,n,s)}function _(e){let[t,r]=e.dims,s=[t+1,r+1],n=new o("float32",new Float32Array(s[0]*s[1]).fill(1/0),s),i=new o("float32",new Float32Array(s[0]*s[1]).fill(-1),s);n[0].data[0]=0;for(let s=1;s<r+1;++s)for(let r=1;r<t+1;++r){let t,a,o=n[r-1][s-1].item(),l=n[r-1][s].item(),h=n[r][s-1].item();o<l&&o<h?(t=o,a=0):l<o&&l<h?(t=l,a=1):(t=h,a=2),n[r].data[s]=e[r-1][s-1].item()+t,i[r].data[s]=a}let a=t,l=r;i.data.fill(2,0,s[1]);for(let e=0;e<s[0];++e)i[e].data[0]=1;let h=[],c=[];for(;a>0||l>0;)switch(h.push(a-1),c.push(l-1),i[a][l].item()){case 0:--a,--l;break;case 1:--a;break;case 2:--l;break;default:throw Error(`Internal error in dynamic time warping. Unexpected trace[${a}, ${l}]. Please file a bug report.`)}return h.reverse(),c.reverse(),[h,c]}function y(e){var t;return new o("int64",new BigInt64Array((t=e.dims).reduce((e,t)=>e*t,1)).fill(1n),t)}function w(e,t){if(2!==e.dims.length)throw Error("The tensor must have 2 dimensions");if(e.dims.at(-1)%8!=0)throw Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(t))throw Error("The precision must be either 'binary' or 'ubinary'");let r="binary"===t,s=r?Int8Array:Uint8Array,n=e.data,i=new s(n.length/8);for(let e=0;e<n.length;++e){let t=+(n[e]>0),s=Math.floor(e/8),a=e%8;i[s]|=t<<7-a,r&&0===a&&(i[s]-=128)}return new o(r?"int8":"uint8",i,[e.dims[0],e.dims[1]/8])}},80080:e=>{!function(){"use strict";var t={815:function(e){e.exports=function(e,r,s,n){r=r||"&",s=s||"=";var i={};if("string"!=typeof e||0===e.length)return i;var a=/\+/g;e=e.split(r);var o=1e3;n&&"number"==typeof n.maxKeys&&(o=n.maxKeys);var l=e.length;o>0&&l>o&&(l=o);for(var h=0;h<l;++h){var c,u,d,f,p=e[h].replace(a,"%20"),m=p.indexOf(s);(m>=0?(c=p.substr(0,m),u=p.substr(m+1)):(c=p,u=""),d=decodeURIComponent(c),f=decodeURIComponent(u),Object.prototype.hasOwnProperty.call(i,d))?t(i[d])?i[d].push(f):i[d]=[i[d],f]:i[d]=f}return i};var t=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},577:function(e){var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,a,o){return(i=i||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e)?s(n(e),function(n){var o=encodeURIComponent(t(n))+a;return r(e[n])?s(e[n],function(e){return o+encodeURIComponent(t(e))}).join(i):o+encodeURIComponent(t(e[n]))}).join(i):o?encodeURIComponent(t(o))+a+encodeURIComponent(t(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e,t){if(e.map)return e.map(t);for(var r=[],s=0;s<e.length;s++)r.push(t(e[s],s));return r}var n=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={exports:{}},a=!0;try{t[e](i,i.exports,s),a=!1}finally{a&&delete r[e]}return i.exports}s.ab="//";var n={};n.decode=n.parse=s(815),n.encode=n.stringify=s(577),e.exports=n}()},89148:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});var s=r(29010);async function n(e,t){return await (0,s.wc)(e,"config.json",!0,t)}class i{constructor(e){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,e)}static async from_pretrained(e,{progress_callback:t=null,config:r=null,cache_dir:s=null,local_files_only:i=!1,revision:a="main"}={}){return new this(r??await n(e,{progress_callback:t,config:r,cache_dir:s,local_files_only:i,revision:a}))}}class a{static async from_pretrained(...e){return i.from_pretrained(...e)}}},93100:(e,t,r)=>{"use strict";let s,n,i,a;function o(e,t,r,s,n){if("m"===s)throw TypeError("Private method is not writable");if("a"===s&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r}function l(e,t,r,s){if("a"===r&&!s)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}r.d(t,{Ay:()=>sl});let h=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return h=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^r()&15>>e/4).toString(16))};function c(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let u=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class d extends Error{}class f extends d{constructor(e,t,r,s){super(`${f.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.requestID=s?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let s=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new m({message:r,cause:u(t)});let n=t?.error;return 400===e?new _(e,n,r,s):401===e?new y(e,n,r,s):403===e?new w(e,n,r,s):404===e?new b(e,n,r,s):409===e?new v(e,n,r,s):422===e?new x(e,n,r,s):429===e?new k(e,n,r,s):e>=500?new A(e,n,r,s):new f(e,n,r,s)}}class p extends f{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class m extends f{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class g extends m{constructor({message:e}={}){super({message:e??"Request timed out."})}}class _ extends f{}class y extends f{}class w extends f{}class b extends f{}class v extends f{}class x extends f{}class k extends f{}class A extends f{}class E extends d{constructor(){super("Could not parse response content as the length limit was reached")}}class S extends d{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class $ extends Error{constructor(e){super(e)}}let I=/^[a-z][a-z0-9+.-]*:/i,O=e=>(O=Array.isArray)(e),C=O;function M(e){return"object"!=typeof e?{}:e??{}}function T(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let R=e=>new Promise(t=>setTimeout(t,e)),U="6.9.1",B=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",z=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function P(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function j(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return P({start(){},async pull(e){let{done:r,value:s}=await t.next();r?e.close():e.enqueue(s)},async cancel(){await t.return?.()}})}function L(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function N(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}let F=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),D="RFC3986",q=e=>String(e),W={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:q},V=(e,t)=>(V=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),H=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function X(e,t){if(O(e)){let r=[];for(let s=0;s<e.length;s+=1)r.push(t(e[s]));return r}return t(e)}let K={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},G=function(e,t){Array.prototype.push.apply(e,O(t)?t:[t])},J={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,s,n)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===r)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,r=[];for(let e=0;e<t.length;++e){let s=t.charCodeAt(e);if(45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||"RFC1738"===n&&(40===s||41===s)){r[r.length]=t.charAt(e);continue}if(s<128){r[r.length]=H[s];continue}if(s<2048){r[r.length]=H[192|s>>6]+H[128|63&s];continue}if(s<55296||s>=57344){r[r.length]=H[224|s>>12]+H[128|s>>6&63]+H[128|63&s];continue}e+=1,s=65536+((1023&s)<<10|1023&t.charCodeAt(e)),r[r.length]=H[240|s>>18]+H[128|s>>12&63]+H[128|s>>6&63]+H[128|63&s]}a+=r.join("")}return a},encodeValuesOnly:!1,format:D,formatter:q,indices:!1,serializeDate:e=>(n??(n=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},Y={};function Q(e){let t;return(i??(i=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function Z(e){let t;return(a??(a=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class ee{constructor(){td.set(this,void 0),tf.set(this,void 0),o(this,td,new Uint8Array,"f"),o(this,tf,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?Q(e):e;o(this,td,function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),s=0;for(let t of e)r.set(t,s),s+=t.length;return r}([l(this,td,"f"),r]),"f");let s=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(l(this,td,"f"),l(this,tf,"f")));){if(t.carriage&&null==l(this,tf,"f")){o(this,tf,t.index,"f");continue}if(null!=l(this,tf,"f")&&(t.index!==l(this,tf,"f")+1||t.carriage)){s.push(Z(l(this,td,"f").subarray(0,l(this,tf,"f")-1))),o(this,td,l(this,td,"f").subarray(l(this,tf,"f")),"f"),o(this,tf,null,"f");continue}let e=null!==l(this,tf,"f")?t.preceding-1:t.preceding,r=Z(l(this,td,"f").subarray(0,e));s.push(r),o(this,td,l(this,td,"f").subarray(t.index),"f"),o(this,tf,null,"f")}return s}flush(){return l(this,td,"f").length?this.decode("\n"):[]}}td=new WeakMap,tf=new WeakMap,ee.NEWLINE_CHARS=new Set(["\n","\r"]),ee.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let et={off:0,error:200,warn:300,info:400,debug:500},er=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(et,e))return e;eo(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(et))}`)}};function es(){}function en(e,t,r){return!t||et[e]>et[r]?es:t[e].bind(t)}let ei={error:es,warn:es,info:es,debug:es},ea=new WeakMap;function eo(e){let t=e.logger,r=e.logLevel??"off";if(!t)return ei;let s=ea.get(t);if(s&&s[0]===r)return s[1];let n={error:en("error",t,r),warn:en("warn",t,r),info:en("info",t,r),debug:en("debug",t,r)};return ea.set(t,[r,n]),n}let el=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class eh{constructor(e,t,r){this.iterator=e,tp.set(this,void 0),this.controller=t,o(this,tp,r,"f")}static fromSSEResponse(e,t,r){let s=!1,n=r?eo(r):console;async function*i(){if(s)throw new d("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let r=!1;try{for await(let s of ec(e,t))if(!r){if(s.data.startsWith("[DONE]")){r=!0;continue}if(null!==s.event&&s.event.startsWith("thread.")){let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new f(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}else{let t;try{t=JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if(t&&t.error)throw new f(void 0,t.error,void 0,e.headers);yield t}}r=!0}catch(e){if(c(e))return;throw e}finally{r||t.abort()}}return new eh(i,t,r)}static fromReadableStream(e,t,r){let s=!1;async function*n(){let t=new ee;for await(let r of L(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new eh(async function*(){if(s)throw new d("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(c(e))return;throw e}finally{e||t.abort()}},t,r)}[(tp=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=s=>({next:()=>{if(0===s.length){let s=r.next();e.push(s),t.push(s)}return s.shift()}});return[new eh(()=>s(e),this.controller,l(this,tp,"f")),new eh(()=>s(t),this.controller,l(this,tp,"f"))]}toReadableStream(){let e,t=this;return P({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:s}=await e.next();if(s)return t.close();let n=Q(JSON.stringify(r)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*ec(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new d("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new d("Attempted to iterate over a response with no body")}let r=new ed,s=new ee;for await(let t of eu(L(e.body)))for(let e of s.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of s.flush()){let t=r.decode(e);t&&(yield t)}}async function*eu(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let s=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?Q(r):r,n=new Uint8Array(t.length+s.length);for(n.set(t),n.set(s,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class ed{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let r;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[s,n,i]=-1!==(r=(t=e).indexOf(":"))?[t.substring(0,r),":",t.substring(r+1)]:[t,"",""];return i.startsWith(" ")&&(i=i.substring(1)),"event"===s?this.event=i:"data"===s&&this.data.push(i),null}}async function ef(e,t){let{response:r,requestLogID:s,retryOfRequestLogID:n,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(eo(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):eh.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let s=r.headers.get("content-type"),n=s?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?ep(await r.json(),r):await r.text()})();return eo(e).debug(`[${s}] response parsed`,el({retryOfRequestLogID:n,url:r.url,status:r.status,body:a,durationMs:Date.now()-i})),a}function ep(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class em extends Promise{constructor(e,t,r=ef){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,tm.set(this,void 0),o(this,tm,e,"f")}_thenUnwrap(e){return new em(l(this,tm,"f"),this.responsePromise,async(t,r)=>ep(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(l(this,tm,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}tm=new WeakMap;class eg{constructor(e,t,r,s){tg.set(this,void 0),o(this,tg,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new d("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await l(this,tg,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(tg=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class e_ extends em{constructor(e,t,r){super(e,t,async(e,t)=>new r(e,t.response,await ef(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class ey extends eg{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class ew extends eg{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...M(this.options.query),after:t}}:null}}class eb extends eg{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...M(this.options.query),after:e}}:null}}let ev=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ex(e,t,r){return ev(),new File(e,t??"unknown_file",r)}function ek(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let eA=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],eE=async(e,t)=>eC(e.body)?{...e,body:await eI(e.body,t)}:e,eS=async(e,t)=>({...e,body:await eI(e.body,t)}),e$=new WeakMap,eI=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,r=e$.get(t);if(r)return r;let s=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,r=new FormData;if(r.toString()===await new e(r).text())return!1;return!0}catch{return!0}})();return e$.set(t,s),s}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>eM(r,e,t))),r},eO=e=>e instanceof Blob&&"name"in e,eC=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||eA(e)||eO(e)))return!0;if(Array.isArray(e))return e.some(eC);if(e&&"object"==typeof e){for(let t in e)if(eC(e[t]))return!0}return!1},eM=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r instanceof Response)e.append(t,ex([await r.blob()],ek(r)));else if(eA(r))e.append(t,ex([await new Response(j(r)).blob()],ek(r)));else if(eO(r))e.append(t,r,ek(r));else if(Array.isArray(r))await Promise.all(r.map(r=>eM(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,s])=>eM(e,`${t}[${r}]`,s)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}},eT=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function eR(e,t,r){let s,n;if(ev(),null!=(s=e=await e)&&"object"==typeof s&&"string"==typeof s.name&&"number"==typeof s.lastModified&&eT(s))return e instanceof File?e:ex([await e.arrayBuffer()],e.name);if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let s=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ex(await eU(s),t,r)}let i=await eU(e);if(t||(t=ek(e)),!r?.type){let e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r={...r,type:e})}return ex(i,t,r)}async function eU(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(eT(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(eA(e))for await(let r of e)t.push(...await eU(r));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class eB{constructor(e){this._client=e}}function ez(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let eP=Object.freeze(Object.create(null)),ej=((e=ez)=>function(t,...r){let s;if(1===t.length)return t[0];let n=!1,i=[],a=t.reduce((t,s,a)=>{/[?#]/.test(s)&&(n=!0);let o=r[a],l=(n?encodeURIComponent:e)(""+o);return a!==r.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??eP)??eP)?.toString)&&(l=o+"",i.push({start:t.length+s.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+s+(a===r.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(s=l.exec(o));)i.push({start:s.index,length:s[0].length,error:`Value "${s[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,r)=>{let s=" ".repeat(r.start-e),n="^".repeat(r.length);return e=r.start+r.length,t+s+n},"");throw new d(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(ez);class eL extends eB{list(e,t={},r){return this._client.getAPIList(ej`/chat/completions/${e}/messages`,ew,{query:t,...r})}}function eN(e){return void 0!==e&&"function"in e&&void 0!==e.function}function eF(e){return e?.$brand==="auto-parseable-response-format"}function eD(e){return e?.$brand==="auto-parseable-tool"}function eq(e,t){let r=e.choices.map(e=>{var r,s;if("length"===e.finish_reason)throw new E;if("content_filter"===e.finish_reason)throw new S;return eV(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var r,s;let n;return r=t,s=e,n=r.tools?.find(e=>eN(e)&&e.function?.name===s.function.name),{...s,function:{...s.function,parsed_arguments:eD(n)?n.$parseRaw(s.function.arguments):n?.function.strict?JSON.parse(s.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=t,s=e.message.content,r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(s):JSON.parse(s):null):null}}});return{...e,choices:r}}function eW(e){return!!eF(e.response_format)||(e.tools?.some(e=>eD(e)||"function"===e.type&&!0===e.function.strict)??!1)}function eV(e){for(let t of e||[])if("function"!==t.type)throw new d(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let eH=e=>e?.role==="assistant",eX=e=>e?.role==="tool";class eK{constructor(){t_.add(this),this.controller=new AbortController,ty.set(this,void 0),tw.set(this,()=>{}),tb.set(this,()=>{}),tv.set(this,void 0),tx.set(this,()=>{}),tk.set(this,()=>{}),tA.set(this,{}),tE.set(this,!1),tS.set(this,!1),t$.set(this,!1),tI.set(this,!1),o(this,ty,new Promise((e,t)=>{o(this,tw,e,"f"),o(this,tb,t,"f")}),"f"),o(this,tv,new Promise((e,t)=>{o(this,tx,e,"f"),o(this,tk,t,"f")}),"f"),l(this,ty,"f").catch(()=>{}),l(this,tv,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},l(this,t_,"m",tO).bind(this))},0)}_connected(){this.ended||(l(this,tw,"f").call(this),this._emit("connect"))}get ended(){return l(this,tE,"f")}get errored(){return l(this,tS,"f")}get aborted(){return l(this,t$,"f")}abort(){this.controller.abort()}on(e,t){return(l(this,tA,"f")[e]||(l(this,tA,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=l(this,tA,"f")[e];if(!r)return this;let s=r.findIndex(e=>e.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(l(this,tA,"f")[e]||(l(this,tA,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{o(this,tI,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){o(this,tI,!0,"f"),await l(this,tv,"f")}_emit(e,...t){if(l(this,tE,"f"))return;"end"===e&&(o(this,tE,!0,"f"),l(this,tx,"f").call(this));let r=l(this,tA,"f")[e];if(r&&(l(this,tA,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];l(this,tI,"f")||r?.length||Promise.reject(e),l(this,tb,"f").call(this,e),l(this,tk,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];l(this,tI,"f")||r?.length||Promise.reject(e),l(this,tb,"f").call(this,e),l(this,tk,"f").call(this,e),this._emit("end")}}_emitFinal(){}}ty=new WeakMap,tw=new WeakMap,tb=new WeakMap,tv=new WeakMap,tx=new WeakMap,tk=new WeakMap,tA=new WeakMap,tE=new WeakMap,tS=new WeakMap,t$=new WeakMap,tI=new WeakMap,t_=new WeakSet,tO=function(e){if(o(this,tS,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new p),e instanceof p)return o(this,t$,!0,"f"),this._emit("abort",e);if(e instanceof d)return this._emit("error",e);if(e instanceof Error){let t=new d(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new d(String(e)))};class eG extends eK{constructor(){super(...arguments),tC.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),eX(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(eH(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new d("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),l(this,tC,"m",tM).call(this)}async finalMessage(){return await this.done(),l(this,tC,"m",tT).call(this)}async finalFunctionToolCall(){return await this.done(),l(this,tC,"m",tR).call(this)}async finalFunctionToolCallResult(){return await this.done(),l(this,tC,"m",tU).call(this)}async totalUsage(){return await this.done(),l(this,tC,"m",tB).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=l(this,tC,"m",tT).call(this);t&&this._emit("finalMessage",t);let r=l(this,tC,"m",tM).call(this);r&&this._emit("finalContent",r);let s=l(this,tC,"m",tR).call(this);s&&this._emit("finalFunctionToolCall",s);let n=l(this,tC,"m",tU).call(this);null!=n&&this._emit("finalFunctionToolCallResult",n),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",l(this,tC,"m",tB).call(this))}async _createChatCompletion(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),l(this,tC,"m",tz).call(this,t);let n=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(eq(n,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let s="tool",{tool_choice:n="auto",stream:i,...a}=t,o="string"!=typeof n&&"function"===n.type&&n?.function?.name,{maxChatCompletions:h=10}=r||{},c=t.tools.map(e=>{if(eD(e)){if(!e.$callback)throw new d("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let f="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<h;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:n,tools:f,messages:[...this.messages]},r),i=t.choices[0]?.message;if(!i)throw new d("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:n,arguments:i}=e.function,a=u[n];if(a){if(o&&o!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:s,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:r,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:s,tool_call_id:r,content:e});continue}let h=await a.function(t,this),c=l(this,tC,"m",tP).call(this,h);if(this._addMessage({role:s,tool_call_id:r,content:c}),o)return}}}}tC=new WeakSet,tM=function(){return l(this,tC,"m",tT).call(this).content??null},tT=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(eH(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new d("stream ended without producing a ChatCompletionMessage with role=assistant")},tR=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(eH(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},tU=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(eX(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},tB=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},tz=function(e){if(null!=e.n&&e.n>1)throw new d("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},tP=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class eJ extends eG{static runTools(e,t,r){let s=new eJ,n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,n)),s}_addMessage(e,t=!0){super._addMessage(e,t),eH(e)&&e.content&&this._emit("content",e.content)}}let eY=511;class eQ extends Error{}class eZ extends Error{}let e0=e=>(function(e,t=eY){var r,s;let n,i,a,o,l,h,c,u,d,f;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return r=e.trim(),s=t,n=r.length,i=0,a=e=>{throw new eQ(`${e} at position ${i}`)},o=e=>{throw new eZ(`${e} at position ${i}`)},l=()=>(f(),i>=n&&a("Unexpected end of input"),'"'===r[i])?h():"{"===r[i]?c():"["===r[i]?u():"null"===r.substring(i,i+4)||16&s&&n-i<4&&"null".startsWith(r.substring(i))?(i+=4,null):"true"===r.substring(i,i+4)||32&s&&n-i<4&&"true".startsWith(r.substring(i))?(i+=4,!0):"false"===r.substring(i,i+5)||32&s&&n-i<5&&"false".startsWith(r.substring(i))?(i+=5,!1):"Infinity"===r.substring(i,i+8)||128&s&&n-i<8&&"Infinity".startsWith(r.substring(i))?(i+=8,1/0):"-Infinity"===r.substring(i,i+9)||256&s&&1<n-i&&n-i<9&&"-Infinity".startsWith(r.substring(i))?(i+=9,-1/0):"NaN"===r.substring(i,i+3)||64&s&&n-i<3&&"NaN".startsWith(r.substring(i))?(i+=3,NaN):d(),h=()=>{let e=i,t=!1;for(i++;i<n&&('"'!==r[i]||t&&"\\"===r[i-1]);)t="\\"===r[i]&&!t,i++;if('"'==r.charAt(i))try{return JSON.parse(r.substring(e,++i-Number(t)))}catch(e){o(String(e))}else if(1&s)try{return JSON.parse(r.substring(e,i-Number(t))+'"')}catch(t){return JSON.parse(r.substring(e,r.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},c=()=>{i++,f();let e={};try{for(;"}"!==r[i];){if(f(),i>=n&&8&s)return e;let t=h();f(),i++;try{let r=l();Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&s)return e;throw t}f(),","===r[i]&&i++}}catch(t){if(8&s)return e;a("Expected '}' at end of object")}return i++,e},u=()=>{i++;let e=[];try{for(;"]"!==r[i];)e.push(l()),f(),","===r[i]&&i++}catch(t){if(4&s)return e;a("Expected ']' at end of array")}return i++,e},d=()=>{if(0===i){"-"===r&&2&s&&a("Not sure what '-' is");try{return JSON.parse(r)}catch(e){if(2&s)try{if("."===r[r.length-1])return JSON.parse(r.substring(0,r.lastIndexOf(".")));return JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=i;for("-"===r[i]&&i++;r[i]&&!",]}".includes(r[i]);)i++;i!=n||2&s||a("Unterminated number literal");try{return JSON.parse(r.substring(e,i))}catch(t){"-"===r.substring(e,i)&&2&s&&a("Not sure what '-' is");try{return JSON.parse(r.substring(e,r.lastIndexOf("e")))}catch(e){o(String(e))}}},f=()=>{for(;i<n&&" \n\r	".includes(r[i]);)i++},l()})(e,2^eY);class e1 extends eG{constructor(e){super(),tj.add(this),tL.set(this,void 0),tN.set(this,void 0),tF.set(this,void 0),o(this,tL,e,"f"),o(this,tN,[],"f")}get currentChatCompletionSnapshot(){return l(this,tF,"f")}static fromReadableStream(e){let t=new e1(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new e1(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){super._createChatCompletion;let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),l(this,tj,"m",tD).call(this);let n=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),n))l(this,tj,"m",tW).call(this,e);if(n.controller.signal?.aborted)throw new p;return this._addChatCompletion(l(this,tj,"m",tX).call(this))}async _fromReadableStream(e,t){let r,s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),l(this,tj,"m",tD).call(this),this._connected();let n=eh.fromReadableStream(e,this.controller);for await(let e of n)r&&r!==e.id&&this._addChatCompletion(l(this,tj,"m",tX).call(this)),l(this,tj,"m",tW).call(this,e),r=e.id;if(n.controller.signal?.aborted)throw new p;return this._addChatCompletion(l(this,tj,"m",tX).call(this))}[(tL=new WeakMap,tN=new WeakMap,tF=new WeakMap,tj=new WeakSet,tD=function(){this.ended||o(this,tF,void 0,"f")},tq=function(e){let t=l(this,tN,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},l(this,tN,"f")[e.index]=t),t},tW=function(e){if(this.ended)return;let t=l(this,tj,"m",tG).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let s=l(this,tj,"m",tq).call(this,e);for(let t of(e.finish_reason&&(l(this,tj,"m",tH).call(this,e),null!=s.current_tool_call_index&&l(this,tj,"m",tV).call(this,e,s.current_tool_call_index)),r.delta.tool_calls??[]))s.current_tool_call_index!==t.index&&(l(this,tj,"m",tH).call(this,e),null!=s.current_tool_call_index&&l(this,tj,"m",tV).call(this,e,s.current_tool_call_index)),s.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):r?.type)}}},tV=function(e,t){if(l(this,tj,"m",tq).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=l(this,tL,"f")?.tools?.find(e=>eN(e)&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:eD(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},tH=function(e){let t=l(this,tj,"m",tq).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=l(this,tj,"m",tK).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},tX=function(){if(this.ended)throw new d("stream has ended, this shouldn't happen");let e=l(this,tF,"f");if(!e)throw new d("request ended without sending any chunks");return o(this,tF,void 0,"f"),o(this,tN,[],"f"),function(e,t){var r;let{id:s,choices:n,created:i,model:a,system_fingerprint:o,...l}=e;return r={...l,id:s,choices:n.map(({message:t,finish_reason:r,index:s,logprobs:n,...i})=>{if(!r)throw new d(`missing finish_reason for choice ${s}`);let{content:a=null,function_call:o,tool_calls:l,...h}=t,c=t.role;if(!c)throw new d(`missing role for choice ${s}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new d(`missing function_call.arguments for choice ${s}`);if(!l)throw new d(`missing function_call.name for choice ${s}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:r,index:s,logprobs:n}}return l?{...i,index:s,finish_reason:r,logprobs:n,message:{...h,role:c,content:a,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:n,type:i,id:a,...o}=t,{arguments:l,name:h,...c}=n||{};if(null==a)throw new d(`missing choices[${s}].tool_calls[${r}].id
${e2(e)}`);if(null==i)throw new d(`missing choices[${s}].tool_calls[${r}].type
${e2(e)}`);if(null==h)throw new d(`missing choices[${s}].tool_calls[${r}].function.name
${e2(e)}`);if(null==l)throw new d(`missing choices[${s}].tool_calls[${r}].function.arguments
${e2(e)}`);return{...o,id:a,type:i,function:{...c,name:h,arguments:l}}})}}:{...i,message:{...h,content:a,role:c,refusal:t.refusal??null},finish_reason:r,index:s,logprobs:n}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&eW(t)?eq(r,t):{...r,choices:r.choices.map(e=>(eV(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,l(this,tL,"f"))},tK=function(){let e=l(this,tL,"f")?.response_format;return eF(e)?e:null},tG=function(e){var t,r,s,n;let i=l(this,tF,"f"),{choices:a,...h}=e;for(let{delta:a,finish_reason:c,index:u,logprobs:d=null,...f}of(i?Object.assign(i,h):i=o(this,tF,{...h,choices:[]},"f"),e.choices)){let e=i.choices[u];if(e||(e=i.choices[u]={finish_reason:c,index:u,message:{},logprobs:d,...f}),d)if(e.logprobs){let{content:s,refusal:n,...i}=d;Object.assign(e.logprobs,i),s&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...s)),n&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...n))}else e.logprobs=Object.assign({},d);if(c&&(e.finish_reason=c,l(this,tL,"f")&&eW(l(this,tL,"f")))){if("length"===c)throw new E;if("content_filter"===c)throw new S}if(Object.assign(e,f),!a)continue;let{content:o,refusal:h,function_call:p,role:m,tool_calls:g,..._}=a;if(Object.assign(e.message,_),h&&(e.message.refusal=(e.message.refusal||"")+h),m&&(e.message.role=m),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((s=e.message.function_call).arguments??(s.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&l(this,tj,"m",tK).call(this)&&(e.message.parsed=e0(e.message.content))),g)for(let{index:t,id:r,type:s,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),g)){let o=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(o,a),r&&(o.id=r),s&&(o.type=s),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let r=e.tools?.find(e=>eN(e)&&e.function?.name===t.function.name);return eN(r)&&(eD(r)||r?.function.strict||!1)}(l(this,tL,"f"),o)&&(o.function.parsed_arguments=e0(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let s=t.shift();s?s.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let s of(r=!0,t))s.reject(e);t.length=0}),this.on("error",e=>{for(let s of(r=!0,t))s.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new eh(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function e2(e){return JSON.stringify(e)}class e3 extends e1{static fromReadableStream(e){let t=new e3(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let s=new e3(t),n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,n)),s}}class e8 extends eB{constructor(){super(...arguments),this.messages=new eL(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(ej`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(ej`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",ew,{query:e,...t})}delete(e,t){return this._client.delete(ej`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new d(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new d(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>eq(t,e))}runTools(e,t){return e.stream?e3.runTools(this._client,e,t):eJ.runTools(this._client,e,t)}stream(e,t){return e1.createChatCompletion(this._client,e,t)}}e8.Messages=eL;class e4 extends eB{constructor(){super(...arguments),this.completions=new e8(this._client)}}e4.Completions=e8;let e6=Symbol("brand.privateNullableHeaders"),e5=e=>{let t=new Headers,r=new Set;for(let s of e){let e=new Set;for(let[n,i]of function*(e){let t;if(!e)return;if(e6 in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let s of(e instanceof Headers?t=e.entries():C(e)?t=e:(r=!0,t=Object.entries(e??{})),t)){let e=s[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=C(s[1])?s[1]:[s[1]],n=!1;for(let s of t)void 0!==s&&(r&&!n&&(n=!0,yield[e,null]),yield[e,s])}}(s)){let s=n.toLowerCase();e.has(s)||(t.delete(n),e.add(s)),null===i?(t.delete(n),r.add(s)):(t.append(n,i),r.delete(s))}}return{[e6]:!0,values:t,nulls:r}};class e7 extends eB{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:e5([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class e9 extends eB{create(e,t){return this._client.post("/audio/transcriptions",eS({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class te extends eB{create(e,t){return this._client.post("/audio/translations",eS({body:e,...t,__metadata:{model:e.model}},this._client))}}class tt extends eB{constructor(){super(...arguments),this.transcriptions=new e9(this._client),this.translations=new te(this._client),this.speech=new e7(this._client)}}tt.Transcriptions=e9,tt.Translations=te,tt.Speech=e7;class tr extends eB{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(ej`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",ew,{query:e,...t})}cancel(e,t){return this._client.post(ej`/batches/${e}/cancel`,t)}}class ts extends eB{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(ej`/assistants/${e}`,{...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(ej`/assistants/${e}`,{body:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",ew,{query:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(ej`/assistants/${e}`,{...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class tn extends eB{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ti extends eB{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ta extends eB{constructor(){super(...arguments),this.sessions=new tn(this._client),this.transcriptionSessions=new ti(this._client)}}ta.Sessions=tn,ta.TranscriptionSessions=ti;class to extends eB{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:e5([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(ej`/chatkit/sessions/${e}/cancel`,{...t,headers:e5([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class tl extends eB{retrieve(e,t){return this._client.get(ej`/chatkit/threads/${e}`,{...t,headers:e5([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",eb,{query:e,...t,headers:e5([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(ej`/chatkit/threads/${e}`,{...t,headers:e5([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},r){return this._client.getAPIList(ej`/chatkit/threads/${e}/items`,eb,{query:t,...r,headers:e5([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}}class th extends eB{constructor(){super(...arguments),this.sessions=new to(this._client),this.threads=new tl(this._client)}}th.Sessions=to,th.Threads=tl;class tc extends eB{create(e,t,r){return this._client.post(ej`/threads/${e}/messages`,{body:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:s}=t;return this._client.get(ej`/threads/${s}/messages/${e}`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:s,...n}=t;return this._client.post(ej`/threads/${s}/messages/${e}`,{body:n,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(ej`/threads/${e}/messages`,ew,{query:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:s}=t;return this._client.delete(ej`/threads/${s}/messages/${e}`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class tu extends eB{retrieve(e,t,r){let{thread_id:s,run_id:n,...i}=t;return this._client.get(ej`/threads/${s}/runs/${n}/steps/${e}`,{query:i,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:s,...n}=t;return this._client.getAPIList(ej`/threads/${s}/runs/${e}/steps`,ew,{query:n,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}var td,tf,tp,tm,tg,t_,ty,tw,tb,tv,tx,tk,tA,tE,tS,t$,tI,tO,tC,tM,tT,tR,tU,tB,tz,tP,tj,tL,tN,tF,tD,tq,tW,tV,tH,tX,tK,tG,tJ,tY,tQ,tZ,t0,t1,t2,t3,t8,t4,t6,t5,t7,t9,re,rt,rr,rs,rn,ri,ra,ro,rl,rh,rc,ru,rd,rf,rp,rm,rg,r_,ry,rw,rb,rv,rx,rk,rA=r(49304).hp;let rE=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class rS extends eK{constructor(){super(...arguments),tJ.add(this),tQ.set(this,[]),tZ.set(this,{}),t0.set(this,{}),t1.set(this,void 0),t2.set(this,void 0),t3.set(this,void 0),t8.set(this,void 0),t4.set(this,void 0),t6.set(this,void 0),t5.set(this,void 0),t7.set(this,void 0),t9.set(this,void 0)}[(tQ=new WeakMap,tZ=new WeakMap,t0=new WeakMap,t1=new WeakMap,t2=new WeakMap,t3=new WeakMap,t8=new WeakMap,t4=new WeakMap,t6=new WeakMap,t5=new WeakMap,t7=new WeakMap,t9=new WeakMap,tJ=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let s=t.shift();s?s.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let s of(r=!0,t))s.reject(e);t.length=0}),this.on("error",e=>{for(let s of(r=!0,t))s.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new tY;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=eh.fromReadableStream(e,this.controller);for await(let e of s)l(this,tJ,"m",re).call(this,e);if(s.controller.signal?.aborted)throw new p;return this._addRun(l(this,tJ,"m",rt).call(this))}toReadableStream(){return new eh(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s){let n=new tY;return n._run(()=>n._runToolAssistantStream(e,t,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createToolAssistantStream(e,t,r,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},a=await e.submitToolOutputs(t,i,{...s,signal:this.controller.signal});for await(let e of(this._connected(),a))l(this,tJ,"m",re).call(this,e);if(a.controller.signal?.aborted)throw new p;return this._addRun(l(this,tJ,"m",rt).call(this))}static createThreadAssistantStream(e,t,r){let s=new tY;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){let n=new tY;return n._run(()=>n._runAssistantStream(e,t,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}currentEvent(){return l(this,t5,"f")}currentRun(){return l(this,t7,"f")}currentMessageSnapshot(){return l(this,t1,"f")}currentRunStepSnapshot(){return l(this,t9,"f")}async finalRunSteps(){return await this.done(),Object.values(l(this,tZ,"f"))}async finalMessages(){return await this.done(),Object.values(l(this,t0,"f"))}async finalRun(){if(await this.done(),!l(this,t2,"f"))throw Error("Final run was not received.");return l(this,t2,"f")}async _createThreadAssistantStream(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let n={...t,stream:!0},i=await e.createAndRun(n,{...r,signal:this.controller.signal});for await(let e of(this._connected(),i))l(this,tJ,"m",re).call(this,e);if(i.controller.signal?.aborted)throw new p;return this._addRun(l(this,tJ,"m",rt).call(this))}async _createAssistantStream(e,t,r,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},a=await e.create(t,i,{...s,signal:this.controller.signal});for await(let e of(this._connected(),a))l(this,tJ,"m",re).call(this,e);if(a.controller.signal?.aborted)throw new p;return this._addRun(l(this,tJ,"m",rt).call(this))}static accumulateDelta(e,t){for(let[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=s;continue}if("string"==typeof t&&"string"==typeof s)t+=s;else if("number"==typeof t&&"number"==typeof s)t+=s;else if(T(t)&&T(s))t=this.accumulateDelta(t,s);else if(Array.isArray(t)&&Array.isArray(s)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...s);continue}for(let e of s){if(!T(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let s=t[r];null==s?t.push(e):t[r]=this.accumulateDelta(s,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s){return await this._createToolAssistantStream(t,e,r,s)}}tY=rS,re=function(e){if(!this.ended)switch(o(this,t5,e,"f"),l(this,tJ,"m",rn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":l(this,tJ,"m",rl).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":l(this,tJ,"m",rs).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":l(this,tJ,"m",rr).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},rt=function(){if(this.ended)throw new d("stream has ended, this shouldn't happen");if(!l(this,t2,"f"))throw Error("Final run has not been received");return l(this,t2,"f")},rr=function(e){let[t,r]=l(this,tJ,"m",ra).call(this,e,l(this,t1,"f"));for(let e of(o(this,t1,t,"f"),l(this,t0,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,s=t.content[r.index];if(s&&"text"==s.type)this._emit("textDelta",e,s.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=l(this,t3,"f")){if(l(this,t8,"f"))switch(l(this,t8,"f").type){case"text":this._emit("textDone",l(this,t8,"f").text,l(this,t1,"f"));break;case"image_file":this._emit("imageFileDone",l(this,t8,"f").image_file,l(this,t1,"f"))}o(this,t3,r.index,"f")}o(this,t8,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==l(this,t3,"f")){let t=e.data.content[l(this,t3,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,l(this,t1,"f"));break;case"text":this._emit("textDone",t.text,l(this,t1,"f"))}}l(this,t1,"f")&&this._emit("messageDone",e.data),o(this,t1,void 0,"f")}},rs=function(e){let t=l(this,tJ,"m",ri).call(this,e);switch(o(this,t9,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==l(this,t4,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(l(this,t6,"f")&&this._emit("toolCallDone",l(this,t6,"f")),o(this,t4,e.index,"f"),o(this,t6,t.step_details.tool_calls[e.index],"f"),l(this,t6,"f")&&this._emit("toolCallCreated",l(this,t6,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":o(this,t9,void 0,"f"),"tool_calls"==e.data.step_details.type&&l(this,t6,"f")&&(this._emit("toolCallDone",l(this,t6,"f")),o(this,t6,void 0,"f")),this._emit("runStepDone",e.data,t)}},rn=function(e){l(this,tQ,"f").push(e),this._emit("event",e)},ri=function(e){switch(e.event){case"thread.run.step.created":return l(this,tZ,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=l(this,tZ,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let s=tY.accumulateDelta(t,r.delta);l(this,tZ,"f")[e.data.id]=s}return l(this,tZ,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":l(this,tZ,"f")[e.data.id]=e.data}if(l(this,tZ,"f")[e.data.id])return l(this,tZ,"f")[e.data.id];throw Error("No snapshot available")},ra=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let e of s.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=l(this,tJ,"m",ro).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ro=function(e,t){return tY.accumulateDelta(t,e)},rl=function(e){switch(o(this,t7,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":o(this,t2,e.data,"f"),l(this,t6,"f")&&(this._emit("toolCallDone",l(this,t6,"f")),o(this,t6,void 0,"f"))}};class r$ extends eB{constructor(){super(...arguments),this.steps=new tu(this._client)}create(e,t,r){let{include:s,...n}=t;return this._client.post(ej`/threads/${e}/runs`,{query:{include:s},body:n,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:s}=t;return this._client.get(ej`/threads/${s}/runs/${e}`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:s,...n}=t;return this._client.post(ej`/threads/${s}/runs/${e}`,{body:n,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(ej`/threads/${e}/runs`,ew,{query:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:s}=t;return this._client.post(ej`/threads/${s}/runs/${e}/cancel`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(s.id,{thread_id:e},r)}createAndStream(e,t,r){return rS.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let s=e5([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:i}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...s}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await R(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,r){return rS.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:s,...n}=t;return this._client.post(ej`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:n,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let s=await this.submitToolOutputs(e,t,r);return await this.poll(s.id,t,r)}submitToolOutputsStream(e,t,r){return rS.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}}r$.Steps=tu;class rI extends eB{constructor(){super(...arguments),this.runs=new r$(this._client),this.messages=new tc(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(ej`/threads/${e}`,{...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(ej`/threads/${e}`,{body:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(ej`/threads/${e}`,{...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return rS.createThreadAssistantStream(e,this._client.beta.threads,t)}}rI.Runs=r$,rI.Messages=tc;class rO extends eB{constructor(){super(...arguments),this.realtime=new ta(this._client),this.chatkit=new th(this._client),this.assistants=new ts(this._client),this.threads=new rI(this._client)}}rO.Realtime=ta,rO.ChatKit=th,rO.Assistants=ts,rO.Threads=rI;class rC extends eB{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class rM extends eB{retrieve(e,t,r){let{container_id:s}=t;return this._client.get(ej`/containers/${s}/files/${e}/content`,{...r,headers:e5([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}}class rT extends eB{constructor(){super(...arguments),this.content=new rM(this._client)}create(e,t,r){return this._client.post(ej`/containers/${e}/files`,eS({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:s}=t;return this._client.get(ej`/containers/${s}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(ej`/containers/${e}/files`,ew,{query:t,...r})}delete(e,t,r){let{container_id:s}=t;return this._client.delete(ej`/containers/${s}/files/${e}`,{...r,headers:e5([{Accept:"*/*"},r?.headers])})}}rT.Content=rM;class rR extends eB{constructor(){super(...arguments),this.files=new rT(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(ej`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",ew,{query:e,...t})}delete(e,t){return this._client.delete(ej`/containers/${e}`,{...t,headers:e5([{Accept:"*/*"},t?.headers])})}}rR.Files=rT;class rU extends eB{create(e,t,r){let{include:s,...n}=t;return this._client.post(ej`/conversations/${e}/items`,{query:{include:s},body:n,...r})}retrieve(e,t,r){let{conversation_id:s,...n}=t;return this._client.get(ej`/conversations/${s}/items/${e}`,{query:n,...r})}list(e,t={},r){return this._client.getAPIList(ej`/conversations/${e}/items`,eb,{query:t,...r})}delete(e,t,r){let{conversation_id:s}=t;return this._client.delete(ej`/conversations/${s}/items/${e}`,r)}}class rB extends eB{constructor(){super(...arguments),this.items=new rU(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(ej`/conversations/${e}`,t)}update(e,t,r){return this._client.post(ej`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete(ej`/conversations/${e}`,t)}}rB.Items=rU;class rz extends eB{create(e,t){let r=!!e.encoding_format,s=r?e.encoding_format:"base64";r&&eo(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let n=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?n:(eo(this._client).debug("embeddings/decoding base64 embeddings from base64"),n._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if(void 0!==rA){let t=rA.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,s=new Uint8Array(r);for(let e=0;e<r;e++)s[e]=t.charCodeAt(e);return Array.from(new Float32Array(s.buffer))}})(t)}),e)))}}class rP extends eB{retrieve(e,t,r){let{eval_id:s,run_id:n}=t;return this._client.get(ej`/evals/${s}/runs/${n}/output_items/${e}`,r)}list(e,t,r){let{eval_id:s,...n}=t;return this._client.getAPIList(ej`/evals/${s}/runs/${e}/output_items`,ew,{query:n,...r})}}class rj extends eB{constructor(){super(...arguments),this.outputItems=new rP(this._client)}create(e,t,r){return this._client.post(ej`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:s}=t;return this._client.get(ej`/evals/${s}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(ej`/evals/${e}/runs`,ew,{query:t,...r})}delete(e,t,r){let{eval_id:s}=t;return this._client.delete(ej`/evals/${s}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:s}=t;return this._client.post(ej`/evals/${s}/runs/${e}`,r)}}rj.OutputItems=rP;class rL extends eB{constructor(){super(...arguments),this.runs=new rj(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(ej`/evals/${e}`,t)}update(e,t,r){return this._client.post(ej`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",ew,{query:e,...t})}delete(e,t){return this._client.delete(ej`/evals/${e}`,t)}}rL.Runs=rj;class rN extends eB{create(e,t){return this._client.post("/files",eS({body:e,...t},this._client))}retrieve(e,t){return this._client.get(ej`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",ew,{query:e,...t})}delete(e,t){return this._client.delete(ej`/files/${e}`,t)}content(e,t){return this._client.get(ej`/files/${e}/content`,{...t,headers:e5([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let s=new Set(["processed","error","deleted"]),n=Date.now(),i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await R(t),i=await this.retrieve(e),Date.now()-n>r)throw new g({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}}class rF extends eB{}class rD extends eB{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class rq extends eB{constructor(){super(...arguments),this.graders=new rD(this._client)}}rq.Graders=rD;class rW extends eB{create(e,t,r){return this._client.getAPIList(ej`/fine_tuning/checkpoints/${e}/permissions`,ey,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(ej`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:s}=t;return this._client.delete(ej`/fine_tuning/checkpoints/${s}/permissions/${e}`,r)}}class rV extends eB{constructor(){super(...arguments),this.permissions=new rW(this._client)}}rV.Permissions=rW;class rH extends eB{list(e,t={},r){return this._client.getAPIList(ej`/fine_tuning/jobs/${e}/checkpoints`,ew,{query:t,...r})}}class rX extends eB{constructor(){super(...arguments),this.checkpoints=new rH(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(ej`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",ew,{query:e,...t})}cancel(e,t){return this._client.post(ej`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(ej`/fine_tuning/jobs/${e}/events`,ew,{query:t,...r})}pause(e,t){return this._client.post(ej`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(ej`/fine_tuning/jobs/${e}/resume`,t)}}rX.Checkpoints=rH;class rK extends eB{constructor(){super(...arguments),this.methods=new rF(this._client),this.jobs=new rX(this._client),this.checkpoints=new rV(this._client),this.alpha=new rq(this._client)}}rK.Methods=rF,rK.Jobs=rX,rK.Checkpoints=rV,rK.Alpha=rq;class rG extends eB{}class rJ extends eB{constructor(){super(...arguments),this.graderModels=new rG(this._client)}}rJ.GraderModels=rG;class rY extends eB{createVariation(e,t){return this._client.post("/images/variations",eS({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",eS({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class rQ extends eB{retrieve(e,t){return this._client.get(ej`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ey,e)}delete(e,t){return this._client.delete(ej`/models/${e}`,t)}}class rZ extends eB{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class r0 extends eB{accept(e,t,r){return this._client.post(ej`/realtime/calls/${e}/accept`,{body:t,...r,headers:e5([{Accept:"*/*"},r?.headers])})}hangup(e,t){return this._client.post(ej`/realtime/calls/${e}/hangup`,{...t,headers:e5([{Accept:"*/*"},t?.headers])})}refer(e,t,r){return this._client.post(ej`/realtime/calls/${e}/refer`,{body:t,...r,headers:e5([{Accept:"*/*"},r?.headers])})}reject(e,t={},r){return this._client.post(ej`/realtime/calls/${e}/reject`,{body:t,...r,headers:e5([{Accept:"*/*"},r?.headers])})}}class r1 extends eB{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class r2 extends eB{constructor(){super(...arguments),this.clientSecrets=new r1(this._client),this.calls=new r0(this._client)}}function r3(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,s;let n=(r=e.tools??[],s=t.name,r.find(e=>"function"===e.type&&e.name===s));return{...t,...t,parsed_arguments:n?.$brand==="auto-parseable-tool"?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r,s;return"output_text"===e.type?{...e,parsed:(r=t,s=e.text,r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(s):JSON.parse(s))}:e});return{...e,content:r}}return e}),s=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||r8(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(let e of s.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),s}function r8(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}r2.ClientSecrets=r1,r2.Calls=r0;class r4 extends eK{constructor(e){super(),rh.add(this),rc.set(this,void 0),ru.set(this,void 0),rd.set(this,void 0),o(this,rc,e,"f")}static createResponse(e,t,r){let s=new r4(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){let s,n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),l(this,rh,"m",rf).call(this);let i=null;for await(let n of("response_id"in t?(s=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):s=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),s))l(this,rh,"m",rp).call(this,n,i);if(s.controller.signal?.aborted)throw new p;return l(this,rh,"m",rm).call(this)}[(rc=new WeakMap,ru=new WeakMap,rd=new WeakMap,rh=new WeakSet,rf=function(){this.ended||o(this,ru,void 0,"f")},rp=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},s=l(this,rh,"m",rg).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=s.output[e.output_index];if(!t)throw new d(`missing output at index ${e.output_index}`);if("message"===t.type){let s=t.content[e.content_index];if(!s)throw new d(`missing content at index ${e.content_index}`);if("output_text"!==s.type)throw new d(`expected content to be 'output_text', got ${s.type}`);r("response.output_text.delta",{...e,snapshot:s.text})}break}case"response.function_call_arguments.delta":{let t=s.output[e.output_index];if(!t)throw new d(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},rm=function(){if(this.ended)throw new d("stream has ended, this shouldn't happen");let e=l(this,ru,"f");if(!e)throw new d("request ended without sending any events");o(this,ru,void 0,"f");let t=function(e,t){var r;return t&&(r=t,eF(r.text?.format))?r3(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,l(this,rc,"f"));return o(this,rd,t,"f"),t},rg=function(e){let t=l(this,ru,"f");if(!t){if("response.created"!==e.type)throw new d(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return o(this,ru,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new d(`missing output at index ${e.output_index}`);let s=r.type,n=e.part;"message"===s&&"reasoning_text"!==n.type?r.content.push(n):"reasoning"===s&&"reasoning_text"===n.type&&(r.content||(r.content=[]),r.content.push(n));break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new d(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new d(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new d(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new d(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.reasoning_text.delta":{let r=t.output[e.output_index];if(!r)throw new d(`missing output at index ${e.output_index}`);if("reasoning"===r.type){let t=r.content?.[e.content_index];if(!t)throw new d(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new d(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":o(this,ru,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let s=t.shift();s?s.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let s of(r=!0,t))s.reject(e);t.length=0}),this.on("error",e=>{for(let s of(r=!0,t))s.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=l(this,rd,"f");if(!e)throw new d("stream ended without producing a ChatCompletion");return e}}class r6 extends eB{list(e,t={},r){return this._client.getAPIList(ej`/responses/${e}/input_items`,ew,{query:t,...r})}}class r5 extends eB{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class r7 extends eB{constructor(){super(...arguments),this.inputItems=new r6(this._client),this.inputTokens=new r5(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&r8(e),e))}retrieve(e,t={},r){return this._client.get(ej`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&r8(e),e))}delete(e,t){return this._client.delete(ej`/responses/${e}`,{...t,headers:e5([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>r3(t,e))}stream(e,t){return r4.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(ej`/responses/${e}/cancel`,t)}}r7.InputItems=r6,r7.InputTokens=r5;class r9 extends eB{create(e,t,r){return this._client.post(ej`/uploads/${e}/parts`,eS({body:t,...r},this._client))}}class se extends eB{constructor(){super(...arguments),this.parts=new r9(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(ej`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(ej`/uploads/${e}/complete`,{body:t,...r})}}se.Parts=r9;let st=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let s=[];for(let e of t)"fulfilled"===e.status&&s.push(e.value);return s};class sr extends eB{create(e,t,r){return this._client.post(ej`/vector_stores/${e}/file_batches`,{body:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:s}=t;return this._client.get(ej`/vector_stores/${s}/file_batches/${e}`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:s}=t;return this._client.post(ej`/vector_stores/${s}/file_batches/${e}/cancel`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r){let{vector_store_id:s,...n}=t;return this._client.getAPIList(ej`/vector_stores/${s}/file_batches/${e}/files`,ew,{query:n,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let s=e5([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:i}=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse();switch(n.status){case"in_progress":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await R(a);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let n=Math.min(s?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...r];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},s);o.push(e.id)}}let h=Array(n).fill(a).map(l);return await st(h),await this.createAndPoll(e,{file_ids:o})}}class ss extends eB{create(e,t,r){return this._client.post(ej`/vector_stores/${e}/files`,{body:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:s}=t;return this._client.get(ej`/vector_stores/${s}/files/${e}`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:s,...n}=t;return this._client.post(ej`/vector_stores/${s}/files/${e}`,{body:n,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(ej`/vector_stores/${e}/files`,ew,{query:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:s}=t;return this._client.delete(ej`/vector_stores/${s}/files/${e}`,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){let s=e5([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let n=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse(),i=n.data;switch(i.status){case"in_progress":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let e=n.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await R(a);break;case"failed":case"completed":return i}}}async upload(e,t,r){let s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){let s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){let{vector_store_id:s}=t;return this._client.getAPIList(ej`/vector_stores/${s}/files/${e}/content`,ey,{...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class sn extends eB{constructor(){super(...arguments),this.files=new ss(this._client),this.fileBatches=new sr(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(ej`/vector_stores/${e}`,{...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(ej`/vector_stores/${e}`,{body:t,...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",ew,{query:e,...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(ej`/vector_stores/${e}`,{...t,headers:e5([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(ej`/vector_stores/${e}/search`,ey,{body:t,method:"post",...r,headers:e5([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}sn.Files=ss,sn.FileBatches=sr;class si extends eB{create(e,t){return this._client.post("/videos",eE({body:e,...t},this._client))}retrieve(e,t){return this._client.get(ej`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",eb,{query:e,...t})}delete(e,t){return this._client.delete(ej`/videos/${e}`,t)}downloadContent(e,t={},r){return this._client.get(ej`/videos/${e}/content`,{query:t,...r,headers:e5([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}remix(e,t,r){return this._client.post(ej`/videos/${e}/remix`,eE({body:t,...r},this._client))}}var sa=r(49304).hp;class so extends eB{constructor(){super(...arguments),r_.add(this)}async unwrap(e,t,r=this._client.webhookSecret,s=300){return await this.verifySignature(e,t,r,s),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,s=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");l(this,r_,"m",ry).call(this,r);let n=e5([t]).values,i=l(this,r_,"m",rw).call(this,n,"webhook-signature"),a=l(this,r_,"m",rw).call(this,n,"webhook-timestamp"),o=l(this,r_,"m",rw).call(this,n,"webhook-id"),h=parseInt(a,10);if(isNaN(h))throw new $("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-h>s)throw new $("Webhook timestamp is too old");if(h>c+s)throw new $("Webhook timestamp is too new");let u=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=r.startsWith("whsec_")?sa.from(r.replace("whsec_",""),"base64"):sa.from(r,"utf-8"),f=o?`${o}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=sa.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(f)))return}catch{continue}throw new $("The given webhook signature does not match the expected signature")}}r_=new WeakSet,ry=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},rw=function(e,t){if(!e)throw Error("Headers are required");let r=e.get(t);if(null==r)throw Error(`Missing required header: ${t}`);return r};class sl{constructor({baseURL:e=rE("OPENAI_BASE_URL"),apiKey:t=rE("OPENAI_API_KEY"),organization:r=rE("OPENAI_ORG_ID")??null,project:s=rE("OPENAI_PROJECT_ID")??null,webhookSecret:n=rE("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(rb.add(this),rx.set(this,void 0),this.completions=new rC(this),this.chat=new e4(this),this.embeddings=new rz(this),this.files=new rN(this),this.images=new rY(this),this.audio=new tt(this),this.moderations=new rZ(this),this.models=new rQ(this),this.fineTuning=new rK(this),this.graders=new rJ(this),this.vectorStores=new sn(this),this.webhooks=new so(this),this.beta=new rO(this),this.batches=new tr(this),this.uploads=new se(this),this.responses=new r7(this),this.realtime=new r2(this),this.conversations=new rB(this),this.evals=new rL(this),this.containers=new rR(this),this.videos=new si(this),void 0===t)throw new d("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const a={apiKey:t,organization:r,project:s,webhookSecret:n,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new d("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??rv.DEFAULT_TIMEOUT,this.logger=a.logger??console;const l="warn";this.logLevel=l,this.logLevel=er(a.logLevel,"ClientOptions.logLevel",this)??er(rE("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),o(this,rx,F,"f"),this._options=a,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=r,this.project=s,this.webhookSecret=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return e5([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let r,s=e,n=function(e=J){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||J.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let s=D;if(void 0!==e.format){if(!V(W,e.format))throw TypeError("Unknown format option provided.");s=e.format}let n=W[s],i=J.filter;if(("function"==typeof e.filter||O(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in K?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":J.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||J.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:J.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:J.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:J.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?J.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:J.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:J.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:J.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:J.encodeValuesOnly,filter:i,format:s,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:J.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:J.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:J.strictNullHandling}}(t);"function"==typeof n.filter?s=(0,n.filter)("",s):O(n.filter)&&(r=n.filter);let i=[];if("object"!=typeof s||null===s)return"";let a=K[n.arrayFormat],o="comma"===a&&n.commaRoundTrip;r||(r=Object.keys(s)),n.sort&&r.sort(n.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];n.skipNulls&&null===s[t]||G(i,function e(t,r,s,n,i,a,o,l,h,c,u,d,f,p,m,g,_,y){var w,b;let v,x=t,k=y,A=0,E=!1;for(;void 0!==(k=k.get(Y))&&!E;){let e=k.get(t);if(A+=1,void 0!==e)if(e===A)throw RangeError("Cyclic object value");else E=!0;void 0===k.get(Y)&&(A=0)}if("function"==typeof c?x=c(r,x):x instanceof Date?x=f?.(x):"comma"===s&&O(x)&&(x=X(x,function(e){return e instanceof Date?f?.(e):e})),null===x){if(a)return h&&!g?h(r,J.encoder,_,"key",p):r;x=""}if("string"==typeof(w=x)||"number"==typeof w||"boolean"==typeof w||"symbol"==typeof w||"bigint"==typeof w||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(h){let e=g?r:h(r,J.encoder,_,"key",p);return[m?.(e)+"="+m?.(h(x,J.encoder,_,"value",p))]}return[m?.(r)+"="+m?.(String(x))]}let S=[];if(void 0===x)return S;if("comma"===s&&O(x))g&&h&&(x=X(x,h)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(O(c))v=c;else{let e=Object.keys(x);v=u?e.sort(u):e}let $=l?String(r).replace(/\./g,"%2E"):String(r),I=n&&O(x)&&1===x.length?$+"[]":$;if(i&&O(x)&&0===x.length)return I+"[]";for(let r=0;r<v.length;++r){let w=v[r],b="object"==typeof w&&void 0!==w.value?w.value:x[w];if(o&&null===b)continue;let k=d&&l?w.replace(/\./g,"%2E"):w,E=O(x)?"function"==typeof s?s(I,k):I:I+(d?"."+k:"["+k+"]");y.set(t,A);let $=new WeakMap;$.set(Y,y),G(S,e(b,E,s,n,i,a,o,l,"comma"===s&&g&&O(x)?null:h,c,u,d,f,p,m,g,_,$))}return S}(s[t],t,a,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}let h=i.join(n.delimiter),c=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),h.length>0?c+h:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${U}`}defaultIdempotencyKey(){return`stainless-node-retry-${h()}`}makeStatusError(e,t,r,s){return f.generate(e,t,r,s)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof d)throw e;throw new d(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new d(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,r){let s=!l(this,rb,"m",rk).call(this)&&r||this.baseURL,n=new URL(I.test(e)?e:s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new em(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let s=await e,n=s.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(s);let{req:i,url:a,timeout:o}=await this.buildRequest(s,{retryCount:n-t});await this.prepareRequest(i,{url:a,options:s});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),h=void 0===r?"":`, retryOf: ${r}`,d=Date.now();if(eo(this).debug(`[${l}] sending request`,el({retryOfRequestLogID:r,method:s.method,url:a,options:s,headers:i.headers})),s.signal?.aborted)throw new p;let f=new AbortController,_=await this.fetchWithTimeout(a,i,o,f).catch(u),y=Date.now();if(_ instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(s.signal?.aborted)throw new p;let n=c(_)||/timed? ?out/i.test(String(_)+("cause"in _?String(_.cause):""));if(t)return eo(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),eo(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,el({retryOfRequestLogID:r,url:a,durationMs:y-d,message:_.message})),this.retryRequest(s,t,r??l);if(eo(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),eo(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,el({retryOfRequestLogID:r,url:a,durationMs:y-d,message:_.message})),n)throw new g;throw new m({cause:_})}let w=[..._.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),b=`[${l}${h}${w}] ${i.method} ${a} ${_.ok?"succeeded":"failed"} with status ${_.status} in ${y-d}ms`;if(!_.ok){let e=await this.shouldRetry(_);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await N(_.body),eo(this).info(`${b} - ${e}`),eo(this).debug(`[${l}] response error (${e})`,el({retryOfRequestLogID:r,url:_.url,status:_.status,headers:_.headers,durationMs:y-d})),this.retryRequest(s,t,r??l,_.headers)}let n=e?"error; no more retries left":"error; not retryable";eo(this).info(`${b} - ${n}`);let i=await _.text().catch(e=>u(e).message),a=(e=>{try{return JSON.parse(e)}catch(e){return}})(i),o=a?void 0:i;throw eo(this).debug(`[${l}] response error (${n})`,el({retryOfRequestLogID:r,url:_.url,status:_.status,headers:_.headers,message:o,durationMs:Date.now()-d})),this.makeStatusError(_.status,a,o,_.headers)}return eo(this).info(b),eo(this).debug(`[${l}] response start`,el({retryOfRequestLogID:r,url:_.url,status:_.status,headers:_.headers,durationMs:y-d})),{response:_,options:s,controller:f,requestLogID:l,retryOfRequestLogID:r,startTime:d}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){return new e_(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,r,s){let{signal:n,method:i,...a}=t||{};n&&n.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,h={signal:s.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(h.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,r,s){let n,i=s?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let a=s?.get("retry-after");if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await R(n),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:n,query:i,defaultBaseURL:a}=r,o=this.buildURL(n,i,a);"timeout"in r&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new d(`${e} must be an integer`);if(t<0)throw new d(`${e} must be a positive integer`)})("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:h}=this.buildBody({options:r}),c=await this.buildHeaders({options:e,method:s,bodyHeaders:l,retryCount:t});return{req:{method:s,headers:c,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"},...h&&{body:h},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let a=e5([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...s??(s=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":U,"X-Stainless-OS":z(Deno.build.os),"X-Stainless-Arch":B(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":U,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":U,"X-Stainless-OS":z(globalThis.process.platform??"unknown"),"X-Stainless-Arch":B(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,s=r[2]||0,n=r[3]||0;return{browser:e,version:`${t}.${s}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":U,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":U,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=e5([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:j(e)}:l(this,rx,"f").call(this,{body:e,headers:r})}}rv=sl,rx=new WeakMap,rb=new WeakSet,rk=function(){return"https://api.openai.com/v1"!==this.baseURL},sl.OpenAI=rv,sl.DEFAULT_TIMEOUT=6e5,sl.OpenAIError=d,sl.APIError=f,sl.APIConnectionError=m,sl.APIConnectionTimeoutError=g,sl.APIUserAbortError=p,sl.NotFoundError=b,sl.ConflictError=v,sl.RateLimitError=k,sl.BadRequestError=_,sl.AuthenticationError=y,sl.InternalServerError=A,sl.PermissionDeniedError=w,sl.UnprocessableEntityError=x,sl.InvalidWebhookSignatureError=$,sl.toFile=eR,sl.Completions=rC,sl.Chat=e4,sl.Embeddings=rz,sl.Files=rN,sl.Images=rY,sl.Audio=tt,sl.Moderations=rZ,sl.Models=rQ,sl.FineTuning=rK,sl.Graders=rJ,sl.VectorStores=sn,sl.Webhooks=so,sl.Beta=rO,sl.Batches=tr,sl.Uploads=se,sl.Responses=r7,sl.Realtime=r2,sl.Conversations=rB,sl.Evals=rL,sl.Containers=rR,sl.Videos=si,r(41463)},94348:(e,t,r)=>{"use strict";r.d(t,{Ah:()=>a,Mr:()=>s,N_:()=>n});class s{constructor(e=(e,t)=>e>t){this._heap=[],this._comparator=e}get size(){return this._heap.length}isEmpty(){return 0===this.size}peek(){return this._heap[0]}push(...e){return this.extend(e)}extend(e){for(let t of e)this._heap.push(t),this._siftUp();return this.size}pop(){let e=this.peek(),t=this.size-1;return t>0&&this._swap(0,t),this._heap.pop(),this._siftDown(),e}replace(e){let t=this.peek();return this._heap[0]=e,this._siftDown(),t}_parent(e){return(e+1>>>1)-1}_left(e){return(e<<1)+1}_right(e){return e+1<<1}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let r=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=r}_siftUp(){let e=this.size-1;for(;e>0&&this._greater(e,this._parent(e));)this._swap(e,this._parent(e)),e=this._parent(e)}_siftDown(){let e=0;for(;this._left(e)<this.size&&this._greater(this._left(e),e)||this._right(e)<this.size&&this._greater(this._right(e),e);){let t=this._right(e)<this.size&&this._greater(this._right(e),this._left(e))?this._right(e):this._left(e);this._swap(e,t),e=t}}}class n{constructor(){this.root=i.default()}extend(e){for(let t of e)this.push(t)}push(e){let t=this.root;for(let r of e){let e=t.children.get(r);void 0===e&&(e=i.default(),t.children.set(r,e)),t=e}t.isLeaf=!0}*commonPrefixSearch(e){let t=this.root,r="";for(let s=0;s<e.length&&void 0!==t;++s){let n=e[s];r+=n,void 0!==(t=t.children.get(n))&&t.isLeaf&&(yield r)}}}class i{constructor(e,t){this.isLeaf=e,this.children=t}static default(){return new i(!1,new Map)}}class a{constructor(e,t,r){this.sentence=e,this.len=e.length,this.bosTokenId=t,this.eosTokenId=r,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const s=new o(this.bosTokenId,0,0,0,0),n=new o(this.eosTokenId,1,this.len,0,0);this.nodes.push(s.clone()),this.nodes.push(n.clone()),this.beginNodes[this.len].push(n),this.endNodes[0].push(s)}insert(e,t,r,s){let n=new o(s,this.nodes.length,e,t,r);this.beginNodes[e].push(n),this.endNodes[e+t].push(n),this.nodes.push(n)}viterbi(){let e=this.len,t=0;for(;t<=e;){if(0==this.beginNodes[t].length)return[];for(let e of this.beginNodes[t]){e.prev=null;let r=0,s=null;for(let n of this.endNodes[t]){let t=n.backtraceScore+e.score;(null===s||t>r)&&(s=n.clone(),r=t)}if(null===s)return[];e.prev=s,e.backtraceScore=r}++t}let r=[],s=this.beginNodes[e][0].prev;if(null===s)return[];let n=s.clone();for(;null!==n.prev;)r.push(n.clone()),n=n.clone().prev.clone();return r.reverse(),r}piece(e){return this.sentence.slice(e.pos,e.pos+e.length)}tokens(){return this.viterbi().map(e=>this.piece(e))}tokenIds(){return this.viterbi().map(e=>e.tokenId)}}class o{constructor(e,t,r,s,n){this.tokenId=e,this.nodeId=t,this.pos=r,this.length=s,this.score=n,this.prev=null,this.backtraceScore=0}clone(){let e=new o(this.tokenId,this.nodeId,this.pos,this.length,this.score);return e.prev=this.prev,e.backtraceScore=this.backtraceScore,e}}},94658:(e,t,r)=>{var s={452:function(e){"use strict";e.exports=r(80080)}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}},a=!0;try{s[e](r,r.exports,i),a=!1}finally{a&&delete n[e]}return r.exports}i.ab="//";var a={};!function(){var e,t=(e=i(452))&&"object"==typeof e&&"default"in e?e.default:e,r=/https?|ftp|gopher|file/;function s(e){"string"==typeof e&&(e=_(e));var s,n,i,a,o,l,h,c,u,d=(n=(s=e).auth,i=s.hostname,a=s.protocol||"",o=s.pathname||"",l=s.hash||"",h=s.query||"",c=!1,n=n?encodeURIComponent(n).replace(/%3A/i,":")+"@":"",s.host?c=n+s.host:i&&(c=n+(~i.indexOf(":")?"["+i+"]":i),s.port&&(c+=":"+s.port)),h&&"object"==typeof h&&(h=t.encode(h)),u=s.search||h&&"?"+h||"",a&&":"!==a.substr(-1)&&(a+=":"),s.slashes||(!a||r.test(a))&&!1!==c?(c="//"+(c||""),o&&"/"!==o[0]&&(o="/"+o)):c||(c=""),l&&"#"!==l[0]&&(l="#"+l),u&&"?"!==u[0]&&(u="?"+u),{protocol:a,host:c,pathname:o=o.replace(/[?#]/g,encodeURIComponent),search:u=u.replace("#","%23"),hash:l});return""+d.protocol+d.host+d.pathname+d.search+d.hash}var n="http://",o=n+"w.w",l=/^([a-z0-9.+-]*:\/\/\/)([a-z0-9.+-]:\/*)?/i,h=/https?|ftp|gopher|file/;function c(e,t){var r="string"==typeof e?_(e):e;e="object"==typeof e?s(e):e;var i=_(t),a="";r.protocol&&!r.slashes&&(a=r.protocol,e=e.replace(r.protocol,""),a+="/"===t[0]||"/"===e[0]?"/":""),a&&i.protocol&&(a="",i.slashes||(a=i.protocol,t=t.replace(i.protocol,"")));var c=e.match(l);c&&!i.protocol&&(e=e.substr((a=c[1]+(c[2]||"")).length),/^\/\/[^/]/.test(t)&&(a=a.slice(0,-1)));var u=new URL(e,o+"/"),d=new URL(t,u).toString().replace(o,""),f=i.protocol||r.protocol;return f+=r.slashes||i.slashes?"//":"",!a&&f?d=d.replace(n,f):a&&(d=d.replace(n,"")),h.test(d)||~t.indexOf(".")||"/"===e.slice(-1)||"/"===t.slice(-1)||"/"!==d.slice(-1)||(d=d.slice(0,-1)),a&&(d=a+("/"===d[0]?d.substr(1):d)),d}function u(){}u.prototype.parse=_,u.prototype.format=s,u.prototype.resolve=c,u.prototype.resolveObject=c;var d=/^https?|ftp|gopher|file/,f=/^(.*?)([#?].*)/,p=/^([a-z0-9.+-]*:)(\/{0,3})(.*)/i,m=/^([a-z0-9.+-]*:)?\/\/\/*/i,g=/^([a-z0-9.+-]*:)(\/{0,2})\[(.*)\]$/i;function _(e,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),e&&"object"==typeof e&&e instanceof u)return e;var i=(e=e.trim()).match(f);e=i?i[1].replace(/\\/g,"/")+i[2]:e.replace(/\\/g,"/"),g.test(e)&&"/"!==e.slice(-1)&&(e+="/");var a=!/(^javascript)/.test(e)&&e.match(p),l=m.test(e),h="";a&&(d.test(a[1])||(h=a[1].toLowerCase(),e=""+a[2]+a[3]),a[2]||(l=!1,d.test(a[1])?(h=a[1],e=""+a[3]):e="//"+a[3]),3!==a[2].length&&1!==a[2].length||(h=a[1],e="/"+a[3]));var c,_=(i?i[1]:e).match(/^https?:\/\/[^/]+(:[0-9]+)(?=\/|$)/),y=_&&_[1],w=new u,b="",v="";try{c=new URL(e)}catch(t){b=t,h||n||!/^\/\//.test(e)||/^\/\/.+[@.]/.test(e)||(v="/",e=e.substr(1));try{c=new URL(e,o)}catch(e){return w.protocol=h,w.href=h,w}}w.slashes=l&&!v,w.host="w.w"===c.host?"":c.host,w.hostname="w.w"===c.hostname?"":c.hostname.replace(/(\[|\])/g,""),w.protocol=b?h||null:c.protocol,w.search=c.search.replace(/\\/g,"%5C"),w.hash=c.hash.replace(/\\/g,"%5C");var x=e.split("#");!w.search&&~x[0].indexOf("?")&&(w.search="?"),w.hash||""!==x[1]||(w.hash="#"),w.query=r?t.decode(c.search.substr(1)):w.search.substr(1),w.pathname=v+(a?c.pathname.replace(/['^|`]/g,function(e){return"%"+e.charCodeAt().toString(16).toUpperCase()}).replace(/((?:%[0-9A-F]{2})+)/g,function(e,t){try{return decodeURIComponent(t).split("").map(function(e){var t=e.charCodeAt();return t>256||/^[a-z0-9]$/i.test(e)?e:"%"+t.toString(16).toUpperCase()}).join("")}catch(e){return t}}):c.pathname),"about:"===w.protocol&&"blank"===w.pathname&&(w.protocol="",w.pathname=""),b&&"/"!==e[0]&&(w.pathname=w.pathname.substr(1)),h&&!d.test(h)&&"/"!==e.slice(-1)&&"/"===w.pathname&&(w.pathname=""),w.path=w.pathname+w.search,w.auth=[c.username,c.password].map(decodeURIComponent).filter(Boolean).join(":"),w.port=c.port,y&&!w.host.endsWith(y)&&(w.host+=y,w.port=y.slice(1)),w.href=v?""+w.pathname+w.search+w.hash:s(w);var k=/^(file)/.test(w.href)?["host","hostname"]:[];return Object.keys(w).forEach(function(e){~k.indexOf(e)||(w[e]=w[e]||null)}),w}a.parse=_,a.format=s,a.resolve=c,a.resolveObject=function(e,t){return _(c(e,t))},a.Url=u}(),e.exports=a},95714:(e,t,r)=>{"use strict";let s;r.d(t,{M:()=>s,t:()=>h});var n,i,a=r(83052),o=r(32219),l=r(41463);let h=["wasm"];void 0!==l&&l?.release?.name==="node"?(s=a??(n||(n=r.t(a,2))),h.unshift("cpu")):(s=o??(i||(i=r.t(o,2))),"undefined"!=typeof navigator&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(s.env.wasm.simd=!1))}}]);