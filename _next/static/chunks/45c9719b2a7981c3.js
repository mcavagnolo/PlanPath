(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52683,e=>{"use strict";let t,s,n,r;var i,a,o,l,c,h,u,d,f,p,m,g,y,w,_,b,v,x,S,$,A,k,j,I,O,R,N,P,E,C,T,M,L,B,D,W,F,q,U,H,X,J,K,z,V,G,Q,Y,Z,ee,et,es,en,er,ei,ea,eo,el,ec,eh,eu,ed,ef,ep,em,eg,ey,ew,e_,eb,ev,ex,eS,e$,eA,ek,ej=e.i(43476),eI=e.i(71645);function eO({onAnalyze:e,isAnalyzing:t}){let[s,n]=(0,eI.useState)(null),[r,i]=(0,eI.useState)(""),[a,o]=(0,eI.useState)("residential");return(0,ej.jsxs)("form",{onSubmit:t=>{t.preventDefault(),s&&r&&e(s,r,a)},className:"space-y-6 p-6 bg-white shadow-lg rounded-xl border border-gray-100",children:[(0,ej.jsxs)("div",{children:[(0,ej.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Building Plan (PDF/Image)"}),(0,ej.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-400 transition-colors",children:(0,ej.jsxs)("div",{className:"space-y-1 text-center",children:[(0,ej.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,ej.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,ej.jsxs)("div",{className:"flex text-sm text-gray-600",children:[(0,ej.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[(0,ej.jsx)("span",{children:"Upload a file"}),(0,ej.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",accept:".pdf,.png,.jpg,.jpeg",className:"sr-only",onChange:e=>{let t=e.target.files?.[0];t?t.size>0x3200000?(alert("File size exceeds 50MB limit."),e.target.value="",n(null)):n(t):n(null)},required:!0})]}),(0,ej.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,ej.jsx)("p",{className:"text-xs text-gray-500",children:"PDF, PNG, JPG up to 50MB"}),s&&(0,ej.jsxs)("p",{className:"text-sm text-green-600 font-semibold mt-2",children:["Selected: ",s.name]})]})})]}),(0,ej.jsxs)("div",{children:[(0,ej.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location (City, State)"}),(0,ej.jsx)("input",{type:"text",value:r,onChange:e=>i(e.target.value),placeholder:"e.g. New York, NY",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",required:!0})]}),(0,ej.jsxs)("div",{children:[(0,ej.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Building Type"}),(0,ej.jsxs)("select",{value:a,onChange:e=>o(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[(0,ej.jsx)("option",{value:"residential",children:"Residential"}),(0,ej.jsx)("option",{value:"commercial",children:"Commercial"}),(0,ej.jsx)("option",{value:"industrial",children:"Industrial"}),(0,ej.jsx)("option",{value:"institutional",children:"Institutional"})]})]}),(0,ej.jsx)("button",{type:"submit",disabled:!s||!r||t,className:`w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white transition-colors ${t?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`,children:t?(0,ej.jsxs)(ej.Fragment,{children:[(0,ej.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,ej.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,ej.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing Plans..."]}):"Analyze Plans"})]})}function eR({conflicts:e}){return 0===e.length?(0,ej.jsxs)("div",{className:"p-6 bg-green-50 border border-green-200 rounded-lg text-center shadow-sm",children:[(0,ej.jsx)("h3",{className:"text-lg font-medium text-green-800",children:"No Conflicts Found"}),(0,ej.jsx)("p",{className:"mt-2 text-green-600",children:"The building plans appear to comply with the checked codes."})]}):(0,ej.jsxs)("div",{className:"space-y-6",children:[(0,ej.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ej.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Analysis Results"}),(0,ej.jsxs)("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium",children:[e.length," Potential Conflict",1!==e.length?"s":""," Found"]})]}),(0,ej.jsx)("div",{className:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100",children:(0,ej.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,ej.jsx)("li",{className:"p-6 hover:bg-gray-50 transition-colors",children:(0,ej.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,ej.jsx)("div",{className:"flex-shrink-0 mt-1",children:"high"===e.severity?(0,ej.jsx)("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,ej.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):"medium"===e.severity?(0,ej.jsx)("svg",{className:"h-6 w-6 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,ej.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):(0,ej.jsx)("svg",{className:"h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,ej.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,ej.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,ej.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,ej.jsx)("p",{className:"text-sm font-bold text-gray-900",children:e.codeReference}),(0,ej.jsxs)("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium uppercase tracking-wide ${"high"===e.severity?"bg-red-100 text-red-800":"medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:[e.severity," Priority"]})]}),(0,ej.jsx)("p",{className:"text-base text-gray-600 leading-relaxed",children:e.description})]})]})},e.id))})}),(0,ej.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-md",children:(0,ej.jsxs)("div",{className:"flex",children:[(0,ej.jsx)("div",{className:"flex-shrink-0",children:(0,ej.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,ej.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,ej.jsx)("div",{className:"ml-3",children:(0,ej.jsx)("p",{className:"text-sm text-blue-700",children:"This tool is designed to err on the side of caution (false positives) to ensure safety. Please verify all findings with a certified professional."})})]})})]})}function eN(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eP(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}e.i(47167);let eE=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eE=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function eC(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eT=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eM extends Error{}class eL extends eM{constructor(e,t,s,n){super(`${eL.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new eD({message:s,cause:eT(t)});let r=t?.error;return 400===e?new eF(e,r,s,n):401===e?new eq(e,r,s,n):403===e?new eU(e,r,s,n):404===e?new eH(e,r,s,n):409===e?new eX(e,r,s,n):422===e?new eJ(e,r,s,n):429===e?new eK(e,r,s,n):e>=500?new ez(e,r,s,n):new eL(e,r,s,n)}}class eB extends eL{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eD extends eL{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eW extends eD{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eF extends eL{}class eq extends eL{}class eU extends eL{}class eH extends eL{}class eX extends eL{}class eJ extends eL{}class eK extends eL{}class ez extends eL{}class eV extends eM{constructor(){super("Could not parse response content as the length limit was reached")}}class eG extends eM{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class eQ extends Error{constructor(e){super(e)}}let eY=/^[a-z][a-z0-9+.-]*:/i,eZ=e=>(eZ=Array.isArray)(e),e0=eZ;function e1(e){return"object"!=typeof e?{}:e??{}}function e2(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e4=e=>new Promise(t=>setTimeout(t,e)),e3="6.9.1",e6=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",e8=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function e5(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function e9(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return e5({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function e7(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function te(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let tt=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),ts="RFC3986",tn=e=>String(e),tr={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:tn},ti=(e,t)=>(ti=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),ta=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function to(e,t){if(eZ(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let tl={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},tc=function(e,t){Array.prototype.push.apply(e,eZ(t)?t:[t])},th={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=ta[n];continue}if(n<2048){s[s.length]=ta[192|n>>6]+ta[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=ta[224|n>>12]+ta[128|n>>6&63]+ta[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=ta[240|n>>18]+ta[128|n>>12&63]+ta[128|n>>6&63]+ta[128|63&n]}a+=s.join("")}return a},encodeValuesOnly:!1,format:ts,formatter:tn,indices:!1,serializeDate:e=>(s??(s=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tu={};function td(e){let t;return(n??(n=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tf(e){let t;return(r??(r=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class tp{constructor(){i.set(this,void 0),a.set(this,void 0),eN(this,i,new Uint8Array,"f"),eN(this,a,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?td(e):e;eN(this,i,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eP(this,i,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eP(this,i,"f"),eP(this,a,"f")));){if(t.carriage&&null==eP(this,a,"f")){eN(this,a,t.index,"f");continue}if(null!=eP(this,a,"f")&&(t.index!==eP(this,a,"f")+1||t.carriage)){n.push(tf(eP(this,i,"f").subarray(0,eP(this,a,"f")-1))),eN(this,i,eP(this,i,"f").subarray(eP(this,a,"f")),"f"),eN(this,a,null,"f");continue}let e=null!==eP(this,a,"f")?t.preceding-1:t.preceding,s=tf(eP(this,i,"f").subarray(0,e));n.push(s),eN(this,i,eP(this,i,"f").subarray(t.index),"f"),eN(this,a,null,"f")}return n}flush(){return eP(this,i,"f").length?this.decode("\n"):[]}}i=new WeakMap,a=new WeakMap,tp.NEWLINE_CHARS=new Set(["\n","\r"]),tp.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let tm={off:0,error:200,warn:300,info:400,debug:500},tg=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(tm,e))return e;tv(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(tm))}`)}};function ty(){}function tw(e,t,s){return!t||tm[e]>tm[s]?ty:t[e].bind(t)}let t_={error:ty,warn:ty,info:ty,debug:ty},tb=new WeakMap;function tv(e){let t=e.logger,s=e.logLevel??"off";if(!t)return t_;let n=tb.get(t);if(n&&n[0]===s)return n[1];let r={error:tw("error",t,s),warn:tw("warn",t,s),info:tw("info",t,s),debug:tw("debug",t,s)};return tb.set(t,[s,r]),r}let tx=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tS{constructor(e,t,s){this.iterator=e,o.set(this,void 0),this.controller=t,eN(this,o,s,"f")}static fromSSEResponse(e,t,s){let n=!1,r=s?tv(s):console;async function*i(){if(n)throw new eM("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(let n of t$(e,t))if(!s){if(n.data.startsWith("[DONE]")){s=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new eL(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw r.error("Could not parse message into JSON:",n.data),r.error("From chunk:",n.raw),e}if(t&&t.error)throw new eL(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(eC(e))return;throw e}finally{s||t.abort()}}return new tS(i,t,s)}static fromReadableStream(e,t,s){let n=!1;async function*r(){let t=new tp;for await(let s of e7(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tS(async function*(){if(n)throw new eM("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eC(e))return;throw e}finally{e||t.abort()}},t,s)}[(o=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tS(()=>n(e),this.controller,eP(this,o,"f")),new tS(()=>n(t),this.controller,eP(this,o,"f"))]}toReadableStream(){let e,t=this;return e5({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=td(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*t$(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eM("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eM("Attempted to iterate over a response with no body")}let s=new tk,n=new tp;for await(let t of tA(e7(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tA(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?td(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tk{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,i]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return i.startsWith(" ")&&(i=i.substring(1)),"event"===n?this.event=i:"data"===n&&this.data.push(i),null}}async function tj(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tv(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):tS.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tI(await s.json(),s):await s.text()})();return tv(e).debug(`[${n}] response parsed`,tx({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tI(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tO extends Promise{constructor(e,t,s=tj){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,l.set(this,void 0),eN(this,l,e,"f")}_thenUnwrap(e){return new tO(eP(this,l,"f"),this.responsePromise,async(t,s)=>tI(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eP(this,l,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}l=new WeakMap;class tR{constructor(e,t,s,n){c.set(this,void 0),eN(this,c,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eM("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eP(this,c,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(c=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tN extends tO{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tj(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tP extends tR{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tE extends tR{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...e1(this.options.query),after:t}}:null}}class tC extends tR{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...e1(this.options.query),after:e}}:null}}let tT=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tM(e,t,s){return tT(),new File(e,t??"unknown_file",s)}function tL(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tB=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tD=async(e,t)=>tH(e.body)?{...e,body:await tq(e.body,t)}:e,tW=async(e,t)=>({...e,body:await tq(e.body,t)}),tF=new WeakMap,tq=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tF.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tF.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tX(s,e,t))),s},tU=e=>e instanceof Blob&&"name"in e,tH=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||tB(e)||tU(e)))return!0;if(Array.isArray(e))return e.some(tH);if(e&&"object"==typeof e){for(let t in e)if(tH(e[t]))return!0}return!1},tX=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tM([await s.blob()],tL(s)));else if(tB(s))e.append(t,tM([await new Response(e9(s)).blob()],tL(s)));else if(tU(s))e.append(t,s,tL(s));else if(Array.isArray(s))await Promise.all(s.map(s=>tX(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>tX(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tJ=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function tK(e,t,s){let n,r;if(tT(),null!=(n=e=await e)&&"object"==typeof n&&"string"==typeof n.name&&"number"==typeof n.lastModified&&tJ(n))return e instanceof File?e:tM([await e.arrayBuffer()],e.name);if(null!=(r=e)&&"object"==typeof r&&"string"==typeof r.url&&"function"==typeof r.blob){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tM(await tz(n),t,s)}let i=await tz(e);if(t||(t=tL(e)),!s?.type){let e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tM(i,t,s)}async function tz(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tJ(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tB(e))for await(let s of e)t.push(...await tz(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class tV{constructor(e){this._client=e}}function tG(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tQ=Object.freeze(Object.create(null)),tY=((e=tG)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,i=[],a=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(r=!0);let o=s[a],l=(r?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tQ)??tQ)?.toString)&&(l=o+"",i.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)i.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eM(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(tG);class tZ extends tV{list(e,t={},s){return this._client.getAPIList(tY`/chat/completions/${e}/messages`,tE,{query:t,...s})}}function t0(e){return void 0!==e&&"function"in e&&void 0!==e.function}function t1(e){return e?.$brand==="auto-parseable-response-format"}function t2(e){return e?.$brand==="auto-parseable-tool"}function t4(e,t){let s=e.choices.map(e=>{var s,n;if("length"===e.finish_reason)throw new eV;if("content_filter"===e.finish_reason)throw new eG;return t6(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var s,n;let r;return s=t,n=e,r=s.tools?.find(e=>t0(e)&&e.function?.name===n.function.name),{...n,function:{...n.function,parsed_arguments:t2(r)?r.$parseRaw(n.function.arguments):r?.function.strict?JSON.parse(n.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,n=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...e,choices:s}}function t3(e){return!!t1(e.response_format)||(e.tools?.some(e=>t2(e)||"function"===e.type&&!0===e.function.strict)??!1)}function t6(e){for(let t of e||[])if("function"!==t.type)throw new eM(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let t8=e=>e?.role==="assistant",t5=e=>e?.role==="tool";class t9{constructor(){h.add(this),this.controller=new AbortController,u.set(this,void 0),d.set(this,()=>{}),f.set(this,()=>{}),p.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,{}),w.set(this,!1),_.set(this,!1),b.set(this,!1),v.set(this,!1),eN(this,u,new Promise((e,t)=>{eN(this,d,e,"f"),eN(this,f,t,"f")}),"f"),eN(this,p,new Promise((e,t)=>{eN(this,m,e,"f"),eN(this,g,t,"f")}),"f"),eP(this,u,"f").catch(()=>{}),eP(this,p,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eP(this,h,"m",x).bind(this))},0)}_connected(){this.ended||(eP(this,d,"f").call(this),this._emit("connect"))}get ended(){return eP(this,w,"f")}get errored(){return eP(this,_,"f")}get aborted(){return eP(this,b,"f")}abort(){this.controller.abort()}on(e,t){return(eP(this,y,"f")[e]||(eP(this,y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eP(this,y,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eP(this,y,"f")[e]||(eP(this,y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eN(this,v,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eN(this,v,!0,"f"),await eP(this,p,"f")}_emit(e,...t){if(eP(this,w,"f"))return;"end"===e&&(eN(this,w,!0,"f"),eP(this,m,"f").call(this));let s=eP(this,y,"f")[e];if(s&&(eP(this,y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eP(this,v,"f")||s?.length||Promise.reject(e),eP(this,f,"f").call(this,e),eP(this,g,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eP(this,v,"f")||s?.length||Promise.reject(e),eP(this,f,"f").call(this,e),eP(this,g,"f").call(this,e),this._emit("end")}}_emitFinal(){}}u=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,h=new WeakSet,x=function(e){if(eN(this,_,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eB),e instanceof eB)return eN(this,b,!0,"f"),this._emit("abort",e);if(e instanceof eM)return this._emit("error",e);if(e instanceof Error){let t=new eM(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eM(String(e)))};class t7 extends t9{constructor(){super(...arguments),S.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),t5(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(t8(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eM("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eP(this,S,"m",$).call(this)}async finalMessage(){return await this.done(),eP(this,S,"m",A).call(this)}async finalFunctionToolCall(){return await this.done(),eP(this,S,"m",k).call(this)}async finalFunctionToolCallResult(){return await this.done(),eP(this,S,"m",j).call(this)}async totalUsage(){return await this.done(),eP(this,S,"m",I).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eP(this,S,"m",A).call(this);t&&this._emit("finalMessage",t);let s=eP(this,S,"m",$).call(this);s&&this._emit("finalContent",s);let n=eP(this,S,"m",k).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eP(this,S,"m",j).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eP(this,S,"m",I).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eP(this,S,"m",O).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(t4(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:i,...a}=t,o="string"!=typeof r&&"function"===r.type&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(t2(e)){if(!e.$callback)throw new eM("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(let e of c)"function"===e.type&&(h[e.function.name||e.function.function.name]=e.function);let u="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:u,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eM("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:i}=e.function,a=h[r];if(a){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=eP(this,S,"m",R).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}S=new WeakSet,$=function(){return eP(this,S,"m",A).call(this).content??null},A=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(t8(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eM("stream ended without producing a ChatCompletionMessage with role=assistant")},k=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t8(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},j=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t5(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},I=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},O=function(e){if(null!=e.n&&e.n>1)throw new eM("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},R=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class se extends t7{static runTools(e,t,s){let n=new se,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),t8(e)&&e.content&&this._emit("content",e.content)}}let st=511;class ss extends Error{}class sn extends Error{}let sr=e=>(function(e,t=st){var s,n;let r,i,a,o,l,c,h,u,d,f;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return s=e.trim(),n=t,r=s.length,i=0,a=e=>{throw new ss(`${e} at position ${i}`)},o=e=>{throw new sn(`${e} at position ${i}`)},l=()=>(f(),i>=r&&a("Unexpected end of input"),'"'===s[i])?c():"{"===s[i]?h():"["===s[i]?u():"null"===s.substring(i,i+4)||16&n&&r-i<4&&"null".startsWith(s.substring(i))?(i+=4,null):"true"===s.substring(i,i+4)||32&n&&r-i<4&&"true".startsWith(s.substring(i))?(i+=4,!0):"false"===s.substring(i,i+5)||32&n&&r-i<5&&"false".startsWith(s.substring(i))?(i+=5,!1):"Infinity"===s.substring(i,i+8)||128&n&&r-i<8&&"Infinity".startsWith(s.substring(i))?(i+=8,1/0):"-Infinity"===s.substring(i,i+9)||256&n&&1<r-i&&r-i<9&&"-Infinity".startsWith(s.substring(i))?(i+=9,-1/0):"NaN"===s.substring(i,i+3)||64&n&&r-i<3&&"NaN".startsWith(s.substring(i))?(i+=3,NaN):d(),c=()=>{let e=i,t=!1;for(i++;i<r&&('"'!==s[i]||t&&"\\"===s[i-1]);)t="\\"===s[i]&&!t,i++;if('"'==s.charAt(i))try{return JSON.parse(s.substring(e,++i-Number(t)))}catch(e){o(String(e))}else if(1&n)try{return JSON.parse(s.substring(e,i-Number(t))+'"')}catch(t){return JSON.parse(s.substring(e,s.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},h=()=>{i++,f();let e={};try{for(;"}"!==s[i];){if(f(),i>=r&&8&n)return e;let t=c();f(),i++;try{let s=l();Object.defineProperty(e,t,{value:s,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&n)return e;throw t}f(),","===s[i]&&i++}}catch(t){if(8&n)return e;a("Expected '}' at end of object")}return i++,e},u=()=>{i++;let e=[];try{for(;"]"!==s[i];)e.push(l()),f(),","===s[i]&&i++}catch(t){if(4&n)return e;a("Expected ']' at end of array")}return i++,e},d=()=>{if(0===i){"-"===s&&2&n&&a("Not sure what '-' is");try{return JSON.parse(s)}catch(e){if(2&n)try{if("."===s[s.length-1])return JSON.parse(s.substring(0,s.lastIndexOf(".")));return JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=i;for("-"===s[i]&&i++;s[i]&&!",]}".includes(s[i]);)i++;i!=r||2&n||a("Unterminated number literal");try{return JSON.parse(s.substring(e,i))}catch(t){"-"===s.substring(e,i)&&2&n&&a("Not sure what '-' is");try{return JSON.parse(s.substring(e,s.lastIndexOf("e")))}catch(e){o(String(e))}}},f=()=>{for(;i<r&&" \n\r	".includes(s[i]);)i++},l()})(e,2^st);class si extends t7{constructor(e){super(),N.add(this),P.set(this,void 0),E.set(this,void 0),C.set(this,void 0),eN(this,P,e,"f"),eN(this,E,[],"f")}get currentChatCompletionSnapshot(){return eP(this,C,"f")}static fromReadableStream(e){let t=new si(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new si(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eP(this,N,"m",T).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eP(this,N,"m",L).call(this,e);if(r.controller.signal?.aborted)throw new eB;return this._addChatCompletion(eP(this,N,"m",W).call(this))}async _fromReadableStream(e,t){let s,n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eP(this,N,"m",T).call(this),this._connected();let r=tS.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eP(this,N,"m",W).call(this)),eP(this,N,"m",L).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eB;return this._addChatCompletion(eP(this,N,"m",W).call(this))}[(P=new WeakMap,E=new WeakMap,C=new WeakMap,N=new WeakSet,T=function(){this.ended||eN(this,C,void 0,"f")},M=function(e){let t=eP(this,E,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eP(this,E,"f")[e.index]=t),t},L=function(e){if(this.ended)return;let t=eP(this,N,"m",q).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eP(this,N,"m",M).call(this,e);for(let t of(e.finish_reason&&(eP(this,N,"m",D).call(this,e),null!=n.current_tool_call_index&&eP(this,N,"m",B).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eP(this,N,"m",D).call(this,e),null!=n.current_tool_call_index&&eP(this,N,"m",B).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):sl(s?.type))}}},B=function(e,t){if(eP(this,N,"m",M).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eP(this,P,"f")?.tools?.find(e=>t0(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:t2(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else sl(s.type)},D=function(e){let t=eP(this,N,"m",M).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eP(this,N,"m",F).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},W=function(){if(this.ended)throw new eM("stream has ended, this shouldn't happen");let e=eP(this,C,"f");if(!e)throw new eM("request ended without sending any chunks");return eN(this,C,void 0,"f"),eN(this,E,[],"f"),function(e,t){var s;let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new eM(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,h=t.role;if(!h)throw new eM(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eM(`missing function_call.arguments for choice ${n}`);if(!l)throw new eM(`missing function_call.name for choice ${n}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...i,index:n,finish_reason:s,logprobs:r,message:{...c,role:h,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:i,id:a,...o}=t,{arguments:l,name:c,...h}=r||{};if(null==a)throw new eM(`missing choices[${n}].tool_calls[${s}].id
${sa(e)}`);if(null==i)throw new eM(`missing choices[${n}].tool_calls[${s}].type
${sa(e)}`);if(null==c)throw new eM(`missing choices[${n}].tool_calls[${s}].function.name
${sa(e)}`);if(null==l)throw new eM(`missing choices[${n}].tool_calls[${s}].function.arguments
${sa(e)}`);return{...o,id:a,type:i,function:{...h,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&t3(t)?t4(s,t):{...s,choices:s.choices.map(e=>(t6(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eP(this,P,"f"))},F=function(){let e=eP(this,P,"f")?.response_format;return t1(e)?e:null},q=function(e){var t,s,n,r;let i=eP(this,C,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:h=null,...u}of(i?Object.assign(i,o):i=eN(this,C,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:h,...u}),h)if(e.logprobs){let{content:n,refusal:r,...i}=h;so(i),Object.assign(e.logprobs,i),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},h);if(l&&(e.finish_reason=l,eP(this,P,"f")&&t3(eP(this,P,"f")))){if("length"===l)throw new eV;if("content_filter"===l)throw new eG}if(Object.assign(e,u),!a)continue;let{content:o,refusal:d,function_call:f,role:p,tool_calls:m,...g}=a;if(so(g),Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eP(this,N,"m",F).call(this)&&(e.message.parsed=sr(e.message.content))),m)for(let{index:t,id:s,type:n,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,a),s&&(o.id=s),n&&(o.type=n),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>t0(e)&&e.function?.name===t.function.name);return t0(s)&&(t2(s)||s?.function.strict||!1)}(eP(this,P,"f"),o)&&(o.function.parsed_arguments=sr(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tS(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sa(e){return JSON.stringify(e)}function so(e){}function sl(e){}class sc extends si{static fromReadableStream(e){let t=new sc(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new sc(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sh extends tV{constructor(){super(...arguments),this.messages=new tZ(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(tY`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(tY`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tE,{query:e,...t})}delete(e,t){return this._client.delete(tY`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new eM(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eM(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>t4(t,e))}runTools(e,t){return e.stream?sc.runTools(this._client,e,t):se.runTools(this._client,e,t)}stream(e,t){return si.createChatCompletion(this._client,e,t)}}sh.Messages=tZ;class su extends tV{constructor(){super(...arguments),this.completions=new sh(this._client)}}su.Completions=sh,e.s([],30742);let sd=Symbol("brand.privateNullableHeaders"),sf=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,i]of function*(e){let t;if(!e)return;if(sd in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():e0(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=e0(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[sd]:!0,values:t,nulls:s}};class sp extends tV{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sf([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sm extends tV{create(e,t){return this._client.post("/audio/transcriptions",tW({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sg extends tV{create(e,t){return this._client.post("/audio/translations",tW({body:e,...t,__metadata:{model:e.model}},this._client))}}class sy extends tV{constructor(){super(...arguments),this.transcriptions=new sm(this._client),this.translations=new sg(this._client),this.speech=new sp(this._client)}}sy.Transcriptions=sm,sy.Translations=sg,sy.Speech=sp;class sw extends tV{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(tY`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tE,{query:e,...t})}cancel(e,t){return this._client.post(tY`/batches/${e}/cancel`,t)}}class s_ extends tV{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(tY`/assistants/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(tY`/assistants/${e}`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tE,{query:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(tY`/assistants/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sb extends tV{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sv extends tV{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sx extends tV{constructor(){super(...arguments),this.sessions=new sb(this._client),this.transcriptionSessions=new sv(this._client)}}sx.Sessions=sb,sx.TranscriptionSessions=sv;class sS extends tV{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:sf([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(tY`/chatkit/sessions/${e}/cancel`,{...t,headers:sf([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class s$ extends tV{retrieve(e,t){return this._client.get(tY`/chatkit/threads/${e}`,{...t,headers:sf([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",tC,{query:e,...t,headers:sf([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(tY`/chatkit/threads/${e}`,{...t,headers:sf([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList(tY`/chatkit/threads/${e}/items`,tC,{query:t,...s,headers:sf([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}class sA extends tV{constructor(){super(...arguments),this.sessions=new sS(this._client),this.threads=new s$(this._client)}}sA.Sessions=sS,sA.Threads=s$;class sk extends tV{create(e,t,s){return this._client.post(tY`/threads/${e}/messages`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(tY`/threads/${n}/messages/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(tY`/threads/${n}/messages/${e}`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(tY`/threads/${e}/messages`,tE,{query:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(tY`/threads/${n}/messages/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sj extends tV{retrieve(e,t,s){let{thread_id:n,run_id:r,...i}=t;return this._client.get(tY`/threads/${n}/runs/${r}/steps/${e}`,{query:i,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(tY`/threads/${n}/runs/${e}/steps`,tE,{query:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}var sI=e.i(67034);let sO=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sR extends t9{constructor(){super(...arguments),U.add(this),X.set(this,[]),J.set(this,{}),K.set(this,{}),z.set(this,void 0),V.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),Y.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0)}[(X=new WeakMap,J=new WeakMap,K=new WeakMap,z=new WeakMap,V=new WeakMap,G=new WeakMap,Q=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,U=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new H;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tS.fromReadableStream(e,this.controller);for await(let e of n)eP(this,U,"m",en).call(this,e);if(n.controller.signal?.aborted)throw new eB;return this._addRun(eP(this,U,"m",er).call(this))}toReadableStream(){return new tS(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eP(this,U,"m",en).call(this,e);if(a.controller.signal?.aborted)throw new eB;return this._addRun(eP(this,U,"m",er).call(this))}static createThreadAssistantStream(e,t,s){let n=new H;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eP(this,ee,"f")}currentRun(){return eP(this,et,"f")}currentMessageSnapshot(){return eP(this,z,"f")}currentRunStepSnapshot(){return eP(this,es,"f")}async finalRunSteps(){return await this.done(),Object.values(eP(this,J,"f"))}async finalMessages(){return await this.done(),Object.values(eP(this,K,"f"))}async finalRun(){if(await this.done(),!eP(this,V,"f"))throw Error("Final run was not received.");return eP(this,V,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))eP(this,U,"m",en).call(this,e);if(i.controller.signal?.aborted)throw new eB;return this._addRun(eP(this,U,"m",er).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eP(this,U,"m",en).call(this,e);if(a.controller.signal?.aborted)throw new eB;return this._addRun(eP(this,U,"m",er).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(e2(t)&&e2(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!e2(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}H=sR,en=function(e){if(!this.ended)switch(eN(this,ee,e,"f"),eP(this,U,"m",eo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eP(this,U,"m",eu).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eP(this,U,"m",ea).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eP(this,U,"m",ei).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},er=function(){if(this.ended)throw new eM("stream has ended, this shouldn't happen");if(!eP(this,V,"f"))throw Error("Final run has not been received");return eP(this,V,"f")},ei=function(e){let[t,s]=eP(this,U,"m",ec).call(this,e,eP(this,z,"f"));for(let e of(eN(this,z,t,"f"),eP(this,K,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eP(this,G,"f")){if(eP(this,Q,"f"))switch(eP(this,Q,"f").type){case"text":this._emit("textDone",eP(this,Q,"f").text,eP(this,z,"f"));break;case"image_file":this._emit("imageFileDone",eP(this,Q,"f").image_file,eP(this,z,"f"))}eN(this,G,s.index,"f")}eN(this,Q,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eP(this,G,"f")){let t=e.data.content[eP(this,G,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eP(this,z,"f"));break;case"text":this._emit("textDone",t.text,eP(this,z,"f"))}}eP(this,z,"f")&&this._emit("messageDone",e.data),eN(this,z,void 0,"f")}},ea=function(e){let t=eP(this,U,"m",el).call(this,e);switch(eN(this,es,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eP(this,Y,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eP(this,Z,"f")&&this._emit("toolCallDone",eP(this,Z,"f")),eN(this,Y,e.index,"f"),eN(this,Z,t.step_details.tool_calls[e.index],"f"),eP(this,Z,"f")&&this._emit("toolCallCreated",eP(this,Z,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eN(this,es,void 0,"f"),"tool_calls"==e.data.step_details.type&&eP(this,Z,"f")&&(this._emit("toolCallDone",eP(this,Z,"f")),eN(this,Z,void 0,"f")),this._emit("runStepDone",e.data,t)}},eo=function(e){eP(this,X,"f").push(e),this._emit("event",e)},el=function(e){switch(e.event){case"thread.run.step.created":return eP(this,J,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eP(this,J,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=H.accumulateDelta(t,s.delta);eP(this,J,"f")[e.data.id]=n}return eP(this,J,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eP(this,J,"f")[e.data.id]=e.data}if(eP(this,J,"f")[e.data.id])return eP(this,J,"f")[e.data.id];throw Error("No snapshot available")},ec=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eP(this,U,"m",eh).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eh=function(e,t){return H.accumulateDelta(t,e)},eu=function(e){switch(eN(this,et,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eN(this,V,e.data,"f"),eP(this,Z,"f")&&(this._emit("toolCallDone",eP(this,Z,"f")),eN(this,Z,void 0,"f"))}};class sN extends tV{constructor(){super(...arguments),this.steps=new sj(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(tY`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(tY`/threads/${n}/runs/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(tY`/threads/${n}/runs/${e}`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(tY`/threads/${e}/runs`,tE,{query:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(tY`/threads/${n}/runs/${e}/cancel`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sR.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sf([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e4(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sR.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(tY`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sR.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sN.Steps=sj;class sP extends tV{constructor(){super(...arguments),this.runs=new sN(this._client),this.messages=new sk(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(tY`/threads/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(tY`/threads/${e}`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(tY`/threads/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sR.createThreadAssistantStream(e,this._client.beta.threads,t)}}sP.Runs=sN,sP.Messages=sk;class sE extends tV{constructor(){super(...arguments),this.realtime=new sx(this._client),this.chatkit=new sA(this._client),this.assistants=new s_(this._client),this.threads=new sP(this._client)}}sE.Realtime=sx,sE.ChatKit=sA,sE.Assistants=s_,sE.Threads=sP;class sC extends tV{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sT extends tV{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(tY`/containers/${n}/files/${e}/content`,{...s,headers:sf([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sM extends tV{constructor(){super(...arguments),this.content=new sT(this._client)}create(e,t,s){return this._client.post(tY`/containers/${e}/files`,tW({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(tY`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(tY`/containers/${e}/files`,tE,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(tY`/containers/${n}/files/${e}`,{...s,headers:sf([{Accept:"*/*"},s?.headers])})}}sM.Content=sT;class sL extends tV{constructor(){super(...arguments),this.files=new sM(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(tY`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tE,{query:e,...t})}delete(e,t){return this._client.delete(tY`/containers/${e}`,{...t,headers:sf([{Accept:"*/*"},t?.headers])})}}sL.Files=sM;class sB extends tV{create(e,t,s){let{include:n,...r}=t;return this._client.post(tY`/conversations/${e}/items`,{query:{include:n},body:r,...s})}retrieve(e,t,s){let{conversation_id:n,...r}=t;return this._client.get(tY`/conversations/${n}/items/${e}`,{query:r,...s})}list(e,t={},s){return this._client.getAPIList(tY`/conversations/${e}/items`,tC,{query:t,...s})}delete(e,t,s){let{conversation_id:n}=t;return this._client.delete(tY`/conversations/${n}/items/${e}`,s)}}class sD extends tV{constructor(){super(...arguments),this.items=new sB(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(tY`/conversations/${e}`,t)}update(e,t,s){return this._client.post(tY`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(tY`/conversations/${e}`,t)}}sD.Items=sB;class sW extends tV{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tv(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tv(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if(void 0!==sI.Buffer){let t=sI.Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}})(t)}),e)))}}class sF extends tV{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(tY`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(tY`/evals/${n}/runs/${e}/output_items`,tE,{query:r,...s})}}class sq extends tV{constructor(){super(...arguments),this.outputItems=new sF(this._client)}create(e,t,s){return this._client.post(tY`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(tY`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(tY`/evals/${e}/runs`,tE,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(tY`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(tY`/evals/${n}/runs/${e}`,s)}}sq.OutputItems=sF;class sU extends tV{constructor(){super(...arguments),this.runs=new sq(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(tY`/evals/${e}`,t)}update(e,t,s){return this._client.post(tY`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tE,{query:e,...t})}delete(e,t){return this._client.delete(tY`/evals/${e}`,t)}}sU.Runs=sq;class sH extends tV{create(e,t){return this._client.post("/files",tW({body:e,...t},this._client))}retrieve(e,t){return this._client.get(tY`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tE,{query:e,...t})}delete(e,t){return this._client.delete(tY`/files/${e}`,t)}content(e,t){return this._client.get(tY`/files/${e}/content`,{...t,headers:sf([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await e4(t),i=await this.retrieve(e),Date.now()-r>s)throw new eW({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class sX extends tV{}class sJ extends tV{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class sK extends tV{constructor(){super(...arguments),this.graders=new sJ(this._client)}}sK.Graders=sJ;class sz extends tV{create(e,t,s){return this._client.getAPIList(tY`/fine_tuning/checkpoints/${e}/permissions`,tP,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(tY`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(tY`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class sV extends tV{constructor(){super(...arguments),this.permissions=new sz(this._client)}}sV.Permissions=sz;class sG extends tV{list(e,t={},s){return this._client.getAPIList(tY`/fine_tuning/jobs/${e}/checkpoints`,tE,{query:t,...s})}}class sQ extends tV{constructor(){super(...arguments),this.checkpoints=new sG(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(tY`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tE,{query:e,...t})}cancel(e,t){return this._client.post(tY`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(tY`/fine_tuning/jobs/${e}/events`,tE,{query:t,...s})}pause(e,t){return this._client.post(tY`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(tY`/fine_tuning/jobs/${e}/resume`,t)}}sQ.Checkpoints=sG;class sY extends tV{constructor(){super(...arguments),this.methods=new sX(this._client),this.jobs=new sQ(this._client),this.checkpoints=new sV(this._client),this.alpha=new sK(this._client)}}sY.Methods=sX,sY.Jobs=sQ,sY.Checkpoints=sV,sY.Alpha=sK;class sZ extends tV{}class s0 extends tV{constructor(){super(...arguments),this.graderModels=new sZ(this._client)}}s0.GraderModels=sZ;class s1 extends tV{createVariation(e,t){return this._client.post("/images/variations",tW({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tW({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class s2 extends tV{retrieve(e,t){return this._client.get(tY`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tP,e)}delete(e,t){return this._client.delete(tY`/models/${e}`,t)}}class s4 extends tV{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class s3 extends tV{accept(e,t,s){return this._client.post(tY`/realtime/calls/${e}/accept`,{body:t,...s,headers:sf([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post(tY`/realtime/calls/${e}/hangup`,{...t,headers:sf([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post(tY`/realtime/calls/${e}/refer`,{body:t,...s,headers:sf([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post(tY`/realtime/calls/${e}/reject`,{body:t,...s,headers:sf([{Accept:"*/*"},s?.headers])})}}class s6 extends tV{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class s8 extends tV{constructor(){super(...arguments),this.clientSecrets=new s6(this._client),this.calls=new s3(this._client)}}function s5(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,n;let r=(s=e.tools??[],n=t.name,s.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:r?.$brand==="auto-parseable-tool"?r.$parseRaw(t.arguments):r?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,n;return"output_text"===e.type?{...e,parsed:(s=t,n=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(n):JSON.parse(n))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||s9(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function s9(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}s8.ClientSecrets=s6,s8.Calls=s3;class s7 extends t9{constructor(e){super(),ed.add(this),ef.set(this,void 0),ep.set(this,void 0),em.set(this,void 0),eN(this,ef,e,"f")}static createResponse(e,t,s){let n=new s7(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n,r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eP(this,ed,"m",eg).call(this);let i=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eP(this,ed,"m",ey).call(this,r,i);if(n.controller.signal?.aborted)throw new eB;return eP(this,ed,"m",ew).call(this)}[(ef=new WeakMap,ep=new WeakMap,em=new WeakMap,ed=new WeakSet,eg=function(){this.ended||eN(this,ep,void 0,"f")},ey=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eP(this,ed,"m",e_).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eM(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eM(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eM(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eM(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},ew=function(){if(this.ended)throw new eM("stream has ended, this shouldn't happen");let e=eP(this,ep,"f");if(!e)throw new eM("request ended without sending any events");eN(this,ep,void 0,"f");let t=function(e,t){var s;return t&&(s=t,t1(s.text?.format))?s5(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eP(this,ef,"f"));return eN(this,em,t,"f"),t},e_=function(e){let t=eP(this,ep,"f");if(!t){if("response.created"!==e.type)throw new eM(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eN(this,ep,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eM(`missing output at index ${e.output_index}`);let n=s.type,r=e.part;"message"===n&&"reasoning_text"!==r.type?s.content.push(r):"reasoning"===n&&"reasoning_text"===r.type&&(s.content||(s.content=[]),s.content.push(r));break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eM(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eM(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eM(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eM(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.reasoning_text.delta":{let s=t.output[e.output_index];if(!s)throw new eM(`missing output at index ${e.output_index}`);if("reasoning"===s.type){let t=s.content?.[e.content_index];if(!t)throw new eM(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new eM(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":eN(this,ep,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eP(this,em,"f");if(!e)throw new eM("stream ended without producing a ChatCompletion");return e}}class ne extends tV{list(e,t={},s){return this._client.getAPIList(tY`/responses/${e}/input_items`,tE,{query:t,...s})}}class nt extends tV{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class ns extends tV{constructor(){super(...arguments),this.inputItems=new ne(this._client),this.inputTokens=new nt(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s9(e),e))}retrieve(e,t={},s){return this._client.get(tY`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s9(e),e))}delete(e,t){return this._client.delete(tY`/responses/${e}`,{...t,headers:sf([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>s5(t,e))}stream(e,t){return s7.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(tY`/responses/${e}/cancel`,t)}}ns.InputItems=ne,ns.InputTokens=nt;class nn extends tV{create(e,t,s){return this._client.post(tY`/uploads/${e}/parts`,tW({body:t,...s},this._client))}}class nr extends tV{constructor(){super(...arguments),this.parts=new nn(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(tY`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(tY`/uploads/${e}/complete`,{body:t,...s})}}nr.Parts=nn;let ni=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class na extends tV{create(e,t,s){return this._client.post(tY`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(tY`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(tY`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(tY`/vector_stores/${n}/file_batches/${e}/files`,tE,{query:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sf([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e4(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(a).map(l);return await ni(c),await this.createAndPoll(e,{file_ids:o})}}class no extends tV{create(e,t,s){return this._client.post(tY`/vector_stores/${e}/files`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(tY`/vector_stores/${n}/files/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(tY`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(tY`/vector_stores/${e}/files`,tE,{query:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(tY`/vector_stores/${n}/files/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sf([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e4(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(tY`/vector_stores/${n}/files/${e}/content`,tP,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nl extends tV{constructor(){super(...arguments),this.files=new no(this._client),this.fileBatches=new na(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(tY`/vector_stores/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(tY`/vector_stores/${e}`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tE,{query:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(tY`/vector_stores/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(tY`/vector_stores/${e}/search`,tP,{body:t,method:"post",...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nl.Files=no,nl.FileBatches=na;class nc extends tV{create(e,t){return this._client.post("/videos",tD({body:e,...t},this._client))}retrieve(e,t){return this._client.get(tY`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",tC,{query:e,...t})}delete(e,t){return this._client.delete(tY`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(tY`/videos/${e}/content`,{query:t,...s,headers:sf([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(tY`/videos/${e}/remix`,tD({body:t,...s},this._client))}}class nh extends tV{constructor(){super(...arguments),eb.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");eP(this,eb,"m",ev).call(this,s);let r=sf([t]).values,i=eP(this,eb,"m",ex).call(this,r,"webhook-signature"),a=eP(this,eb,"m",ex).call(this,r,"webhook-timestamp"),o=eP(this,eb,"m",ex).call(this,r,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new eQ("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new eQ("Webhook timestamp is too old");if(l>c+n)throw new eQ("Webhook timestamp is too new");let h=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),u=s.startsWith("whsec_")?sI.Buffer.from(s.replace("whsec_",""),"base64"):sI.Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,f=await crypto.subtle.importKey("raw",u,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of h)try{let t=sI.Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",f,t,new TextEncoder().encode(d)))return}catch{continue}throw new eQ("The given webhook signature does not match the expected signature")}}eb=new WeakSet,ev=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},ex=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s},e.i(30742);class nu{constructor({baseURL:e=sO("OPENAI_BASE_URL"),apiKey:t=sO("OPENAI_API_KEY"),organization:s=sO("OPENAI_ORG_ID")??null,project:n=sO("OPENAI_PROJECT_ID")??null,webhookSecret:r=sO("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(eS.add(this),eA.set(this,void 0),this.completions=new sC(this),this.chat=new su(this),this.embeddings=new sW(this),this.files=new sH(this),this.images=new s1(this),this.audio=new sy(this),this.moderations=new s4(this),this.models=new s2(this),this.fineTuning=new sY(this),this.graders=new s0(this),this.vectorStores=new nl(this),this.webhooks=new nh(this),this.beta=new sE(this),this.batches=new sw(this),this.uploads=new nr(this),this.responses=new ns(this),this.realtime=new s8(this),this.conversations=new sD(this),this.evals=new sU(this),this.containers=new sL(this),this.videos=new nc(this),void 0===t)throw new eM("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const a={apiKey:t,organization:s,project:n,webhookSecret:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new eM("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??e$.DEFAULT_TIMEOUT,this.logger=a.logger??console;const o="warn";this.logLevel=o,this.logLevel=tg(a.logLevel,"ClientOptions.logLevel",this)??tg(sO("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eN(this,eA,tt,"f"),this._options=a,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return sf([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n=e,r=function(e=th){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||th.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=ts;if(void 0!==e.format){if(!ti(tr,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tr[n],i=th.filter;if(("function"==typeof e.filter||eZ(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in tl?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":th.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||th.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:th.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:th.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:th.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?th.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:th.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:th.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:th.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:th.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:th.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:th.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:th.strictNullHandling}}(t);"function"==typeof r.filter?n=(0,r.filter)("",n):eZ(r.filter)&&(s=r.filter);let i=[];if("object"!=typeof n||null===n)return"";let a=tl[r.arrayFormat],o="comma"===a&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];r.skipNulls&&null===n[t]||tc(i,function e(t,s,n,r,i,a,o,l,c,h,u,d,f,p,m,g,y,w){var _,b;let v,x=t,S=w,$=0,A=!1;for(;void 0!==(S=S.get(tu))&&!A;){let e=S.get(t);if($+=1,void 0!==e)if(e===$)throw RangeError("Cyclic object value");else A=!0;void 0===S.get(tu)&&($=0)}if("function"==typeof h?x=h(s,x):x instanceof Date?x=f?.(x):"comma"===n&&eZ(x)&&(x=to(x,function(e){return e instanceof Date?f?.(e):e})),null===x){if(a)return c&&!g?c(s,th.encoder,y,"key",p):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,th.encoder,y,"key",p);return[m?.(e)+"="+m?.(c(x,th.encoder,y,"value",p))]}return[m?.(s)+"="+m?.(String(x))]}let k=[];if(void 0===x)return k;if("comma"===n&&eZ(x))g&&c&&(x=to(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(eZ(h))v=h;else{let e=Object.keys(x);v=u?e.sort(u):e}let j=l?String(s).replace(/\./g,"%2E"):String(s),I=r&&eZ(x)&&1===x.length?j+"[]":j;if(i&&eZ(x)&&0===x.length)return I+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,A=eZ(x)?"function"==typeof n?n(I,S):I:I+(d?"."+S:"["+S+"]");w.set(t,$);let j=new WeakMap;j.set(tu,w),tc(k,e(b,A,n,r,i,a,o,l,"comma"===n&&g&&eZ(x)?null:c,h,u,d,f,p,m,g,y,j))}return k}(n[t],t,a,o,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=i.join(r.delimiter),h=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${e3}`}defaultIdempotencyKey(){return`stainless-node-retry-${eE()}`}makeStatusError(e,t,s,n){return eL.generate(e,t,s,n)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof eM)throw e;throw new eM(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new eM(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,s){let n=!eP(this,eS,"m",ek).call(this)&&s||this.baseURL,r=new URL(eY.test(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tO(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=await this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:a,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(tv(this).debug(`[${l}] sending request`,tx({retryOfRequestLogID:s,method:n.method,url:a,options:n,headers:i.headers})),n.signal?.aborted)throw new eB;let u=new AbortController,d=await this.fetchWithTimeout(a,i,o,u).catch(eT),f=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eB;let r=eC(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tv(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tv(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tx({retryOfRequestLogID:s,url:a,durationMs:f-h,message:d.message})),this.retryRequest(n,t,s??l);if(tv(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tv(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tx({retryOfRequestLogID:s,url:a,durationMs:f-h,message:d.message})),r)throw new eW;throw new eD({cause:d})}let p=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${p}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${f-h}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await te(d.body),tv(this).info(`${m} - ${e}`),tv(this).debug(`[${l}] response error (${e})`,tx({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-h})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tv(this).info(`${m} - ${r}`);let i=await d.text().catch(e=>eT(e).message),a=(e=>{try{return JSON.parse(e)}catch(e){return}})(i),o=a?void 0:i;throw tv(this).debug(`[${l}] response error (${r})`,tx({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,a,o,d.headers)}return tv(this).info(m),tv(this).debug(`[${l}] response start`,tx({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-h})),{response:d,options:n,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tN(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:i,...a}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,n){let r,i=n?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n?.get("retry-after");if(a&&!r){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await e4(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:i,defaultBaseURL:a}=s,o=this.buildURL(r,i,a);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eM(`${e} must be an integer`);if(t<0)throw new eM(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:s,bodyHeaders:n,retryCount:r}){let i={};this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let a=sf([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":e8(Deno.build.os),"X-Stainless-Arch":e6(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":e8(globalThis.process.platform??"unknown"),"X-Stainless-Arch":e6(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sf([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:e9(e)}:eP(this,eA,"f").call(this,{body:e,headers:s})}}e$=nu,eA=new WeakMap,eS=new WeakSet,ek=function(){return"https://api.openai.com/v1"!==this.baseURL},nu.OpenAI=e$,nu.DEFAULT_TIMEOUT=6e5,nu.OpenAIError=eM,nu.APIError=eL,nu.APIConnectionError=eD,nu.APIConnectionTimeoutError=eW,nu.APIUserAbortError=eB,nu.NotFoundError=eH,nu.ConflictError=eX,nu.RateLimitError=eK,nu.BadRequestError=eF,nu.AuthenticationError=eq,nu.InternalServerError=ez,nu.PermissionDeniedError=eU,nu.UnprocessableEntityError=eJ,nu.InvalidWebhookSignatureError=eQ,nu.toFile=tK,nu.Completions=sC,nu.Chat=su,nu.Embeddings=sW,nu.Files=sH,nu.Images=s1,nu.Audio=sy,nu.Moderations=s4,nu.Models=s2,nu.FineTuning=sY,nu.Graders=s0,nu.VectorStores=nl,nu.Webhooks=nh,nu.Beta=sE,nu.Batches=sw,nu.Uploads=nr,nu.Responses=ns,nu.Realtime=s8,nu.Conversations=sD,nu.Evals=sU,nu.Containers=sL,nu.Videos=nc;let nd=new nu({apiKey:"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",dangerouslyAllowBrowser:!0});async function nf(e,t,s){"application/pdf"===e.type&&console.warn("PDF upload detected. AI Vision works best with Images (PNG/JPG).");try{let n=await new Promise((t,s)=>{let n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=e=>s(e)}),r=(await nd.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:`You are an expert building code compliance auditor. 
          Analyze the provided floor plan image against building codes for the specified location and building type.
          Identify specific code violations or potential conflicts.
          
          Return ONLY a JSON object with a "conflicts" array. 
          Each conflict object must have:
          - id: string (unique)
          - description: string (clear explanation of the violation)
          - severity: "high" | "medium" | "low"
          - codeReference: string (cite the specific code section, e.g., "IBC 1005.1")
          
          If no conflicts are found, return an empty array.
          Err on the side of caution (false positives are better than missed violations).`},{role:"user",content:[{type:"text",text:`Location: ${t}
Building Type: ${s}`},{type:"image_url",image_url:{url:n}}]}],response_format:{type:"json_object"},max_tokens:4096})).choices[0].message.content;if(!r)return[];return JSON.parse(r).conflicts||[]}catch(e){throw console.error("AI Analysis Error:",e),Error("Failed to analyze plan with AI.")}}function np(){let[e,t]=(0,eI.useState)(null),[s,n]=(0,eI.useState)(!1),r=async(e,s,r)=>{n(!0),t(null);try{let n=await nf(e,s,r);t(n)}catch(e){console.error("Analysis failed:",e),alert("An error occurred during analysis.")}finally{n(!1)}};return(0,ej.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ej.jsx)("header",{className:"bg-white shadow-sm",children:(0,ej.jsxs)("div",{className:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex items-center justify-between",children:[(0,ej.jsxs)("div",{className:"flex items-center",children:[(0,ej.jsx)("svg",{className:"h-8 w-8 text-blue-600 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,ej.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,ej.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"PlanPath"})]}),(0,ej.jsxs)("nav",{children:[(0,ej.jsx)("a",{href:"#",className:"text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Documentation"}),(0,ej.jsx)("a",{href:"#",className:"text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Support"})]})]})}),(0,ej.jsx)("main",{className:"py-12 px-4 sm:px-6 lg:px-8",children:(0,ej.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,ej.jsxs)("div",{className:"text-center mb-12",children:[(0,ej.jsx)("h2",{className:"text-3xl font-extrabold text-gray-900 sm:text-4xl",children:"Automated Building Code Compliance"}),(0,ej.jsx)("p",{className:"mt-4 text-lg text-gray-600 max-w-2xl mx-auto",children:"Upload your building plans to instantly identify potential conflicts with local building codes using our advanced AI analysis."})]}),(0,ej.jsxs)("div",{className:"grid gap-8",children:[(0,ej.jsx)("section",{children:(0,ej.jsx)(eO,{onAnalyze:r,isAnalyzing:s})}),e&&(0,ej.jsx)("section",{className:"transition-all duration-500 ease-in-out",children:(0,ej.jsx)(eR,{conflicts:e})})]})]})}),(0,ej.jsx)("footer",{className:"bg-white border-t border-gray-200 mt-12",children:(0,ej.jsx)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(0,ej.jsx)("p",{className:"text-center text-sm text-gray-500",children:" 2025 PlanPath. All rights reserved."})})})]})}e.s(["default",()=>np],52683)}]);