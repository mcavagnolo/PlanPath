(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6837:()=>{},20175:(e,t,a)=>{Promise.resolve().then(a.bind(a,87884))},22009:()=>{},27806:()=>{},57646:(e,t,a)=>{"use strict";a.d(t,{c:()=>l});var r=a(99058),s=a(89674);let l=async()=>{let e={states:[],counties:[],cities:[]};try{let t=(0,r.KR)(s.IG,"knowledge-base/State");e.states=(await (0,r._w)(t)).prefixes.map(e=>e.name);let a=(0,r.KR)(s.IG,"knowledge-base/County");e.counties=(await (0,r._w)(a)).prefixes.map(e=>e.name);let l=(0,r.KR)(s.IG,"knowledge-base/City");e.cities=(await (0,r._w)(l)).prefixes.map(e=>e.name)}catch(e){console.error("Error fetching jurisdiction options:",e)}return e}},60143:()=>{},72603:()=>{},83052:()=>{},87884:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var r=a(95155),s=a(12115),l=a(5772),n=a(57646),o=a(93100),i=a(99058),c=a(89674),d=a(36747);d._K2.allowLocalModels=!1,d._K2.useBrowserCache=!0;let u=null,m=null;async function h(){if(u)return u;try{let e=window.location.pathname.startsWith("/PlanPath")?"/PlanPath":"",t=await fetch(`${e}/knowledge_base.json`);if(!t.ok)throw Error("Failed to load knowledge base");return u=await t.json(),console.log(`Loaded ${u?.length} code chunks.`),u}catch(e){return console.error("Error loading knowledge base:",e),[]}}async function x(){return m||(console.log("Loading embedding model..."),m=await (0,d.TkF)("feature-extraction","Xenova/all-MiniLM-L6-v2"))}async function g(e,t=5,a){let r=await h();if(!r||0===r.length)return[];let s=await x(),l=Array.from((await s(e,{pooling:"mean",normalize:!0})).data),n=r;a&&0===(n=r.filter(e=>{let t=e.source.toLowerCase();return!!(a.city&&t.includes(a.city.toLowerCase())||a.county&&t.includes(a.county.toLowerCase())||a.state&&t.includes(a.state.toLowerCase()))})).length&&(console.warn("No documents matched filter, searching entire knowledge base."),n=r);let o=n.map(e=>({...e,score:function(e,t){let a=0,r=0,s=0;for(let l=0;l<e.length;l++)a+=e[l]*t[l],r+=e[l]*e[l],s+=t[l]*t[l];return a/(Math.sqrt(r)*Math.sqrt(s))}(l,e.embedding)}));return o.sort((e,t)=>t.score-e.score),o.slice(0,t)}async function p(e,t=10){try{let r=await e.arrayBuffer(),s=await Promise.all([a.e(592),a.e(185)]).then(a.t.bind(a,33815,23));s.GlobalWorkerOptions.workerSrc||(s.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");let l=await s.getDocument({data:r}).promise,n=[],o=Math.min(l.numPages,t);for(let e=1;e<=o;e++){let t=await l.getPage(e),a=t.getViewport({scale:1.5}),r=document.createElement("canvas"),s=r.getContext("2d");s&&(r.height=a.height,r.width=a.width,await t.render({canvasContext:s,viewport:a}).promise,n.push(r.toDataURL("image/jpeg")))}return n}catch(e){throw console.error("Error converting PDF to images:",e),Error("Failed to convert PDF plan to images.")}}async function f(e,t,r=2e4,s=!1){try{let l=await Promise.all([a.e(592),a.e(185)]).then(a.t.bind(a,33815,23));l.GlobalWorkerOptions.workerSrc||(l.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");let n=await l.getDocument({data:e}).promise,o="",i=0,c=Math.min(n.numPages,50);for(let e=1;e<=c&&!(i>=r);e++){let a=await n.getPage(e),r=(await a.getTextContent()).items.map(e=>e.str).join(" ");if(s){o+=`--- Page ${e} ---
${r}
`,i+=r.length;continue}let l=r.toLowerCase();t.some(e=>l.includes(e.toLowerCase()))&&(o+=`--- Page ${e} (Relevant) ---
${r}
`,i+=r.length)}if(!o)for(let e=1;e<=n.numPages&&!(i>=r);e++){let t=await n.getPage(e),a=(await t.getTextContent()).items.map(e=>e.str).join(" ");o+=`--- Page ${e} ---
${a}
`,i+=a.length}return o}catch(e){return console.error("Error parsing PDF:",e),"Error parsing PDF document."}}async function y(e,t){try{let a=(0,i.KR)(c.IG,e),r=await (0,i._w)(a),s="";for(let a of r.items){if(s.length>3e4)break;try{let r=await (0,i.q5)(a),l="";(l=a.name.toLowerCase().endsWith(".pdf")?await f(r,t):(l=new TextDecoder().decode(r)).substring(0,1e4)).length>0&&(s+=`

=== DOCUMENT: ${a.name} (from ${e}) ===
${l}
`)}catch(e){console.warn(`Failed to read file ${a.name}:`,e)}}return s}catch(t){return console.warn(`Error listing files in ${e}:`,t),""}}async function b(e){let t=[];for(let a of[{type:"State",path:`knowledge-base/State/${e.state}`},{type:"County",path:`knowledge-base/County/${e.county}`},{type:"City",path:`knowledge-base/City/${e.city}`}])if(!a.path.endsWith("/"))try{if(!a.path.split("/")[2])continue;let e=(0,i.KR)(c.IG,a.path);(await (0,i._w)(e)).items.forEach(e=>{t.push({name:e.name,path:e.fullPath,type:a.type})})}catch(e){console.log(`No documents found for ${a.type} at ${a.path}`)}return t}async function w(e,t,a,r,s,l){if(!s)throw Error("OpenAI API Key is required.");let n=new o.Ay({apiKey:s,dangerouslyAllowBrowser:!0});try{let s,o=[];if("application/pdf"===e.type)console.log("Converting PDF plan to images..."),o=await p(e,20);else o=[await new Promise((t,a)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>a(e)})];let d=r?`Jurisdiction: State of ${r.state}, County of ${r.county}, City of ${r.city}.`:"",u=(s=a.toLowerCase().split(/\s+/).filter(e=>e.length>2),Array.from(new Set(["code","regulation","compliance","violation","requirement","standard","section","chapter","table","figure",...s,"height","setback","area","width","depth","egress","stair","fire","safety","zone","district","use","occupancy","parking","access","material","construction"])));if(l){console.log(`Fetching selected document: ${l}`);try{let e=(0,i.KR)(c.IG,l),t=await (0,i.q5)(e),a="";a=l.toLowerCase().endsWith(".pdf")?await f(t,u,1e5):(a=new TextDecoder().decode(t)).substring(0,1e5),d+=`

REFERENCE BUILDING CODES (Selected Document: ${e.name}):
${a}`}catch(e){console.error("Error reading selected document:",e),d+=`

(Error reading selected document. Using general knowledge.)`}}else{console.log("Using Vector Search for relevant codes...");try{let s="";if("application/pdf"===e.type){let t=await e.arrayBuffer();s=await f(t,[],5e4,!0)}else s=`${a} building in ${t}. Common code violations.`;let l=s.match(/.{1,1000}/g)||[s],n=new Set;for(let e of l.slice(0,10))(await g(e,1,r)).forEach(e=>n.add(`[Source: ${e.source}]
${e.text}`));if(n.size>0){let e=Array.from(n).join("\n\n");e.length>15e3&&(e=e.substring(0,15e3)+"\n...(truncated for length)..."),d+=`

REFERENCE BUILDING CODES (AI Selected):
${e}`}else if(console.log("Vector search returned no results, falling back to file fetch."),r){let e=r.state?await y(`knowledge-base/State/${r.state}`,u):"",t=r.county?await y(`knowledge-base/County/${r.county}`,u):"",a=r.city?await y(`knowledge-base/City/${r.city}`,u):"";(e||t||a)&&(d+=`

REFERENCE BUILDING CODES:
${e}
${t}
${a}`)}}catch(e){if(console.error("Vector search failed:",e),r){let e=r.state?await y(`knowledge-base/State/${r.state}`,u):"",t=r.county?await y(`knowledge-base/County/${r.county}`,u):"",a=r.city?await y(`knowledge-base/City/${r.city}`,u):"";(e||t||a)&&(d+=`

REFERENCE BUILDING CODES:
${e}
${t}
${a}`)}}}let m=[];for(let e=0;e<o.length;e+=1){let r=o.slice(e,e+1);console.log(`Analyzing batch ${Math.floor(e/1)+1} (${r.length} images)...`);let s=r.map(e=>({type:"image_url",image_url:{url:e}})),l=(await n.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:`You are an expert building code compliance auditor. 
            Analyze the provided floor plan images (Pages ${e+1} to ${e+r.length}) against building codes.
            
            ${d}
  
            Building Type: ${a}
            Location: ${t}
  
            Identify specific code violations or potential conflicts visible in these specific pages.
            
            Return ONLY a JSON object with a "conflicts" array. 
            Each conflict object must have:
            - id: string (unique)
            - description: string (clear explanation of the violation, referencing the specific page number if possible)
            - severity: "high" | "medium" | "low"
            - codeReference: string (cite the specific code section)
            - pageNumber: number (the absolute page number where the conflict is found, e.g. ${e+1})
            
            If no conflicts are found, return an empty array.`},{role:"user",content:[{type:"text",text:`Location: ${t}
Building Type: ${a}
Pages: ${e+1}-${e+r.length}`},...s]}],response_format:{type:"json_object"},max_tokens:4096})).choices[0].message.content;if(l){let e=JSON.parse(l);if(e.conflicts&&Array.isArray(e.conflicts)){let t=e.conflicts.map(e=>({...e,imageUrl:e.pageNumber&&o[e.pageNumber-1]?o[e.pageNumber-1]:void 0}));m=[...m,...t]}}e+1<o.length&&(console.log("Pausing for rate limit safety..."),await new Promise(e=>setTimeout(e,1e4)))}return m}catch(e){throw console.error("AI Analysis Error:",e),Error("Failed to analyze plan with AI.")}}function j({onAnalyze:e,isAnalyzing:t}){let[a,l]=(0,s.useState)(null),[o,i]=(0,s.useState)(""),[c,d]=(0,s.useState)("residential"),[u,m]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[g,p]=(0,s.useState)(""),[f,y]=(0,s.useState)(""),[w,j]=(0,s.useState)([]),[v,N]=(0,s.useState)(""),[k,C]=(0,s.useState)(!1),[P,$]=(0,s.useState)({states:[],counties:[],cities:[]});return(0,s.useEffect)(()=>{(0,n.c)().then($)},[]),(0,s.useEffect)(()=>{h||g||f?(C(!0),b({state:h,county:g,city:f}).then(e=>{j(e),N("")}).catch(e=>console.error("Error fetching docs:",e)).finally(()=>C(!1))):j([])},[h,g,f]),(0,r.jsxs)("form",{onSubmit:t=>{t.preventDefault(),a&&o&&u?e(a,o,c,{state:h,county:g,city:f},u,v):u||alert("Please enter your OpenAI API Key.")},className:"space-y-6 p-6 bg-white shadow-lg rounded-xl border border-gray-100",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"OpenAI API Key"}),(0,r.jsx)("input",{type:"password",value:u,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"sk-...",required:!0}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Your key is used only for this session and is never stored on our servers."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Name / Address"}),(0,r.jsx)("input",{type:"text",value:o,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g. 123 Main St, El Segundo",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Building Type"}),(0,r.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"residential",children:"Residential"}),(0,r.jsx)("option",{value:"commercial",children:"Commercial"}),(0,r.jsx)("option",{value:"mixed-use",children:"Mixed Use"}),(0,r.jsx)("option",{value:"industrial",children:"Industrial"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),(0,r.jsxs)("select",{value:h,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Select State"}),P.states.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"County"}),(0,r.jsxs)("select",{value:g,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Select County"}),P.counties.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),(0,r.jsxs)("select",{value:f,onChange:e=>y(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Select City"}),P.cities.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]}),(h||g||f)&&(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-md border border-blue-100",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:"Select Specific Code Document (Optional)"}),(0,r.jsx)("p",{className:"text-xs text-blue-700 mb-2",children:"Select a specific document to check against. If none is selected, we will search across all available documents (which may be less accurate for large files)."}),k?(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Loading available documents..."}):w.length>0?(0,r.jsxs)("select",{value:v,onChange:e=>N(e.target.value),className:"w-full px-4 py-2 border border-blue-200 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm",children:[(0,r.jsx)("option",{value:"",children:"-- Check Against All (Auto-Detect) --"}),w.map(e=>(0,r.jsxs)("option",{value:e.path,children:["[",e.type,"] ",e.name]},e.path))]}):(0,r.jsx)("div",{className:"text-sm text-gray-500 italic",children:"No specific documents found for this jurisdiction."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Building Plan (PDF/Image)"}),(0,r.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-400 transition-colors",children:(0,r.jsxs)("div",{className:"space-y-1 text-center",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,r.jsxs)("div",{className:"flex text-sm text-gray-600",children:[(0,r.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[(0,r.jsx)("span",{children:"Upload a file"}),(0,r.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",accept:".pdf,.png,.jpg,.jpeg",className:"sr-only",onChange:e=>{let t=e.target.files?.[0];t?t.size>0x6400000?(alert("File size exceeds 100MB limit."),e.target.value="",l(null)):l(t):l(null)},required:!0})]}),(0,r.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"PDF, PNG, JPG up to 100MB"}),a&&(0,r.jsxs)("p",{className:"text-sm text-green-600 font-semibold mt-2",children:["Selected: ",a.name]})]})})]}),(0,r.jsx)("button",{type:"submit",disabled:!a||!o||t,className:`w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white transition-colors ${t?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`,children:t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing Plans..."]}):"Analyze Plans"})]})}function v({conflicts:e}){return 0===e.length?(0,r.jsxs)("div",{className:"p-6 bg-green-50 border border-green-200 rounded-lg text-center shadow-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-green-800",children:"No Conflicts Found"}),(0,r.jsx)("p",{className:"mt-2 text-green-600",children:"The building plans appear to comply with the checked codes."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Analysis Results"}),(0,r.jsxs)("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium",children:[e.length," Potential Conflict",1!==e.length?"s":""," Found"]})]}),(0,r.jsx)("div",{className:"bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100",children:(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,r.jsx)("li",{className:"p-6 hover:bg-gray-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1",children:"high"===e.severity?(0,r.jsx)("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):"medium"===e.severity?(0,r.jsx)("svg",{className:"h-6 w-6 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):(0,r.jsx)("svg",{className:"h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("p",{className:"text-sm font-bold text-gray-900",children:e.codeReference}),(0,r.jsxs)("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium uppercase tracking-wide ${"high"===e.severity?"bg-red-100 text-red-800":"medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:[e.severity," Priority"]})]}),(0,r.jsx)("p",{className:"text-base text-gray-600 leading-relaxed",children:e.description}),e.imageUrl&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Conflict Location (Snapshot):"}),(0,r.jsx)("div",{className:"relative w-full h-64 border border-gray-200 rounded-lg overflow-hidden bg-gray-100",children:(0,r.jsx)("img",{src:e.imageUrl,alt:"Plan Snapshot",className:"w-full h-full object-contain"})})]})]})]})},e.id))})}),(0,r.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-md",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-blue-700",children:"This tool is designed to err on the side of caution (false positives) to ensure safety. Please verify all findings with a certified professional."})})]})})]})}var N=a(18831);function k(){let[e,t]=(0,s.useState)(null),[a,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)([]),[u,m]=(0,s.useState)(!0),h=async()=>{m(!0);try{let e=(0,i.KR)(c.IG,"Projects"),t=await (0,i._w)(e),a=[];for(let e of t.prefixes){let t=await (0,i._w)(e),r=[];for(let e of t.items){let t=await (0,i.qk)(e);r.push({name:e.name,url:t})}a.push({name:e.name,files:r})}d(a)}catch(e){console.error("Error fetching projects:",e)}finally{m(!1)}};(0,s.useEffect)(()=>{h()},[]);let x=async e=>{if(confirm(`Are you sure you want to delete project "${e}"? This cannot be undone.`))try{let t=(0,i.KR)(c.IG,`Projects/${e}`),a=await (0,i._w)(t);await Promise.all(a.items.map(e=>(0,i.XR)(e))),await h()}catch(e){console.error("Error deleting project:",e),alert("Failed to delete project.")}},g=async(e,a,r,s,l,o)=>{n(!0),t(null);let d=a.replace(/[^a-zA-Z0-9 -]/g,"").trim();try{let n,u,m=(0,i.KR)(c.IG,`Projects/${d}/${e.name}`);await (0,i.D)(m,e);let x=await w(e,a,r,s,l,o);t(x);let g=((n=new N.uE).setFontSize(20),n.text(`Building Code Analysis: ${a}`,20,20),n.setFontSize(12),n.text(`Date: ${new Date().toLocaleDateString()}`,20,30),u=50,x.forEach((e,t)=>{u>270&&(n.addPage(),u=20),n.setFont("helvetica","bold"),n.text(`${t+1}. ${e.codeReference}`,20,u),u+=7,n.setFont("helvetica","normal");let a=n.splitTextToSize(e.description,170);n.text(a,20,u),u+=5*a.length+5,n.setTextColor(255,0,0),n.text(`Severity: ${e.severity.toUpperCase()}`,20,u),n.setTextColor(0,0,0),u+=10}),n.output("blob")),p=new File([g],"Analysis_Results.pdf",{type:"application/pdf"}),f=(0,i.KR)(c.IG,`Projects/${d}/Analysis_Results.pdf`);await (0,i.D)(f,p),await h()}catch(e){console.error("Analysis failed:",e),alert("An error occurred during analysis.")}finally{n(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,r.jsx)("header",{className:"bg-[#fff9ea] shadow-sm z-10",children:(0,r.jsxs)("div",{className:"w-full px-6 py-4 flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)(l.default,{src:"/PlanPath/logos/PlanPath Logo wName (Horizontal).png",alt:"PlanPath Logo",width:200,height:50,className:"h-12 w-auto",priority:!0})}),(0,r.jsxs)("nav",{children:[(0,r.jsx)("a",{href:"/PlanPath/admin",className:"text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Admin"}),(0,r.jsx)("a",{href:"#",className:"text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Documentation"})]})]})}),(0,r.jsxs)("div",{className:"flex flex-1 w-full",children:[(0,r.jsx)("aside",{className:"w-72 bg-white border-r border-gray-200 hidden lg:block flex-shrink-0",children:(0,r.jsxs)("div",{className:"p-6 sticky top-0",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4 border-b pb-2",children:"Projects"}),u?(0,r.jsx)("div",{className:"text-sm text-gray-500 animate-pulse",children:"Loading projects..."}):0===o.length?(0,r.jsx)("div",{className:"text-sm text-gray-500 italic",children:"No projects yet."}):(0,r.jsx)("div",{className:"space-y-4",children:o.map(e=>(0,r.jsxs)("details",{className:"group",children:[(0,r.jsxs)("summary",{className:"list-none cursor-pointer flex items-center justify-between text-sm font-medium text-gray-700 hover:text-blue-600 group/summary",children:[(0,r.jsx)("span",{className:"truncate flex-1 mr-2",children:e.name}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:t=>{t.preventDefault(),x(e.name)},className:"opacity-0 group-hover/summary:opacity-100 text-gray-400 hover:text-red-500 p-1 transition-opacity",title:"Delete Project",children:"\uD83D\uDDD1️"}),(0,r.jsx)("span",{className:"transform group-open:rotate-90 transition-transform text-gray-400",children:"▶"})]})]}),(0,r.jsx)("div",{className:"mt-2 ml-2 space-y-2 border-l-2 border-gray-100 pl-2",children:e.files.map(e=>(0,r.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"block text-xs text-gray-600 hover:text-blue-600 hover:underline truncate",title:e.name,children:[e.name.endsWith(".pdf")?"\uD83D\uDCC4":"\uD83D\uDDBC️"," ",e.name]},e.name))})]},e.name))})]})}),(0,r.jsxs)("main",{className:"flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("h2",{className:"text-3xl font-extrabold text-gray-900 sm:text-4xl",children:"Automated Building Code Compliance"}),(0,r.jsx)("p",{className:"mt-4 text-lg text-gray-600 max-w-2xl mx-auto",children:"Upload your building plans to instantly identify potential conflicts with local building codes using our advanced AI analysis."})]}),(0,r.jsxs)("div",{className:"grid gap-8",children:[(0,r.jsx)("section",{children:(0,r.jsx)(j,{onAnalyze:g,isAnalyzing:a})}),e&&(0,r.jsx)("section",{className:"transition-all duration-500 ease-in-out",children:(0,r.jsx)(v,{conflicts:e})})]})]})]}),(0,r.jsx)("footer",{className:"bg-[#fff9ea] border-t border-gray-200 mt-auto",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 flex flex-col items-center",children:[(0,r.jsx)(l.default,{src:"/PlanPath/logos/PlanPath Logo.png",alt:"PlanPath Icon",width:32,height:32,className:"h-8 w-8 mb-2"}),(0,r.jsx)("p",{className:"text-center text-sm text-gray-500",children:"\xa9 2025 PlanPath. All rights reserved."})]})})]})}},89674:(e,t,a)=>{"use strict";a.d(t,{IG:()=>i});var r=a(97873),s=a(4927),l=a(99058),n=a(59997);let o=(0,r.Dk)().length?(0,r.Sx)():(0,r.Wp)({apiKey:"AIzaSyAJI3SYJGTx7RshdX8OXG8v2T6KMKyGMLk",authDomain:"planpath-458b1.firebaseapp.com",projectId:"planpath-458b1",storageBucket:"planpath-458b1.firebasestorage.app",messagingSenderId:"272519881718",appId:"1:272519881718:web:136859f0c4d81dcf6c5dd7",measurementId:"G-T4Q4HMJMYF"});(0,s.aU)(o);let i=(0,l.c7)(o);(0,n.xI)(o)}},e=>{e.O(0,[135,204,33,811,138,31,930,390,871,441,794,358],()=>e(e.s=20175)),_N_E=e.O()}]);